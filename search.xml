<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>è™šæ‹Ÿ DOM çš„æ€§èƒ½åˆ°åº•å¦‚ä½•</title>
      <link href="/2023/09/09/%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%B0%E5%BA%95%E5%A6%82%E4%BD%95/"/>
      <url>/2023/09/09/%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%B0%E5%BA%95%E5%A6%82%E4%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="è™šæ‹Ÿ-DOM-çš„æ€§èƒ½åˆ°åº•å¦‚ä½•"><a href="#è™šæ‹Ÿ-DOM-çš„æ€§èƒ½åˆ°åº•å¦‚ä½•" class="headerlink" title="è™šæ‹Ÿ DOM çš„æ€§èƒ½åˆ°åº•å¦‚ä½•"></a>è™šæ‹Ÿ DOM çš„æ€§èƒ½åˆ°åº•å¦‚ä½•</h1><p>è®¨è®ºè™šæ‹Ÿ DOM ä¹‹å‰ï¼Œéœ€è¦äº†è§£ <strong>å‘½ä»¤å¼å’Œå£°æ˜å¼</strong> ä»£ç </p><h1 id="1-å‘½ä»¤å¼å’Œå£°æ˜å¼"><a href="#1-å‘½ä»¤å¼å’Œå£°æ˜å¼" class="headerlink" title="1 å‘½ä»¤å¼å’Œå£°æ˜å¼"></a>1 å‘½ä»¤å¼å’Œå£°æ˜å¼</h1><p>å‰ç«¯å¼€å‘ä¸­ï¼Œå­˜åœ¨ä¸¤ç§ä»£ç æ–¹å¼ï¼š</p><ul><li>å‘½ä»¤å¼</li><li>å£°æ˜å¼</li></ul><h2 id="1-1-å‘½ä»¤å¼"><a href="#1-1-å‘½ä»¤å¼" class="headerlink" title="1.1 å‘½ä»¤å¼"></a>1.1 å‘½ä»¤å¼</h2><p>å‘½ä»¤æ˜¯çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼Œ<strong>å…³æ³¨è¿‡ç¨‹</strong></p><p>ä¾‹å¦‚ï¼Œæˆ‘ç°åœ¨è¦ä¸º div è®¾ç½®æ–‡æœ¬å†…å®¹ï¼Œå¹¶æ·»åŠ ç‚¹å‡»äº‹ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const div = document.getElementById(&#x27;container&#x27;);   // è·å– Dom</span><br><span class="line">div.innerText = &#x27;New Word&#x27;;</span><br><span class="line">div.addEventListener(&#x27;click&#x27;, () =&gt; &#123;console.log(&#x27;è§¦å‘äº†ç‚¹å‡»äº‹ä»¶&#x27;)&#125;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨åŸç”Ÿ JSï¼Œå…³æ³¨äºä¸€æ­¥ä¸€æ­¥çš„è¿‡ç¨‹ï¼š</p><ul><li>æ‹¿åˆ° div</li><li>ä¿®æ”¹ innerText</li><li>ä¸ºå…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬</li></ul><h2 id="1-2-å£°æ˜å¼"><a href="#1-2-å£°æ˜å¼" class="headerlink" title="1.2 å£°æ˜å¼"></a>1.2 å£°æ˜å¼</h2><p>è€Œå£°æ˜å¼çš„ç‰¹ç‚¹æ˜¯ï¼Œ<strong>å…³æ³¨ç»“æœ</strong></p><p>ç»“åˆ Vue ï¼Œæ¥å®ç°ä¸Šé¢çš„åŠŸèƒ½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div @click=&quot;() =&gt; &#123;console.log(&#x27;è§¦å‘äº†ç‚¹å‡»äº‹ä»¶&#x27;)&#125;&quot;&gt; New Word &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>è¿™ç§ä»£ç ï¼Œä¸å…³å¿ƒå…·ä½“æ˜¯æ€æ ·å®ç°çš„ï¼Œä¸éœ€è¦è·å– Dom æ¥åšè¿›ä¸€æ­¥çš„æ“ä½œï¼Œæˆ‘ä»¬åªå…³å¿ƒç»“æœ</p><p>ç›¸å½“äºå‘Šè¯‰ Vueï¼šâ€å¸®æˆ‘ç»™ div èŠ‚ç‚¹åŠ ä¸Šæ–‡æœ¬å†…å®¹ï¼Œæ·»åŠ ä¸Šç‚¹å‡»äº‹ä»¶â€œ</p><p>è€Œå…·ä½“çš„è¿‡ç¨‹ï¼Œæ˜¯ Vue å°è£…å¥½</p><p>æ‰€ä»¥ï¼š<strong>Vue æš´æ¼ç»™ç”¨æˆ·çš„æ˜¯ å£°æ˜å¼ï¼Œå†…éƒ¨æ˜¯ å‘½ä»¤å¼</strong></p><h2 id="1-3-å‘½ä»¤å¼å’Œå£°æ˜å¼çš„ä¼˜ç¼ºç‚¹"><a href="#1-3-å‘½ä»¤å¼å’Œå£°æ˜å¼çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="1.3 å‘½ä»¤å¼å’Œå£°æ˜å¼çš„ä¼˜ç¼ºç‚¹"></a>1.3 å‘½ä»¤å¼å’Œå£°æ˜å¼çš„ä¼˜ç¼ºç‚¹</h2><p>åœ¨å¤æ‚é¡µé¢å¼€å‘çš„æƒ…å†µä¸‹ï¼Œç›¸æ¯”äºå£°æ˜å¼ï¼Œå‘½ä»¤å¼æ˜¾ç„¶ä¹¦å†™ç›¸å¯¹ç¹çä¸€ç‚¹ã€‚æ˜¾ç„¶ä½¿ç”¨å£°æ˜å¼ä»£ç å¯ç»´æŠ¤æ€§è¾ƒå¼ºä¸€äº›ã€‚</p><p>é‚£ä¹ˆå‘½ä»¤å¼å’Œå£°æ˜å¼çš„æ€§èƒ½è°æ›´ä¼˜å‘¢ï¼Ÿ</p><p><strong>å£°æ˜å¼ä»£ç çš„æ€§èƒ½ä¸ä¸€å®šä¼˜äºå‘½ä»¤å¼ä»£ç çš„æ€§èƒ½</strong></p><p>ä¾‹å¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼š</p><p>å‘½ä»¤å¼ä»£ç ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤æ“ä½œï¼Œä¿®æ”¹æ–‡æœ¬å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.innerText = &#x27;New Word&#x27;;  // ç›´æ¥ä¿®æ”¹</span><br></pre></td></tr></table></figure><p>å£°æ˜å¼ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ä¹‹å‰ï¼š --&gt;</span><br><span class="line">&lt;div&gt; æ—§æ–‡æœ¬ &lt;/div&gt;</span><br><span class="line">&lt;!-- ä¹‹åï¼š --&gt;</span><br><span class="line">&lt;div&gt; New Word &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å£°æ˜å¼ä»£ç ï¼Œå…¶å®æ¡†æ¶éœ€è¦æ‰¾åˆ°å‰åçš„å·®å¼‚ï¼Œåªæ›´æ–°å˜åŒ–çš„åœ°æ–¹ï¼Œç„¶åæ‰§è¡Œ <code>div.innerText = &#39;New Word&#39;;</code> è¿›è¡Œä¿®æ”¹ï¼Œå®Œæˆä¿®æ”¹æ–‡æœ¬å†…å®¹</p><p>å¦‚æœå°†ä¿®æ”¹çš„æ€§èƒ½æ¶ˆè€—å®šä¹‰ä¸º Aï¼ŒæŠŠæ‰¾å‡ºå·®å¼‚çš„æ€§èƒ½æ¶ˆè€—å®šä¹‰ä¸º Bï¼Œå¯ä»¥å¾—å‡ºå¦‚ä¸‹ï¼š</p><ul><li><strong>å‘½ä»¤å¼ä»£ç çš„æ›´æ–°æ€§èƒ½æ¶ˆè€— &#x3D; A</strong></li><li><strong>å£°æ˜å¼ä»£ç çš„æ›´æ–°æ€§èƒ½æ¶ˆè€— &#x3D; A + B</strong></li></ul><p>è¿™ç¬¦åˆå‰é¢æåˆ°çš„ï¼šå£°æ˜å¼ä»£ç çš„æ€§èƒ½ä¸ä¸€å®šä¼˜äºå‘½ä»¤å¼ä»£ç çš„æ€§èƒ½</p><p>ä½†æ˜¯å¦‚æœèƒ½å°† B çš„æ€§èƒ½æ¶ˆè€—é™ä½ï¼Œæ— é™æ¥è¿‘ 0ï¼Œå£°æ˜å¼å’Œå‘½ä»¤å¼çš„æ€§èƒ½æ¶ˆè€—å°±èƒ½ç›¸ç­‰</p><p>è€Œèƒ½å¤Ÿé™ä½æ€§èƒ½ B çš„æ–¹å¼ï¼Œå°±æ˜¯è™šæ‹Ÿ DOM äº†</p><p><strong>æ‰€è°“çš„è™šæ‹Ÿ DOMï¼Œå°±æ˜¯æœ€å°åŒ–æ‰¾å‡ºå·®å¼‚çš„æ€§èƒ½æ¶ˆè€—ï¼Œä½¿å£°æ˜å¼ä»£ç æ€§èƒ½æ¶ˆè€— æ¥è¿‘ å‘½ä»¤å¼ä»£ç çš„æ€§èƒ½æ¶ˆè€—ã€‚</strong></p><h1 id="2-è™šæ‹Ÿ-DOM-åˆ›å»ºé¡µé¢çš„æ€§èƒ½æ¶ˆè€—"><a href="#2-è™šæ‹Ÿ-DOM-åˆ›å»ºé¡µé¢çš„æ€§èƒ½æ¶ˆè€—" class="headerlink" title="2 è™šæ‹Ÿ DOM åˆ›å»ºé¡µé¢çš„æ€§èƒ½æ¶ˆè€—"></a>2 è™šæ‹Ÿ DOM åˆ›å»ºé¡µé¢çš„æ€§èƒ½æ¶ˆè€—</h1><p>ä¸ºäº†æ¯”è¾ƒè™šæ‹Ÿ DOM çš„æ€§èƒ½</p><p>éœ€è¦äº†è§£å…¶åˆ›å»ºã€æ›´æ–°çš„è¿‡ç¨‹</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè™šæ‹Ÿ DOM å®é™…ä¸Šæ˜¯ JS å¯¹è±¡ï¼Œæ‰€ä»¥ï¼š</p><p>è™šæ‹Ÿ DOM åˆ›å»ºé¡µé¢çš„æ•ˆç‡ &#x3D; åˆ›å»º JS å¯¹è±¡çš„æ•ˆç‡ + æ–°å»ºæ‰€æœ‰ DOM å…ƒç´ çš„æ•ˆç‡</p><table><thead><tr><th align="left"></th><th>è™šæ‹Ÿ DOM åˆ›å»ºé¡µé¢çš„æ•ˆç‡</th></tr></thead><tbody><tr><td align="left">çº¯ JS å±‚é¢è®¡ç®—</td><td>åˆ›å»º JS å¯¹è±¡çš„æ•ˆç‡</td></tr><tr><td align="left">DOM å±‚é¢è®¡ç®—</td><td>æ–°å»ºæ‰€æœ‰ DOM å…ƒç´ çš„æ•ˆç‡</td></tr></tbody></table><p>ä¸ºäº†æ¯”è¾ƒçº¯ JS å±‚é¢çš„è®¡ç®—æ¶ˆè€—ï¼Œè¿™é‡Œä½¿ç”¨ JavaScript ä»£ç æ‰§è¡Œæ•ˆç‡å¯¹æ¯”å·¥å…·è¿›è¡Œæµ‹è¯•</p><blockquote><p>githubï¼š<a href="https://github.com/barretlee/performance">https://github.com/barretlee/performance</a></p></blockquote><div align="center">    <img src="/2023/09/09/è™šæ‹ŸDOMçš„æ€§èƒ½åˆ°åº•å¦‚ä½•/test.webp" style="height: 400px; width: 600px;"></div><p>ä¸Šé¢æ˜¯çº¯ JS å±‚é¢çš„è®¡ç®—ï¼Œæ¨¡æ‹Ÿåˆ›å»ºè™šæ‹Ÿ DOMï¼Œå¾ªç¯ 1000 æ¬¡</p><p>ä¸‹é¢åˆ™æ˜¯ DOM æ“ä½œï¼Œå¾ªç¯ 1000 æ¬¡ï¼Œæ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä½œä¸ºå­èŠ‚ç‚¹æ’å…¥</p><p>æ ¹æ® Relative Rateï¼Œçº¯ JS å±‚é¢çš„è®¡ç®—çš„æ•ˆç‡è¦<strong>è¿œè¿œé«˜äº</strong>DOM æ“ä½œ</p><p><strong>ä»å®è§‚ä¸Šæ¥çœ‹ï¼Œåˆ™è®¤ä¸º è™šæ‹Ÿ DOM åˆ›å»ºé¡µé¢çš„æ•ˆç‡ å’Œ ç›´æ¥é‡‡ç”¨çœŸå® DOM ï¼Œæ˜¯æ²¡æœ‰å·®å¼‚çš„</strong></p><h1 id="2-è™šæ‹Ÿ-DOM-æ›´æ–°é¡µé¢çš„æ€§èƒ½æ¶ˆè€—"><a href="#2-è™šæ‹Ÿ-DOM-æ›´æ–°é¡µé¢çš„æ€§èƒ½æ¶ˆè€—" class="headerlink" title="2 è™šæ‹Ÿ DOM æ›´æ–°é¡µé¢çš„æ€§èƒ½æ¶ˆè€—"></a>2 è™šæ‹Ÿ DOM æ›´æ–°é¡µé¢çš„æ€§èƒ½æ¶ˆè€—</h1><p>ä¸Šé¢è®¨è®ºäº†è™šæ‹Ÿ DOM åˆ›å»ºé¡µé¢æ—¶çš„æ€§èƒ½æƒ…å†µï¼Œæˆ–è®¸å¯ä»¥è®¤ä¸ºå’Œç›´æ¥æ“ä½œçœŸå®DOMæ²¡æœ‰å·®å¼‚ï¼Œç”šè‡³æ·±ç©¶ä¸‹ï¼Œè™šæ‹Ÿ DOM çš„æ€§èƒ½æ›´å·®</p><p>ä½†æ˜¯åœ¨æ›´æ–°ç•Œé¢çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½çš„æå‡å°±æ˜æ˜¾äº†</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ innerHtml æ›´æ–°ç•Œé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">div.innerHTML = &#x27;New Word&#x27;</span><br></pre></td></tr></table></figure><p>å…¶è¿‡ç¨‹æ˜¯ï¼Œé‡æ–°æ„å»º HTML å­—ç¬¦ä¸²ï¼Œå†é‡æ–°è®¾ç½® DOM å…ƒç´ çš„ innerHTML çš„å±æ€§</p><p><strong>ä¹Ÿå°±æ˜¯ï¼šé‚£ä¹ˆæˆ‘ä»¬åªæ”¹äº†ä¸€ä¸ªå­—ï¼Œä¹Ÿè¦é”€æ¯æ‰€æœ‰æ—§çš„ DOM å…ƒç´ ï¼Œå†å…¨é‡åˆ›å»ºæ–°çš„ DOM å…ƒç´ </strong></p><p>è€Œè™šæ‹Ÿ DOM æ›´æ–°é¡µé¢å¾—è¿‡ç¨‹ï¼š</p><p>å®ƒéœ€è¦é‡æ–°æ„å»º JS å¯¹è±¡ï¼ˆè™šæ‹ŸDOMï¼‰ï¼Œé€šè¿‡ Diff ç®—æ³•ï¼Œå¯»æ‰¾å·®å¼‚ï¼Œå¤ç”¨æ—§ DOMï¼Œåªæ‰¾åˆ°æ›´æ–°çš„å…ƒç´ è¿›è¡Œä¿®æ”¹</p><table><thead><tr><th></th><th>è™šæ‹Ÿ DOM</th><th>innerHTML</th></tr></thead><tbody><tr><td>çº¯ JS å±‚é¢è®¡ç®—</td><td>åˆ›å»º JS å¯¹è±¡çš„æ•ˆç‡ + Diff</td><td>æ¸²æŸ“ HTML å­—ç¬¦ä¸²</td></tr><tr><td>DOM å±‚é¢è®¡ç®—</td><td>ä»…æ›´æ–°å˜åŒ–çš„ DOM</td><td>é”€æ¯æ‰€æœ‰æ—§ DOM + æ–°å»ºæ‰€æœ‰æ–° DOM</td></tr></tbody></table><p>å³ä½¿è™šæ‹Ÿ DOM å¤šå‡º æ„å»º JS å¯¹è±¡ï¼ˆè™šæ‹ŸDOMï¼‰ï¼Œé€šè¿‡ diff ç®—æ³•çš„ä¸¤ä¸ªæ­¥éª¤</p><p>ä½†ä»–ä»¬éƒ½æ˜¯ çº¯ JS å±‚é¢çš„è®¡ç®—ï¼Œç»è¿‡ä¸Šé¢çš„æµ‹è¯•ï¼Œä¸ä¼šäº§ç”Ÿæ•°é‡çº§çš„æ¶ˆè€—</p><p>å†è§‚å¯Ÿ DOM å±‚é¢çš„æ¶ˆè€—</p><p>è™šæ‹Ÿ DOM ä»…æ›´æ–°å¿…è¦çš„å…ƒç´ </p><p>ä½† innerHTML éœ€è¦å…¨é‡æ›´æ–°ï¼Œé¡µé¢å†…å®¹è¶Šå¤šï¼Œæ€§èƒ½æ¶ˆè€—è¶Šå¤§</p><p>è¿™æ—¶è™šæ‹Ÿ DOM çš„ä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†</p><h1 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3 æ€»ç»“"></a>3 æ€»ç»“</h1><p>æ ¹æ®å‘½ä»¤å¼å’Œå£°æ˜å¼ä»£ç çš„åŸç†ï¼Œæˆ‘ä»¬èƒ½å¾—çŸ¥ï¼š</p><p><strong>å£°æ˜å¼ä»£ç çš„æ›´æ–°æ€§èƒ½æ¶ˆè€— &#x3D; ä¿®æ”¹çš„æ€§èƒ½æ¶ˆè€—å®šä¹‰ + æ‰¾å‡ºå·®å¼‚çš„æ€§èƒ½æ¶ˆè€—</strong></p><p>å¯ä»¥è®¤ä¸ºè™šæ‹Ÿ DOM èƒ½å¤Ÿä½¿<strong>å£°æ˜å¼ä»£ç æ€§èƒ½æ¶ˆè€— æ¥è¿‘ å‘½ä»¤å¼ä»£ç çš„æ€§èƒ½æ¶ˆè€—</strong></p><p>ç»è¿‡æµ‹è¯•çº¯ JS å±‚é¢è®¡ç®—æ¶ˆè€—å’Œ DOM å±‚é¢çš„è®¡ç®—æ¶ˆè€—ï¼Œèƒ½ç¡®å®šåœ¨å®è§‚è§’åº¦ä¸Šï¼Œè™šæ‹Ÿ DOM åœ¨åˆ›å»ºé¡µé¢çš„æ¶ˆè€—å·®å¼‚ä¸å¤§ï¼Œåœ¨æ›´æ–°ç•Œé¢çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé¡µé¢å†…å®¹è¶Šå¤šï¼Œè·å¾—çš„æ€§èƒ½æå‡ä¹Ÿä¼šæ›´å¥½</p><p>åŒæ—¶ï¼Œçº¯ JS å±‚é¢çš„å°‘é‡è®¡ç®—æ¶ˆè€—ï¼Œä¸è·å¾—è¾ƒå¥½çš„ä»£ç ç»´æŠ¤æ€§ä¸Šæ¥çœ‹ï¼Œè™šæ‹Ÿ DOM æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©</p><blockquote><p>å‚è€ƒï¼šã€Švue.jsè®¾è®¡ä¸å®ç°ã€‹éœæ˜¥é˜³ è‘—ä½œ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ä¸€ç‚¹å°æƒ³æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaè¿œç¨‹æ‰§è¡ŒlinuxæœåŠ¡å™¨çš„shellè„šæœ¬</title>
      <link href="/2023/08/26/Java%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8Clinux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84shell%E8%84%9A%E6%9C%AC/"/>
      <url>/2023/08/26/Java%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8Clinux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84shell%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p><strong>ä¹‹å‰æœ‰ä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼š</strong></p><p>æœ‰ä¸€ä¸ª Flink ä»»åŠ¡ä»£ç æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ–°ä»»åŠ¡ç”Ÿæˆåï¼Œæäº¤åˆ°ç›®æ ‡æœåŠ¡å™¨é›†ç¾¤ï¼Œå¯åŠ¨æ–°ä»»åŠ¡ï¼Œè¯»å–å¯¹åº”æ•°æ®æµ</p><p>æ‰€ä»¥è¦èƒ½å¤Ÿå°†è¿™ä¸ªåŠ¨æ€æ–‡ä»¶æ‰“ä¸º jar åŒ…ï¼Œä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶æäº¤ jar åŒ…åˆ°é›†ç¾¤</p><p><strong>æ•´ä½“æµç¨‹ï¼š</strong></p><p>å†™ 3 ä¸ªè„šæœ¬:</p><ul><li>batè„šæœ¬ï¼šä½äºæœ¬åœ° SpringBoot é¡¹ç›®ä¸­ï¼Œåªéœ€æ‰§è¡Œæ‰“ jar åŒ…çš„å‘½ä»¤</li><li>batè„šæœ¬ï¼šä½äºæœ¬åœ° SpringBoot é¡¹ç›®ä¸­ï¼Œå°† jar åŒ…ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨</li><li>shellè„šæœ¬ï¼šä½äºç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œæäº¤ jar åŒ…ä»»åŠ¡</li></ul><p>ç¬¬ä¸€ä¸ªè„šæœ¬ Java å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œåé¢ä¸¤ä¸ªè„šæœ¬ï¼Œéœ€è¦å’Œè¿œç¨‹æœåŠ¡å™¨å»ºç«‹sshé“¾æ¥ï¼Œå†è°ƒç”¨æŒ‡å®šçš„è„šæœ¬</p><h1 id="1-è„šæœ¬æ–‡ä»¶"><a href="#1-è„šæœ¬æ–‡ä»¶" class="headerlink" title="1 è„šæœ¬æ–‡ä»¶"></a>1 è„šæœ¬æ–‡ä»¶</h1><h2 id="1-1-æ‰“-jar-åŒ…"><a href="#1-1-æ‰“-jar-åŒ…" class="headerlink" title="1.1 æ‰“ jar åŒ…"></a>1.1 æ‰“ jar åŒ…</h2><p>å‘½åä¸º .bat æ–‡ä»¶ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹</p><p>æ‰§è¡Œæ—¶ä¼šè¿›è¡Œæ‰“åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">echo ==========================start to install all modules===============================</span><br><span class="line"></span><br><span class="line">if not exist &quot;%M2_HOME%\bin\mvn.cmd&quot; echo Please set the M2_HOME variable in your environment,We need maven! &amp; EXIT /B 2</span><br><span class="line"></span><br><span class="line">set SERVER=common-starter eureka-server config-server device-demo message-system report-system udp-server</span><br><span class="line"></span><br><span class="line">cd %~dp0</span><br><span class="line"></span><br><span class="line">do (</span><br><span class="line">    call mvn clean package</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">timeout /T 3 /NOBREAK</span><br><span class="line"></span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h2 id="1-2-jar-åŒ…ä¼ è¾“"><a href="#1-2-jar-åŒ…ä¼ è¾“" class="headerlink" title="1.2 jar åŒ…ä¼ è¾“"></a>1.2 jar åŒ…ä¼ è¾“</h2><blockquote><p>éœ€è¦å°†æ‰“å¥½çš„jaråŒ… ä»æœ¬åœ°ä¸Šä¼ è‡³ linux æœåŠ¡å™¨çš„ç›®æ ‡ç›®å½•ä¸‹</p></blockquote><p>åœ¨æ­¤ä¹‹å‰éœ€é…ç½®sshæ— å¯†ç ç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ‰“å¼€ windows powershell:</span><br><span class="line">æ‰§è¡Œç”Ÿæˆå¯†é’¥ssh-keygençš„å‘½ä»¤ï¼š</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">é‡åˆ°è¾“å…¥ä¸€è·¯å›è½¦ï¼Œè¿”å›ç”Ÿæˆç§˜é’¥çš„ä½ç½®ï¼šå›è½¦å›è½¦å›è½¦</span><br><span class="line">ä¸Šä¼ ç§˜é’¥åˆ°è¿œç«¯æœåŠ¡å™¨ï¼š</span><br><span class="line">cat ~/.ssh/id_*.pub | ssh  root@hadoop102 &#x27;cat &gt;&gt; .ssh/authorized_keys&#x27;</span><br></pre></td></tr></table></figure><p>åˆ›å»º  .bat æ–‡ä»¶ï¼Œæ‰§è¡Œè¯¥è„šæœ¬ä¼šå°†å¯¹åº”æ–‡ä»¶ç§»åŠ¨åˆ°å¯¹åº”åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo è¿æ¥è¿œç¨‹æœåŠ¡å™¨</span><br><span class="line">scp -r jaråŒ…åœ°å€  root@hadoop102:/opt/XXX/XXXï¼ˆç›®æ ‡åœ°å€ç›®å½•ï¼‰</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h2 id="1-3-æäº¤ä»»åŠ¡åˆ°é›†ç¾¤"><a href="#1-3-æäº¤ä»»åŠ¡åˆ°é›†ç¾¤" class="headerlink" title="1.3 æäº¤ä»»åŠ¡åˆ°é›†ç¾¤"></a>1.3 æäº¤ä»»åŠ¡åˆ°é›†ç¾¤</h2><p>å½“å‰ jar åŒ…å­˜åœ¨æœåŠ¡å™¨ç›®å½•ä¸‹ï¼Œåœ¨ç¡®è®¤å¯åŠ¨äº†é›†ç¾¤å</p><p>åˆ›å»º shell è„šæœ¬ï¼Œæ‰§è¡Œè¯¥è„šæœ¬ä¼šå°† jar åŒ…ä»»åŠ¡æäº¤åˆ° Flink é›†ç¾¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">case $1 in</span><br><span class="line"> &quot;start&quot;)&#123;</span><br><span class="line"> for i in hadoop102</span><br><span class="line"> do</span><br><span class="line">  echo &quot;========== $i ==========&quot;</span><br><span class="line">  ssh $i &quot;/opt/Environment_DataLake/flink-1.13.3/bin/flink run -m hadoop102:8081 -c com.dwc.test.motor /opt/Environment_DataLake/flink-1.13.3/job/DataToLake-1.0-SNAPSHOT.jar&quot;</span><br><span class="line"> done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h1 id="2-Javaè°ƒç”¨è„šæœ¬"><a href="#2-Javaè°ƒç”¨è„šæœ¬" class="headerlink" title="2 Javaè°ƒç”¨è„šæœ¬"></a>2 Javaè°ƒç”¨è„šæœ¬</h1><h2 id="2-1-è°ƒç”¨æœ¬åœ°çš„è„šæœ¬"><a href="#2-1-è°ƒç”¨æœ¬åœ°çš„è„šæœ¬" class="headerlink" title="2.1 è°ƒç”¨æœ¬åœ°çš„è„šæœ¬"></a>2.1 è°ƒç”¨æœ¬åœ°çš„è„šæœ¬</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> dwc</span></span><br><span class="line"><span class="comment"> * .batè„šæœ¬å¯åŠ¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">startbat</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">batPath</span> <span class="operator">=</span> <span class="string">&quot;XXX.bat&quot;</span>; <span class="comment">// ç¬¬ä¸€ä¸ªbatè„šæœ¬è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">batPath2</span> <span class="operator">=</span><span class="string">&quot;XXXX.bat&quot;</span>;  <span class="comment">// ç¬¬äºŒä¸ªbatè„šæœ¬è·¯å¾„</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">batFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(batPath);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">batFileExist</span> <span class="operator">=</span> batFile.exists();</span><br><span class="line">        System.out.println(<span class="string">&quot;batFileExist:&quot;</span> + batFileExist);</span><br><span class="line">        <span class="keyword">if</span> (batFileExist) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šæ­£åœ¨æ‰§è¡Œç¼–è¯‘ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š&quot;</span>);</span><br><span class="line">            callCmd(batPath);</span><br><span class="line">            System.out.println(<span class="string">&quot;ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šæ­£åœ¨ä¸Šä¼ è‡³linuxç³»ç»ŸğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š&quot;</span>);</span><br><span class="line">            callCmd(batPath2);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šbatè„šæœ¬è¿è¡Œå®ŒæˆğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title function_">callCmd</span><span class="params">(String locationCmd)</span>&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Process</span> <span class="variable">child</span> <span class="operator">=</span> Runtime.getRuntime().exec(locationCmd);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> child.getInputStream();</span><br><span class="line">            BufferedReader bufferedReader=<span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span>((line=bufferedReader.readLine())!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sb.append(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            in.close();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                child.waitFor();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(e);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;sb:&quot;</span> + sb.toString());</span><br><span class="line">            System.out.println(<span class="string">&quot;callCmd execute finished&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-è°ƒç”¨è¿œç¨‹linuxè„šæœ¬"><a href="#2-2-è°ƒç”¨è¿œç¨‹linuxè„šæœ¬" class="headerlink" title="2.2 è°ƒç”¨è¿œç¨‹linuxè„šæœ¬"></a>2.2 è°ƒç”¨è¿œç¨‹linuxè„šæœ¬</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ch.ethz.ssh2.Connection;</span><br><span class="line"><span class="keyword">import</span> ch.ethz.ssh2.Session;</span><br><span class="line"><span class="keyword">import</span> ch.ethz.ssh2.StreamGobbler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.calcite.shaded.org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> dwc</span></span><br><span class="line"><span class="comment"> * è¿œç¨‹æ‰§è¡Œlinuxçš„shell script</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteExecuteCommand</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">linuxIP</span> <span class="operator">=</span> <span class="string">&quot;ipåœ°å€&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">usrName</span> <span class="operator">=</span> <span class="string">&quot;ç”¨æˆ·å&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">passwd</span>  <span class="operator">=</span> <span class="string">&quot;å¯†ç &quot;</span>;</span><br><span class="line">        <span class="type">RemoteExecuteCommand</span> <span class="variable">rec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteExecuteCommand</span>(linuxIP, usrName, passwd);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šæ­£åœ¨ä¸Šä¼ ä»»åŠ¡è‡³é›†ç¾¤ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè„šæœ¬</span></span><br><span class="line">        System.out.println(rec.execute(<span class="string">&quot;XXX.shell&quot;</span>));  <span class="comment">//shellè„šæœ¬åœ°å€</span></span><br><span class="line">        <span class="comment">// æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        System.out.println(rec.execute(<span class="string">&quot;jps&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Šjobä¸Šä¼ å®ŒæˆğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—ç¬¦ç¼–ç é»˜è®¤æ˜¯utf-8</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">DEFAULTCHART</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Connection conn;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String userPwd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RemoteExecuteCommand</span><span class="params">(String ip, String userName, String userPwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ip = ip;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">        <span class="built_in">this</span>.userPwd = userPwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿œç¨‹ç™»å½•linuxä¸»æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> V0.1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç™»å½•æˆåŠŸè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">login</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flg</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = <span class="keyword">new</span> <span class="title class_">Connection</span>(ip);</span><br><span class="line">            <span class="comment">// è¿æ¥</span></span><br><span class="line">            conn.connect();</span><br><span class="line">            <span class="comment">// è®¤è¯</span></span><br><span class="line">            flg = conn.authenticateWithPassword(userName, userPwd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;è¿œç¨‹è¿æ¥æœåŠ¡å™¨å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿œç¨‹æ‰§è¡Œshllè„šæœ¬æˆ–è€…å‘½ä»¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cmd å³å°†æ‰§è¡Œçš„å‘½ä»¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å‘½ä»¤æ‰§è¡Œå®Œåè¿”å›çš„ç»“æœå€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> V0.1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">execute</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (login()) &#123;</span><br><span class="line">                <span class="comment">// æ‰“å¼€ä¸€ä¸ªä¼šè¯</span></span><br><span class="line">                session = conn.openSession();</span><br><span class="line">                <span class="comment">// æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">                session.execCommand(cmd);</span><br><span class="line">                result = processStdout(session.getStdout(), DEFAULTCHART);</span><br><span class="line">                <span class="comment">// å¦‚æœä¸ºè¾“å‡ºä¸ºç©ºï¼Œè¯´æ˜è„šæœ¬æ‰§è¡Œå‡ºé”™äº†</span></span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isBlank(result)) &#123;</span><br><span class="line">                    result = processStdout(session.getStderr(), DEFAULTCHART);</span><br><span class="line">                &#125;</span><br><span class="line">                conn.close();</span><br><span class="line">                session.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;å‘½ä»¤æ‰§è¡Œå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (session != <span class="literal">null</span>) &#123;</span><br><span class="line">                session.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æè„šæœ¬æ‰§è¡Œè¿”å›çš„ç»“æœé›†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in è¾“å…¥æµå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> charset ç¼–ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> V0.1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä»¥çº¯æ–‡æœ¬çš„æ ¼å¼è¿”å›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">processStdout</span><span class="params">(InputStream in, String charset)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">stdout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StreamGobbler</span>(in);</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            isr = <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(stdout, charset);</span><br><span class="line">            br = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                buffer.append(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;ä¸æ”¯æŒçš„ç¼–ç å­—ç¬¦é›†å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;è¯»å–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            IOUtils.close(br);</span><br><span class="line">            IOUtils.close(isr);</span><br><span class="line">            IOUtils.close(stdout);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue è½¬ React æŒ‡å—</title>
      <link href="/2023/08/10/Vue%E8%BD%ACReact%E6%8C%87%E5%8D%97/"/>
      <url>/2023/08/10/Vue%E8%BD%ACReact%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h1><p>å…ˆä»‹ç» React å”¯ä¸€çš„ä¸€ä¸ªè¯­æ³•ç³–ï¼šJSXã€‚</p><p>ç†è§£ JSX è¯­æ³•å¹¶ä¸å›°éš¾ï¼Œç®€å•è®°ä½ä¸€å¥è¯ï¼Œé‡åˆ° <code>&#123;&#125;</code> ç¬¦å·å†…éƒ¨è§£æä¸º JS ä»£ç ï¼Œé‡åˆ°æˆå¯¹çš„ <code>&lt;&gt;</code> ç¬¦å·å†…éƒ¨è§£æä¸º HTML ä»£ç ã€‚</p><p>å½“ä½ å†™ä¸‹è¿™ä¸ª React ç»„ä»¶æ—¶ï¼š</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.hello&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šè¢«è‡ªåŠ¨å·¥å…·ç¿»è¯‘æˆï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, <span class="literal">null</span>, props.<span class="property">hello</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React å°±æ˜¯é€šè¿‡è¿™ä¸ªå°å°è¯­æ³•ç³–ï¼Œå®ç°åœ¨ JS é‡Œé¢å†™ HTMLï¼Œå¯èƒ½æœ‰å°ä¼™ä¼´ä¼šè¯´ HTML ä¸ JS åˆ†ç¦»ä¸æ˜¯æ›´å¥½å—ï¼Ÿè´£èŒåˆ†æ˜ï¼Œæ··åˆåªä¼šæ›´ä¹±ã€‚ä½†å½“ä½ ä½“éªŒåˆ°ä»£ç è‡ªåŠ¨æç¤ºï¼Œè‡ªåŠ¨æ£€æŸ¥ï¼Œä»¥åŠè°ƒè¯•æ—¶ç²¾ç¡®å®šä½åˆ°ä¸€è¡Œä»£ç çš„å¥½å¤„æ—¶ï¼Œå°±æ¸…æ¥š React å’Œ Vue çš„å·®è·äº†ã€‚</p><h1 id="æ–‡æœ¬æ’å€¼"><a href="#æ–‡æœ¬æ’å€¼" class="headerlink" title="æ–‡æœ¬æ’å€¼"></a>æ–‡æœ¬æ’å€¼</h1><p><strong>vueç§é‡‡ç”¨åŒæ‹¬å·</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;Message: &#123;&#123; msg &#125;&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure><p><strong>reacté‡‡ç”¨å•æ‹¬å·</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function MyComponent(props) &#123;</span><br><span class="line">    let msg = &#x27;XXX&#x27;</span><br><span class="line">    return &lt;div&gt;&#123; msg &#125;&lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Attribute-ç»‘å®š"><a href="#Attribute-ç»‘å®š" class="headerlink" title="Attribute ç»‘å®š"></a>Attribute ç»‘å®š</h1><p><strong>vueä¸­ æƒ³è¦å“åº”å¼åœ°ç»‘å®šä¸€ä¸ª attributeï¼Œåº”è¯¥ä½¿ç”¨ <code>v-bind</code> æŒ‡ä»¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:id=&quot;dynamicId&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div :id=&quot;dynamicId&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><strong>reactä¸­ï¼Œä½¿ç”¨å•å¼•å·ï¼Œæˆ–è€…ä½¿ç”¨å•æ‹¬å·åŒ…è£¹è¡¨ç¤ºåŠ¨æ€ç»‘å®š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  let tmpID = &#x27;12&#x27;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div id=&#x27;12&#x27;&gt;id&lt;/div&gt;</span><br><span class="line">      &lt;div id=&#123;tmpID&#125;&gt;id&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€ç»‘å®šå¤šå€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  let tmpObject = &#123;</span><br><span class="line">    id: 13,</span><br><span class="line">    className: &#x27;wrapper&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div &#123;...tmpObject&#125;&gt;id&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å³ï¼š</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;13&quot; class=&quot;wrapper&quot;&gt;id&lt;/div&gt;</span><br></pre></td></tr></table></figure><h1 id="å‚æ•°-Arguments"><a href="#å‚æ•°-Arguments" class="headerlink" title="å‚æ•° Arguments"></a>å‚æ•° Arguments</h1><p><strong>æŸäº›æŒ‡ä»¤ä¼šéœ€è¦ä¸€ä¸ªâ€œå‚æ•°â€ï¼ŒVueåœ¨æŒ‡ä»¤ååé€šè¿‡ä¸€ä¸ªå†’å·éš”å¼€åšæ ‡è¯†ã€‚ä¾‹å¦‚ç”¨ <code>v-bind</code> æŒ‡ä»¤</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;a v-bind:href=&quot;url&quot;&gt; ... &lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ç®€å†™ --&gt;</span><br><span class="line">&lt;a :href=&quot;url&quot;&gt; ... &lt;/a&gt;</span><br></pre></td></tr></table></figure><p><strong>Reactä¸­åˆ™æ²¡æœ‰æŒ‡ä»¤ä¸€è¯´ï¼Œè€Œæ˜¯é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// hrefè·³è½¬</span><br><span class="line">function App () &#123;</span><br><span class="line">  let tmpURL = &#x27;https://www.XXXXXXXX&#x27;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;a href=&#123;tmpURL&#125;&gt;&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-JS-è¡¨è¾¾å¼"><a href="#ä½¿ç”¨-JS-è¡¨è¾¾å¼" class="headerlink" title="ä½¿ç”¨ JS è¡¨è¾¾å¼"></a>ä½¿ç”¨ JS è¡¨è¾¾å¼</h1><p><strong>React é‡åˆ° <code>&#123;&#125;</code> ç¬¦å·å†…éƒ¨è§£æä¸º JS ä»£ç </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  let tmpString = &#x27;--&#x27;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div &gt;&#123;1 + 1&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div &gt;&#123;&#x27;a&#x27; + &#x27;b&#x27;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div &gt;&#123;`1$&#123;tmpString&#125;1`&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;2&lt;/div&gt;</span><br><span class="line">&lt;div&gt;ab&lt;/div&gt;</span><br><span class="line">&lt;div&gt;1--1&lt;/div&gt;</span><br></pre></td></tr></table></figure><h1 id="äº‹ä»¶å¤„ç†"><a href="#äº‹ä»¶å¤„ç†" class="headerlink" title="äº‹ä»¶å¤„ç†"></a>äº‹ä»¶å¤„ç†</h1><p><strong>Vueä¸­ç»‘å®šäº‹ä»¶å¤„ç†ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- `greet` æ˜¯ä¸Šé¢å®šä¹‰è¿‡çš„æ–¹æ³•å --&gt;</span><br><span class="line">&lt;button @click=&quot;greet&quot;&gt;Greet&lt;/button&gt;</span><br></pre></td></tr></table></figure><p><strong>Reactå¯ä»¥é€šè¿‡åœ¨ç»„ä»¶ä¸­å£°æ˜ äº‹ä»¶å¤„ç† å‡½æ•°æ¥å“åº”äº‹ä»¶</strong></p><p>Reactä¸­ç‚¹å‡»äº‹ä»¶ä½¿ç”¨å°é©¼å³°å½¢å¼ï¼šonClick</p><p>åœ¨æ ‡ç­¾ä¸Šå†™å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div onClick=&#123;() =&gt; alert(&#x27;ç‚¹å‡»å‡ºç°å¼¹æ¡†&#x27;)&#125;&gt;æŒ‰é’®&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æå‰å£°æ˜å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  function myFun () &#123;</span><br><span class="line">    alert(&#x27;ç‚¹å‡»å‡ºç°å¼¹æ¡†&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div onClick=&#123;myFun&#125;&gt;æŒ‰é’®&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>onClick=&#123;handleClick&#125;</code> çš„ç»“å°¾æ²¡æœ‰å°æ‹¬å·ï¼ä¸è¦ <strong>è°ƒç”¨</strong> äº‹ä»¶å¤„ç†å‡½æ•°ï¼šä½ åªéœ€ <strong>ä¼ é€’ç»™äº‹ä»¶</strong> å³å¯ã€‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼ŒReact ä¼šè°ƒç”¨ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p><p>å‡½æ•°ä¼ å‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  function myFun (str) &#123;</span><br><span class="line">    alert(str)</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div onClick=&#123;() =&gt; myFun(&#x27;ç‚¹å‡»å‡ºç°å¼¹æ¡†&#x27;)&#125;&gt;æŒ‰é’®&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠ¨æ€å‚æ•°"><a href="#åŠ¨æ€å‚æ•°" class="headerlink" title="åŠ¨æ€å‚æ•°"></a>åŠ¨æ€å‚æ•°</h1><p><strong>Vueåœ¨æŒ‡ä»¤å‚æ•°ä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª JavaScript è¡¨è¾¾å¼ï¼Œéœ€è¦åŒ…å«åœ¨ä¸€å¯¹æ–¹æ‹¬å·å†…ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;a v-bind:[attributeName]=&quot;url&quot;&gt; ... &lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ç®€å†™ --&gt;</span><br><span class="line">&lt;a :[attributeName]=&quot;url&quot;&gt; ... &lt;/a&gt;</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ çš„ç»„ä»¶å®ä¾‹æœ‰ä¸€ä¸ªæ•°æ®å±æ€§ <code>attributeName</code>ï¼Œå…¶å€¼ä¸º <code>&quot;href&quot;</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç»‘å®šå°±ç­‰ä»·äº <code>v-bind:href</code>ã€‚</p><p><strong>React ä¹Ÿå¯ä»¥é€šè¿‡åŠ¨æ€å‚æ•°ç»‘å®š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  const obj = &#123;</span><br><span class="line">    onClick: () =&gt; alert(&#x27;ç‚¹å‡»å‡ºç°å¼¹æ¡†&#x27;),</span><br><span class="line">    // ...è¿˜å¯ä»¥å†™æ›´å¤šäº‹ä»¶</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;div &#123;...obj&#125;&gt;æŒ‰é’®&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¿®é¥°ç¬¦-Modifiers"><a href="#ä¿®é¥°ç¬¦-Modifiers" class="headerlink" title="ä¿®é¥°ç¬¦ Modifiers"></a>ä¿®é¥°ç¬¦ Modifiers</h1><p>vue ä¿®é¥°ç¬¦æ˜¯ä»¥ç‚¹å¼€å¤´çš„ç‰¹æ®Šåç¼€</p><p>è¡¨æ˜æŒ‡ä»¤éœ€è¦ä»¥ä¸€äº›ç‰¹æ®Šçš„æ–¹å¼è¢«ç»‘å®šã€‚ä¾‹å¦‚ <code>.prevent</code> ä¿®é¥°ç¬¦ä¼šå‘ŠçŸ¥ <code>v-on</code> æŒ‡ä»¤å¯¹è§¦å‘çš„äº‹ä»¶è°ƒç”¨ <code>event.preventDefault()</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form @submit.prevent=&quot;onSubmit&quot;&gt;...&lt;/form&gt;</span><br></pre></td></tr></table></figure><p>React åˆ™æ˜¯ä¾é äºJSåŸºç¡€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  function onSubmit(e)&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &lt;form onSubmit=&#123;onSubmit&#125;&gt;</span><br><span class="line">        &lt;button type=&#x27;submit&#x27;&gt;&lt;/button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å“åº”å¼"><a href="#å“åº”å¼" class="headerlink" title="å“åº”å¼"></a>å“åº”å¼</h1><p><strong>ä¸ºäº†å®ç°è§†å›¾æ›´æ–°ï¼ŒVUEä¸­å“åº”å¼æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µ</strong></p><p><strong>è€Œ React ä¸­å¹¶æ²¡æœ‰å“åº”å¼è¿™ä¸ªæ¦‚å¿µï¼Œè¦å®ç°è§†å›¾æ›´æ–°ï¼Œéœ€è¦åœ¨ React å¼•å…¥ <code>useState</code></strong></p><p>é€šå¸¸ï¼Œä½ ä¼šå¸Œæœ›ä½ çš„ç»„ä»¶ â€œè®°ä½â€ ä¸€äº›ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥ã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸ä½ æƒ³è®¡ç®—ä¸€ä¸ªæŒ‰é’®è¢«ç‚¹å‡»çš„æ¬¡æ•°ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦åœ¨ä½ çš„ç»„ä»¶ä¸­æ·»åŠ  <strong>state</strong>ã€‚</p><p>é¦–å…ˆï¼Œä» React å¼•å…¥ <code>useState</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &#x27;react&#x27;;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ å¯ä»¥åœ¨ä½ çš„ç»„ä»¶ä¸­å£°æ˜ä¸€ä¸ª <strong>state å˜é‡</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function MyButton() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  // ...</span><br></pre></td></tr></table></figure><p>ä½ å°†ä» <code>useState</code> ä¸­è·å¾—ä¸¤æ ·ä¸œè¥¿ï¼šå½“å‰çš„ stateï¼ˆ<code>count</code>ï¼‰ï¼Œä»¥åŠç”¨äºæ›´æ–°å®ƒçš„å‡½æ•°ï¼ˆ<code>setCount</code>ï¼‰ã€‚ä½ å¯ä»¥ç»™å®ƒä»¬èµ·ä»»ä½•åå­—ï¼Œä½†æŒ‰ç…§æƒ¯ä¾‹ï¼Œéœ€è¦åƒè¿™æ · <code>[something, setSomething]</code> ä¸ºå®ƒä»¬å‘½åã€‚</p><p>ç¬¬ä¸€æ¬¡æ˜¾ç¤ºæŒ‰é’®æ—¶ï¼Œ<code>count</code> çš„å€¼ä¸º <code>0</code>ï¼Œå› ä¸ºä½ æŠŠ <code>0</code> ä¼ ç»™äº† <code>useState()</code>ã€‚å½“ä½ æƒ³æ”¹å˜ state æ—¶ï¼Œè°ƒç”¨ <code>setCount()</code> å¹¶å°†æ–°çš„å€¼ä¼ é€’ç»™å®ƒã€‚ç‚¹å‡»è¯¥æŒ‰é’®è®¡æ•°å™¨å°†é€’å¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function MyButton() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  function handleClick() &#123;</span><br><span class="line">    setCount(count + 1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;button onClick=&#123;handleClick&#125;&gt;</span><br><span class="line">      Clicked &#123;count&#125; times</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React å°†å†æ¬¡è°ƒç”¨ä½ çš„ç»„ä»¶å‡½æ•°ã€‚è¿™æ¬¡ï¼Œ<code>count</code> ä¼šå˜æˆ <code>1</code>ã€‚æ¥ç€ï¼Œå˜æˆ <code>2</code>ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p><p>å¦‚æœä½ å¤šæ¬¡æ¸²æŸ“åŒä¸€ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¼šæ‹¥æœ‰è‡ªå·±çš„ stateã€‚ä½ å¯ä»¥å°è¯•ç‚¹å‡»ä¸åŒçš„æŒ‰é’®ï¼š</p><h1 id="è®¡ç®—å±æ€§"><a href="#è®¡ç®—å±æ€§" class="headerlink" title="è®¡ç®—å±æ€§"></a>è®¡ç®—å±æ€§</h1><p>Vueä¸­ä½¿ç”¨ watch æ¥å®ç°è®¡ç®—å±æ€§ï¼ˆç¼“å­˜è®¡ç®—çš„ç»“æœï¼‰</p><p><strong>React åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ <code>useMemo</code> æ¥ç¼“å­˜æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½éœ€è¦è®¡ç®—çš„ç»“æœ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; useMemo &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">function App () &#123;</span><br><span class="line">  const [user] = useState(&#123; firstname: &#x27;a&#x27;, lastname: &#x27;b&#x27; &#125;)</span><br><span class="line"></span><br><span class="line">  const fullname = useMemo(() =&gt; &#123;</span><br><span class="line">    return user.firstname + user.lastname;</span><br><span class="line">  &#125;, [user.firstname, user.lastname])</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&#x27;App&#x27;&gt;</span><br><span class="line">      &#123;fullname&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>useMemo(calculateValue, dependencies)</strong></p><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><ul><li><code>calculateValue</code>ï¼šè¦ç¼“å­˜è®¡ç®—å€¼çš„å‡½æ•°ã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å‚æ•°çš„çº¯å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä»»æ„ç±»å‹ã€‚React å°†ä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶è°ƒç”¨è¯¥å‡½æ•°ï¼›åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼Œå¦‚æœ <code>dependencies</code> æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒReact å°†ç›´æ¥è¿”å›ç›¸åŒå€¼ã€‚å¦åˆ™ï¼Œå°†ä¼šå†æ¬¡è°ƒç”¨ <code>calculateValue</code> å¹¶è¿”å›æœ€æ–°ç»“æœï¼Œç„¶åç¼“å­˜è¯¥ç»“æœä»¥ä¾¿ä¸‹æ¬¡é‡å¤ä½¿ç”¨ã€‚</li><li><code>dependencies</code>ï¼šæ‰€æœ‰åœ¨ <code>calculateValue</code> å‡½æ•°ä¸­ä½¿ç”¨çš„å“åº”å¼å˜é‡ç»„æˆçš„æ•°ç»„ã€‚å“åº”å¼å˜é‡åŒ…æ‹¬ propsã€state å’Œæ‰€æœ‰ä½ ç›´æ¥åœ¨ç»„ä»¶ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°ã€‚å¦‚æœä½ åœ¨ä»£ç æ£€æŸ¥å·¥å…·ä¸­ <a href="https://react.docschina.org/learn/editor-setup#linting">é…ç½®äº† React</a>ï¼Œå®ƒå°†ä¼šç¡®ä¿æ¯ä¸€ä¸ªå“åº”å¼æ•°æ®éƒ½è¢«æ­£ç¡®åœ°å®šä¹‰ä¸ºä¾èµ–é¡¹ã€‚ä¾èµ–é¡¹æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯å›ºå®šçš„å¹¶ä¸”å¿…é¡»å†™æˆ <code>[dep1, dep2, dep3]</code> è¿™ç§å½¢å¼ã€‚React ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> å°†æ¯ä¸ªä¾èµ–é¡¹ä¸å…¶ä¹‹å‰çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚</li></ul><h1 id="ç»‘å®š-HTML-class"><a href="#ç»‘å®š-HTML-class" class="headerlink" title="ç»‘å®š HTML class"></a>ç»‘å®š HTML class</h1><p>æ•°æ®ç»‘å®šçš„ä¸€ä¸ªå¸¸è§éœ€æ±‚åœºæ™¯æ˜¯æ“çºµå…ƒç´ çš„ CSS class åˆ—è¡¨å’Œå†…è”æ ·å¼ã€‚å› ä¸º <code>class</code> å’Œ <code>style</code> éƒ½æ˜¯ attribute</p><p>Vueä¸­å¯ä»¥ç»™ <code>:class</code> (<code>v-bind:class</code> çš„ç¼©å†™) ä¼ é€’ä¸€ä¸ªå¯¹è±¡æ¥åŠ¨æ€åˆ‡æ¢ classï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div :class=&quot;&#123; active: isActive &#125;&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¯­æ³•è¡¨ç¤º <code>active</code> æ˜¯å¦å­˜åœ¨å–å†³äºæ•°æ®å±æ€§ <code>isActive</code> çš„çœŸå‡å€¼ã€‚</p><p>Reactå®ç°æ–¹å¼åŸºäºjsè¯­æ³•ï¼Œå…¶å®æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œåˆ—ä¸¾ä¸‰å…ƒè¿ç®—ç¬¦æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  let showColor = false</span><br><span class="line">  return (</span><br><span class="line">    // ç°æœ‰box-showã€box-hideä¸¤ä¸ªclassæ ·å¼</span><br><span class="line">    &lt;div className=&#123;showColor ? &#x27;box-show&#x27; : &#x27;box-hide&#x27;&#125;&gt;&lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¯­æ³•ç³–è½¬æ¢"><a href="#è¯­æ³•ç³–è½¬æ¢" class="headerlink" title="è¯­æ³•ç³–è½¬æ¢"></a>è¯­æ³•ç³–è½¬æ¢</h1><p>ä¹ æƒ¯ Vue çš„åŒå­¦éƒ½çŸ¥é“å¾ˆå¤šè¯­æ³•ç³–ï¼Œæ¯”å¦‚ <code>v-if</code>ã€<code>v-for</code>ã€<code>v-bind</code>ã€<code>v-on</code> ç­‰ï¼Œç›¸æ¯” Vueï¼ŒReact åªæœ‰ä¸€ä¸ªè¯­æ³•ç³–ï¼Œé‚£å°±æ˜¯ jsx&#x2F;tsxã€‚<code>v-if</code> è¿™äº›åŠŸèƒ½åœ¨ React ä¸Šéƒ½æ˜¯é€šè¿‡åŸç”Ÿ javascript å®ç°çš„ï¼Œæ…¢æ…¢ä½ ä¼šå‘ç°ï¼Œå…¶å®ä½ å­¦çš„ä¸æ˜¯ Reactï¼Œè€Œæ˜¯ Javasciptï¼ŒReact èµ‹äºˆä½ é€šè¿‡ js å®Œæ•´æ§åˆ¶ç»„ä»¶çš„èƒ½åŠ›ï¼Œè¿™éƒ¨åˆ†æ˜æ˜¾æ¯” Vue çš„è¯­æ³•ç³–æ›´åŠ çµæ´»ï¼Œç³–å¤ªå¤šå®¹æ˜“å¼•æ¥è™«å­ï¼ˆBugï¼‰</p><h2 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h2><p>vue ä¸­å†™æ³•æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;h1 v-if=&quot;ishow&quot;&gt;Vue is awesome!&lt;/h1&gt;</span><br><span class="line">    &lt;h1 v-else&gt;else&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ React å‡½æ•°ç»„ä»¶ä¸­ï¼Œåªéœ€ä½¿ç”¨ js ä¸‰ç›®è¿ç®—ç¬¦è¯­æ³•å³å¯å®Œæˆæ¡ä»¶æ¸²æŸ“çš„åŠŸèƒ½ã€‚æˆ–è€…ä½¿ç”¨ &amp;&amp; é€»è¾‘ï¼Œè®°ä½ä¸‹é¢ä¸€å¥è¯å°±èƒ½è¿‡ç†è§£äº†ï¼š</p><blockquote><p>é‡åˆ° <code>&#123;&#125;</code> ç¬¦å·å†…éƒ¨è§£æä¸º JS ä»£ç ï¼Œé‡åˆ°æˆå¯¹çš„ <code>&lt;&gt;</code> ç¬¦å·å†…éƒ¨è§£æä¸º HTML ä»£ç </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  const ishow = false</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;ishow ? &lt;div&gt;awesome&lt;/div&gt; : &lt;div&gt;else&lt;/div&gt;&#125;</span><br><span class="line">      &#123;ishow &amp;&amp; &lt;h1&gt;React!&lt;/h1&gt;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ—è¡¨æ¸²æŸ“"><a href="#åˆ—è¡¨æ¸²æŸ“" class="headerlink" title="åˆ—è¡¨æ¸²æŸ“"></a>åˆ—è¡¨æ¸²æŸ“</h2><p>Vueä¸­é€šè¿‡v-forè¿›è¡Œåˆ—è¡¨æ¸²æŸ“</p><p><strong>React é€šè¿‡ js çš„æ•°ç»„è¯­æ³• mapï¼Œå°†æ•°æ®å¯¹è±¡æ˜ å°„ä¸º DOM å¯¹è±¡</strong>ã€‚åªéœ€å­¦ä¼š jsï¼Œæ— éœ€è®°ä½å„ç§æŒ‡ä»¤ï¼Œå¦‚æœè¦åšåˆ—è¡¨è¿‡æ»¤ï¼Œç›´æ¥ä½¿ç”¨ <code>items.filter(...).map(...)</code> é“¾å¼è°ƒç”¨å³å¯ï¼Œè¯­æ³•ä¸Šæ›´åŠ çµæ´»ï¼Œå¦‚æœä¸ºäº†æé«˜æ¸²æŸ“æ€§èƒ½ï¼Œä½¿ç”¨ useMemo è¿›è¡Œä¼˜åŒ–å³å¯ï¼Œç±»ä¼¼ Vue çš„ computedã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  const arr = [&#123; message: &#x27;react&#x27; &#125;, &#123; message: &#x27;JS&#x27; &#125;]</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;arr.map((items, index) =&gt; &lt;li key=&#123;index&#125;&gt;&#123;items.message&#125;&lt;/li&gt;)&#125;</span><br><span class="line">    &lt;/div &gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¾¦å¬å™¨"><a href="#ä¾¦å¬å™¨" class="headerlink" title="ä¾¦å¬å™¨"></a>ä¾¦å¬å™¨</h1><p>Vueä¸­ä½¿ç”¨ watchç›‘å¬æ•°æ®å˜åŒ–ï¼Œè§¦å‘å›è°ƒ</p><p>Reactä¸­å¯ä»¥ä½¿ç”¨ useEffect å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function App () &#123;</span><br><span class="line">  const [user, setUser] = useState(&#123;</span><br><span class="line">    firstname: &#x27;a&#x27;,</span><br><span class="line">    lastname: &#x27;b&#x27;</span><br><span class="line">  &#125;)</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;1111&quot;)</span><br><span class="line">  &#125;, [user.firstname])</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setUser(&#123; ...user, firstname: &#x27;a2&#x27; &#125;)&#125;&gt;&lt;/button&gt;</span><br><span class="line">    &lt;/div &gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> React </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•</title>
      <link href="/2023/08/03/N%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD%E7%9A%84%E6%96%B9%E6%B3%95/"/>
      <url>/2023/08/03/N%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD%E7%9A%84%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-è¡Œå†…å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­"><a href="#1-è¡Œå†…å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­" class="headerlink" title="1 è¡Œå†…å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­"></a>1 è¡Œå†…å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­</h1><h2 id="1-1-å•è¡Œæ–‡æœ¬"><a href="#1-1-å•è¡Œæ–‡æœ¬" class="headerlink" title="1.1 å•è¡Œæ–‡æœ¬"></a>1.1 å•è¡Œæ–‡æœ¬</h2><p>è¦å®ç°è¡Œå†…å…ƒç´ çš„æ°´å¹³å±…ä¸­ï¼Œåªéœ€æŠŠè¡Œå†…å…ƒç´ åŒ…è£¹åœ¨å—çº§çˆ¶å±‚å…ƒç´ ä¸­ï¼Œå¹¶ä¸”åœ¨çˆ¶å±‚å…ƒç´ CSSè®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>center<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: aqua;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;   <span class="comment">/* æ–‡æœ¬æ°´å¹³å±…ä¸­ */</span></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">200px</span>;  <span class="comment">/* æ–‡æœ¬å‚ç›´å±…ä¸­ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/08/03/Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•/1.1.jpg" style="height: 150px; width: 300px;"></div><p>ç®€å•ä½†æ˜¯æœ‰ç¼ºç‚¹ï¼š<strong>åªé€‚åº”å•è¡Œæ–‡æœ¬</strong></p><p>å¦‚æœæœ‰å¤šè¡Œæ–‡æœ¬ï¼Œæ— æ³•æ°´å¹³å‚ç›´å±…ä¸­</p><h2 id="1-2-å¤šè¡Œæ–‡æœ¬"><a href="#1-2-å¤šè¡Œæ–‡æœ¬" class="headerlink" title="1.2 å¤šè¡Œæ–‡æœ¬"></a>1.2 å¤šè¡Œæ–‡æœ¬</h2><h3 id="flexå¸ƒå±€"><a href="#flexå¸ƒå±€" class="headerlink" title="flexå¸ƒå±€"></a>flexå¸ƒå±€</h3><p>å¤šè¡Œæ–‡æœ¬ï¼Œä½¿ç”¨flexå¸ƒå±€ï¼Œè®¾ç½®ä¸»è½´å’Œäº¤å‰è½´çš„å¯¹é½æ–¹å¼å°±å¯ä»¥äº†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>center555 okkk breakall alllbrake someyook oolmols looltheboy intergefer asda <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: aqua;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;  <span class="comment">/* è®¾ç½®æ–‡æœ¬æ¢è¡Œ ï¼ˆå…è®¸å•è¯å†…æ¢è¡Œï¼‰ */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>:center;   <span class="comment">/* æ°´å¹³å±…ä¸­: è®¾ç½®äº¤å‰è½´(å‚ç›´æ–¹å‘)æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼ */</span></span><br><span class="line">  <span class="attribute">justify-content</span>: center;  <span class="comment">/* å‚ç›´å±…ä¸­ï¼šè®¾ç½®åœ¨ä¸»è½´(æ¨ªè½´)ä¸Šçš„å¯¹é½æ–¹å¼ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/08/03/Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•/1.2.jpg" style="height: 150px; width: 300px;"></div><h3 id="gridå¸ƒå±€"><a href="#gridå¸ƒå±€" class="headerlink" title="gridå¸ƒå±€"></a>gridå¸ƒå±€</h3><p>ä¹Ÿå¯ä»¥ä½¿ç”¨gridå¸ƒå±€ï¼Œè®¾ç½®å•å…ƒæ ¼å†…å®¹çš„ æ°´å¹³å‚ç›´ä½ç½®</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>center555 okkk breakall alllbrake someyook oolmols looltheboy intergefer asda <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: aqua;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">word-break</span>: break-all;  <span class="comment">/* è®¾ç½®æ–‡æœ¬æ¢è¡Œ ï¼ˆå…è®¸å•è¯å†…æ¢è¡Œï¼‰ */</span></span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  justify-self: center;   <span class="comment">/* è®¾ç½®å•å…ƒæ ¼å†…å®¹çš„ æ°´å¹³ä½ç½® */</span></span><br><span class="line">  <span class="attribute">align-self</span>:center <span class="comment">/* è®¾ç½®å•å…ƒæ ¼å†…å®¹çš„ å‚ç›´ä½ç½® */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2-å—çº§å…ƒç´ "><a href="#2-å—çº§å…ƒç´ " class="headerlink" title="2 å—çº§å…ƒç´ "></a>2 å—çº§å…ƒç´ </h1><h2 id="2-1-å—çŠ¶å…ƒç´ æ°´å¹³å±…ä¸­"><a href="#2-1-å—çŠ¶å…ƒç´ æ°´å¹³å±…ä¸­" class="headerlink" title="2.1 å—çŠ¶å…ƒç´ æ°´å¹³å±…ä¸­"></a>2.1 å—çŠ¶å…ƒç´ æ°´å¹³å±…ä¸­</h2><p>è¦å®ç°å—çŠ¶å…ƒç´ ï¼ˆdisplay:blockï¼‰çš„æ°´å¹³å±…ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒçš„å·¦å³å¤–è¾¹è· margin-left å’Œ margin-right è®¾ç½®ä¸º autoï¼Œå³å¯å®ç°å—çŠ¶å…ƒç´ çš„å±…ä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: aqua;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">margin</span>:<span class="number">0</span> auto;  <span class="comment">/* å—çº§å…ƒç´ æ°´å¹³å±…ä¸­ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/08/03/Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•/2.1.jpg" style="height: 150px; width: 700px;"></div><h2 id="2-2-å—çŠ¶å…ƒç´ æ°´å¹³å‚ç›´å±…ä¸­"><a href="#2-2-å—çŠ¶å…ƒç´ æ°´å¹³å‚ç›´å±…ä¸­" class="headerlink" title="2.2 å—çŠ¶å…ƒç´ æ°´å¹³å‚ç›´å±…ä¸­"></a>2.2 å—çŠ¶å…ƒç´ æ°´å¹³å‚ç›´å±…ä¸­</h2><h3 id="åˆ©ç”¨ç»å¯¹å®šä½ä¸transform"><a href="#åˆ©ç”¨ç»å¯¹å®šä½ä¸transform" class="headerlink" title="åˆ©ç”¨ç»å¯¹å®šä½ä¸transform"></a>åˆ©ç”¨ç»å¯¹å®šä½ä¸transform</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: aqua; width: 200px; height: 200px;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>csså‰3è¡Œä»£ç ï¼Œä½¿å¾—å…ƒç´ çš„å·¦ä¸Šè§’ç‚¹ä½äºæ°´å¹³å‚ç›´å±…ä¸­</p><p>translate() è¿™ä¸ª CSS å‡½æ•°åœ¨æ°´å¹³å’Œ&#x2F;æˆ–å‚ç›´æ–¹å‘ä¸Šé‡æ–°å®šä½å…ƒç´ ï¼Œç§»åŠ¨å…ƒç´ çš„å®½é«˜çš„ä¸€åŠ</p><p>ä½¿å¾—æ•´ä¸ªå…ƒç´ æ°´å¹³å‚ç›´å±…ä¸­</p><div align="center">    <img src="/2023/08/03/Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•/2.2.jpg" style="height: 200px; width: 200px;"></div><h3 id="åˆ©ç”¨ç»å¯¹å®šä½ä¸margin"><a href="#åˆ©ç”¨ç»å¯¹å®šä½ä¸margin" class="headerlink" title="åˆ©ç”¨ç»å¯¹å®šä½ä¸margin"></a>åˆ©ç”¨ç»å¯¹å®šä½ä¸margin</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: aqua; width: 200px; height: 200px;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>:absolute;</span><br><span class="line">  <span class="attribute">margin</span>:auto;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-å¤šä¸ªå—çŠ¶å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­"><a href="#2-3-å¤šä¸ªå—çŠ¶å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­" class="headerlink" title="2.3 å¤šä¸ªå—çŠ¶å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­"></a>2.3 å¤šä¸ªå—çŠ¶å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­</h2><h3 id="flexå¸ƒå±€ï¼š"><a href="#flexå¸ƒå±€ï¼š" class="headerlink" title="flexå¸ƒå±€ï¼š"></a>flexå¸ƒå±€ï¼š</h3><p>ä½¿ç”¨flexå¸ƒå±€ï¼Œå®šä¹‰é¡¹ç›®åœ¨<strong>ä¸»è½´&#x2F;äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼</strong></p><p>ä½¿ç”¨flexå¸ƒå±€ï¼Œæ— éœ€ç»å¯¹å®šä½ç­‰æ”¹å˜å¸ƒå±€çš„æ“ä½œï¼Œå¯ä»¥<strong>è½»æ¾</strong>å®ç°å…ƒç´ çš„æ°´å¹³å‚ç›´å±…ä¸­</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: aqua; width: 1400px; height: 200px;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: wheat; height: 100px; width: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: white; height: 100px; width: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>  <span class="attr">style</span>=<span class="string">&quot;background-color: violet; height: 100px; width: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/08/03/Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•/2.3.jpg" style="height: 150px; width: 600px;"></div><h3 id="gridå¸ƒå±€ï¼š"><a href="#gridå¸ƒå±€ï¼š" class="headerlink" title="gridå¸ƒå±€ï¼š"></a>gridå¸ƒå±€ï¼š</h3><p>å®¹å™¨è®¾ç½®ä¸ºgridå¸ƒå±€åï¼Œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: aqua; width: 1400px; height: 500px;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: wheat; height: 100px; width: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: white; height: 100px; width: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>  <span class="attr">style</span>=<span class="string">&quot;background-color: violet; height: 100px; width: 100px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="comment">/* åˆ’åˆ†åˆ— 3åˆ— å„200px */</span></span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">200px</span> <span class="number">200px</span>; </span><br><span class="line">  <span class="comment">/* å®¹å™¨ä½ç½® æ°´å¹³å‚ç›´å±…ä¸­ */</span></span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="comment">/* å•å…ƒæ ¼çš„å†…å®¹ å±…ä¸­ */</span></span><br><span class="line">  justify-self: center;</span><br><span class="line">  <span class="attribute">align-self</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/08/03/Nä¸ªå®ç°æ°´å¹³å‚ç›´å±…ä¸­çš„æ–¹æ³•/2.3.2.jpg" style="height: 280px; width: 680px;"></div>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æºç (6)ï¼šä¾¦å¬å™¨åŸç†</title>
      <link href="/2023/07/23/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E4%BE%A6%E5%90%AC%E5%99%A8%E5%8E%9F%E7%90%86/"/>
      <url>/2023/07/23/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E4%BE%A6%E5%90%AC%E5%99%A8%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>watchçš„æºç åŸç†å±äºæ¯”è¾ƒç®€å•æ¸…æ™°çš„äº†</p><p>å½“ç„¶è¦ç†è§£è¿˜éœ€è¦é…åˆå‰é¢å‡ ç¯‡ï¼šä¾èµ–æ”¶é›†ã€æ´¾å‘æ›´æ–°ã€æ•°æ®åŠ«æŒ</p><h1 id="1-watchçš„å…¥å£"><a href="#1-watchçš„å…¥å£" class="headerlink" title="1 watchçš„å…¥å£"></a>1 watchçš„å…¥å£</h1><blockquote><p>æºç ä½ç½®ï¼švue-main\src\core\instance\state.ts</p></blockquote><p>initState() æ–¹æ³•ä¸­ï¼Œåˆ¤æ–­ opts.watch å¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ initWatch è¿›è¡Œç›‘å¬å™¨åˆå§‹åŒ–</p><h1 id="2-åˆ›å»º-user-Watcher"><a href="#2-åˆ›å»º-user-Watcher" class="headerlink" title="2 åˆ›å»º user Watcher"></a>2 åˆ›å»º user Watcher</h1><p>é¦–å…ˆ Vue ä¸­å®šä¹‰äº† 3 ä¸ª watcher</p><ul><li>render watcherï¼šæ¨¡æ¿ä¾èµ–å¹¶ä¸”éœ€è¦æ˜¾ç¤ºåœ¨è§†å›¾ä¸Šå˜é‡ï¼Œå…¶å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ª render watcher</li><li>computed watcherï¼šè®¡ç®—å±æ€§å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ª computed watcher</li><li>user watcherï¼šä½¿ç”¨ watch ä¾¦å¬çš„å±æ€§å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ª user watcher</li></ul><p>user watcher å°±æ˜¯ä¾¦å¬å™¨åˆ›å»ºçš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯æ€æ ·å®ç°çš„</p><h2 id="2-1-watchçš„å†™æ³•"><a href="#2-1-watchçš„å†™æ³•" class="headerlink" title="2.1 watchçš„å†™æ³•"></a>2.1 watchçš„å†™æ³•</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£ watch çš„å‡ ç§å†™æ³•</p><p>æ•°ç»„å†™æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="attr">firstname</span>: [</span><br><span class="line">      <span class="function">(<span class="params">newValue,oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">(<span class="params">newValue,oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²å†™æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="title function_">firstname</span>(<span class="params">newValue,oldValue</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue, oldValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="2-2-initWatch-åˆå§‹åŒ–"><a href="#2-2-initWatch-åˆå§‹åŒ–" class="headerlink" title="2.2 initWatch åˆå§‹åŒ–"></a>2.2 initWatch åˆå§‹åŒ–</h2><p>è¿™é‡Œç”¨æ¥<strong>åˆ¤æ–­ watchä¾¦å¬å™¨ çš„ç±»å‹</strong></p><ul><li>å¦‚æœæ˜¯æ•°ç»„å½¢å¼ï¼Œåˆ™éå†ï¼Œä¾æ¬¡åˆ›å»º Wacther</li><li>å¦åˆ™ï¼Œç›´æ¥åˆ›å»º Wacther</li></ul><p>çœ‹çœ‹æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initWatch</span>(<span class="params">vm: Component, watch: <span class="built_in">Object</span></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> watch) &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = watch[key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isArray</span>(handler)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; handler.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="title function_">createWatcher</span>(vm, key, handler[i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">createWatcher</span>(vm, key, handler)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-åˆ›å»º-Watcher"><a href="#2-3-åˆ›å»º-Watcher" class="headerlink" title="2.3 åˆ›å»º Watcher"></a>2.3 åˆ›å»º Watcher</h2><ul><li>ç¬¬ä¸€æ­¥ï¼Œé¦–å…ˆ <strong>æ‹¿åˆ°ä¾¦å¬å™¨çš„å›è°ƒå‡½æ•° handler</strong></li><li>ç¬¬äºŒæ­¥ï¼Œå°† å›è°ƒå‡½æ•° handler ä½œä¸ºå‚æ•°ï¼Œ<strong>å»åˆ›å»º Watcher</strong></li></ul><p>ç¬¬ä¸€æ­¥ï¼š</p><p>createWatcher() æ–¹æ³•ä¸­æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createWatcher</span>(<span class="params"></span></span><br><span class="line"><span class="params">  vm: Component,</span></span><br><span class="line"><span class="params">  expOrFn: string | (() =&gt; any),</span></span><br><span class="line"><span class="params">  handler: any,</span></span><br><span class="line"><span class="params">  options?: <span class="built_in">Object</span></span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(handler)) &#123;</span><br><span class="line">    options = handler</span><br><span class="line">    handler = handler.<span class="property">handler</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å›è°ƒæ˜¯å­—ç¬¦ä¸²çš„æƒ…å†µ</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> handler === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    handler = vm[handler]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å»åˆ›å»º Watcher</span></span><br><span class="line">  <span class="keyword">return</span> vm.$watch(expOrFn, handler, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå›è°ƒæ˜¯å­—ç¬¦ä¸²çš„æƒ…å†µ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line"><span class="title function_">myFn</span>(<span class="params">newValue, oldValue</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;changed&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line"><span class="attr">firstname</span>: <span class="string">&#x27;myFn&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼š</p><p>ç„¶åä¼šæ‰§è¡Œ <strong>vmä¸Šçš„$watch</strong>ï¼Œ <strong>å»åˆ›å»º Watcher</strong></p><blockquote><p>æºç ä½ç½®ï¼švue-main\src\core\instance\state.ts</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// userç½®ä¸ºtrue è¡¨ç¤ºåˆ›å»ºç›‘å¬å™¨çš„watcher</span></span><br><span class="line">options.<span class="property">user</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// åˆ›å»ºåˆ›å»ºç›‘å¬å™¨çš„watcher</span></span><br><span class="line"><span class="keyword">const</span> watcher = <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, expOrFn, cb, options) <span class="comment">// expOrFnæ˜¯å‡½æ•°å cbæ˜¯å›è°ƒå‡½æ•°</span></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œuser Watcher å°±åˆ›å»ºå¥½äº†</p><h1 id="3-åˆå§‹åŒ–å’Œæ›´æ–°"><a href="#3-åˆå§‹åŒ–å’Œæ›´æ–°" class="headerlink" title="3 åˆå§‹åŒ–å’Œæ›´æ–°"></a>3 åˆå§‹åŒ–å’Œæ›´æ–°</h1><h2 id="3-1-åˆå§‹åŒ–"><a href="#3-1-åˆå§‹åŒ–" class="headerlink" title="3.1 åˆå§‹åŒ–"></a>3.1 åˆå§‹åŒ–</h2><p>å½“æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨äº† watchä¾¦å¬å™¨</p><p>ç»è¿‡åˆå§‹åŒ–åï¼Œåˆ›å»ºå¥½äº† user Watcher</p><p>ç»è¿‡ä¸Šé¢çš„æµç¨‹åï¼Œæœ€ç»ˆä¼šè¿›å…¥ <code>new Watcher</code> çš„é€»è¾‘ï¼Œè¿™é‡Œé¢ä¹Ÿæ˜¯ä¾èµ–æ”¶é›†å’Œæ›´æ–°çš„è§¦å‘ç‚¹</p><p>Watcher ä¼šé»˜è®¤è°ƒç”¨ <strong>get()</strong> æ–¹æ³•ï¼Œ<strong>è¿™æ˜¯ watcher æ±‚å€¼çš„æ™®éæ–¹æ³•</strong></p><ul><li>é¦–å…ˆ pushTarget  å°†å½“å‰çš„ user Watcher æŒ‚åˆ° <code>Dep.target</code> ä¸Šã€‚</li><li>ç„¶åè°ƒç”¨ <code>getter</code> å‡½æ•°ï¼Œ<strong>åšä¾èµ–æ”¶é›†ï¼Œæ‹¿åˆ°æ–°å€¼</strong></li><li>æœ€å popTarget() å¼¹å‡º</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm)  <span class="comment">// è°ƒç”¨å‡½æ•°</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: any) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, vm, <span class="string">`getter for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// &quot;touch&quot; every property so they are all tracked as</span></span><br><span class="line">      <span class="comment">// dependencies for deep watching</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123;</span><br><span class="line">        <span class="title function_">traverse</span>(value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">popTarget</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">cleanupDeps</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-æ›´æ–°"><a href="#3-2-æ›´æ–°" class="headerlink" title="3.2 æ›´æ–°"></a>3.2 æ›´æ–°</h2><p>å½“ä¿®æ”¹ä¾¦å¬çš„å±æ€§å</p><p>æ•°æ®åŠ«æŒä¼šè§¦å‘ set</p><p>å› ä¸ºå‰é¢åšè¿‡ä¾èµ–æ”¶é›†äº†ï¼Œåœ¨æ´¾å‘æ›´æ–°æ—¶ï¼Œä¼šé€šçŸ¥ user Watcher æ‰§è¡Œ updateï¼ˆæœ€ç»ˆä¼šæ‰§è¡Œrunæ–¹æ³•ï¼‰</p><p>run() æ–¹æ³•ä¸­ï¼š</p><ul><li>ä¼šè§¦å‘ get() å–æ–°å€¼ <strong>value</strong></li><li>å¹¶ç¼“å­˜æ—§å€¼ <strong>oldValue</strong></li><li>æœ€åè§¦å‘å›è°ƒå‡½æ•° <strong>cb</strong></li></ul><p>run() æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">    <span class="comment">// æ‹¿åˆ°æ–°å€¼</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      value !== <span class="variable language_">this</span>.<span class="property">value</span> ||</span><br><span class="line">      <span class="comment">// Deep watchers and watchers on Object/Arrays should fire even</span></span><br><span class="line">      <span class="comment">// when the value is the same, because the value may</span></span><br><span class="line">      <span class="comment">// have mutated.</span></span><br><span class="line">      <span class="title function_">isObject</span>(value) ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="comment">// ç¼“å­˜æ—§å€¼</span></span><br><span class="line">      <span class="keyword">const</span> oldValue = <span class="variable language_">this</span>.<span class="property">value</span></span><br><span class="line">      <span class="comment">// èµ‹äºˆæ–°å€¼</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">      <span class="comment">// è§¦å‘å›è°ƒå‡½æ•° cb</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> info = <span class="string">`callback for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span></span><br><span class="line">        <span class="title function_">invokeWithErrorHandling</span>(</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">cb</span>,</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">vm</span>,</span><br><span class="line">          [value, oldValue],</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">vm</span>,</span><br><span class="line">          info</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-æ·±åº¦ç›‘å¬"><a href="#4-æ·±åº¦ç›‘å¬" class="headerlink" title="4 æ·±åº¦ç›‘å¬"></a>4 æ·±åº¦ç›‘å¬</h1><p>æ·±åº¦ç›‘å¬æ˜¯ <code>watch</code> ç›‘å¬ä¸­ä¸€é¡¹å¾ˆé‡è¦çš„é…ç½®ï¼Œå®ƒèƒ½ä¸ºæˆ‘ä»¬è§‚å¯Ÿå¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå±æ€§çš„å˜åŒ–ã€‚</p><p>ç›®å…‰å†æ‹‰å›åˆ° <strong>get()</strong> å‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸€æ®µä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123;</span><br><span class="line">  <span class="title function_">traverse</span>(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>traverseæ–¹æ³•æºç ä½ç½®ï¼š&#x2F;src&#x2F;core&#x2F;observer&#x2F;traverse.js</p></blockquote><p>å®ƒä¸»è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼š</p><p>é€’å½’è·å–æ¯ä¸€é¡¹å±æ€§ï¼Œè§¦å‘å®ƒä»¬çš„â€œæ•°æ®åŠ«æŒ<code>get</code>â€æ”¶é›†ä¾èµ–</p>]]></content>
      
      
      <categories>
          
          <category> æºç è§£æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æºç (5)ï¼šè®¡ç®—å±æ€§åŸç†</title>
      <link href="/2023/07/23/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%8E%9F%E7%90%86/"/>
      <url>/2023/07/23/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>å†…å¿ƒæ—ç™½ï¼šè®¡ç®—å±æ€§æœ‰ç‚¹ç»•å‘€ï¼Œçœ‹äº†å¥½å‡ éäº†</p><h1 id="1-è®¡ç®—å±æ€§"><a href="#1-è®¡ç®—å±æ€§" class="headerlink" title="1 è®¡ç®—å±æ€§"></a>1 è®¡ç®—å±æ€§</h1><p>é¦–å…ˆ Vue ä¸­å®šä¹‰äº† 3 ä¸ª watcher</p><ul><li>render watcherï¼šæ¨¡æ¿ä¾èµ–å¹¶ä¸”éœ€è¦æ˜¾ç¤ºåœ¨è§†å›¾ä¸Šå˜é‡ï¼Œå…¶å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ª render watcher</li><li>computed watcherï¼šè®¡ç®—å±æ€§å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ª computed watcher</li><li>user watcherï¼šä½¿ç”¨ watch ä¾¦å¬çš„å±æ€§å†…éƒ¨ä¿å­˜äº†ä¸€ä¸ª user watcher</li></ul><p>render watcher ä¹‹å‰çš„æ–‡ç« å·²ç»åˆ†æè¿‡äº†</p><p>ä¸‹é¢ä¼šåˆ†æä¸€ä¸‹ computed watcher çš„å®ç°åŸç†</p><h1 id="2-è®¡ç®—å±æ€§çš„å®ç°"><a href="#2-è®¡ç®—å±æ€§çš„å®ç°" class="headerlink" title="2 è®¡ç®—å±æ€§çš„å®ç°"></a>2 è®¡ç®—å±æ€§çš„å®ç°</h1><p>ä¸€ä¸ªè®¡ç®—å±æ€§çš„å®ç°åˆ†ä¸º2éƒ¨åˆ†</p><ul><li>å®ä¾‹åŒ–ä¸€ä¸ª computed watcher</li><li>å®šä¹‰è®¡ç®—å±æ€§çš„ getter å‡½æ•°</li></ul><h2 id="2-1-åˆ›å»º-computed-watcher"><a href="#2-1-åˆ›å»º-computed-watcher" class="headerlink" title="2.1 åˆ›å»º computed watcher"></a>2.1 åˆ›å»º computed watcher</h2><h3 id="2-1-1-è®¡ç®—å±æ€§çš„ä¸¤ç§å†™æ³•çš„å·®å¼‚"><a href="#2-1-1-è®¡ç®—å±æ€§çš„ä¸¤ç§å†™æ³•çš„å·®å¼‚" class="headerlink" title="2.1.1 è®¡ç®—å±æ€§çš„ä¸¤ç§å†™æ³•çš„å·®å¼‚"></a>2.1.1 è®¡ç®—å±æ€§çš„ä¸¤ç§å†™æ³•çš„å·®å¼‚</h3><p>é¦–å…ˆè®¡ç®—å±æ€§æœ‰ä¸¤ç§å†™æ³•ï¼šç›´æ¥å†™ä¸º function å’Œ å®Œæ•´å†™æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// definePropertyä¸­çš„getæ–¹æ³•</span></span><br><span class="line">    fullname () &#123; </span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstname</span> + <span class="variable language_">this</span>.<span class="property">lastname</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®Œæ•´å†™æ³•</span></span><br><span class="line">    <span class="attr">fullname</span>:&#123;</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstname</span> + <span class="variable language_">this</span>.<span class="property">lastname</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newVal</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•æ±‚å¾— fullname å€¼ï¼Œç¬¬ä¸€ç§æ–¹æ³•å¯ä»¥æ‹¿æ¥ç›´æ¥ç”¨ï¼Œç¬¬äºŒç§éœ€è¦æ‹¿åˆ°å®ƒçš„get</p><h3 id="2-1-2-å®ä¾‹åŒ–ä¸€ä¸ª-computed-watcher"><a href="#2-1-2-å®ä¾‹åŒ–ä¸€ä¸ª-computed-watcher" class="headerlink" title="2.1.2 å®ä¾‹åŒ–ä¸€ä¸ª computed watcher"></a>2.1.2 å®ä¾‹åŒ–ä¸€ä¸ª computed watcher</h3><blockquote><p>æºç è·¯å¾„ï¼švue-main\src\core\instance\state.ts</p></blockquote><p>åœ¨åˆå§‹åŒ–å½“å‰ç»„ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œ <code>initComputed</code> æ–¹æ³•åˆå§‹åŒ–è®¡ç®—å±æ€§</p><p><strong>é¦–å…ˆ</strong>ï¼Œè¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆéå†ç”¨æˆ·å†™çš„è®¡ç®—å±æ€§</p><p>æ‹¿åˆ°è®¡ç®— fullname å±æ€§çš„æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—å±æ€§çš„å¤šç§å†™æ³•ï¼š ç›´æ¥å†™function /  å®Œæ•´å†™æ³•,åŒ…å«getã€set</span></span><br><span class="line"><span class="keyword">const</span> getter = <span class="title function_">isFunction</span>(userDef) ? userDef : userDef.<span class="property">get</span></span><br></pre></td></tr></table></figure><p><strong>ç„¶å</strong>ï¼Œä¼šè¿›è¡Œå®ä¾‹åŒ–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> computedWatcherOptions = &#123; <span class="attr">lazy</span>: <span class="literal">true</span> &#125;</span><br><span class="line"></span><br><span class="line">watchers[key] = <span class="keyword">new</span> <span class="title class_">Watcher</span>(</span><br><span class="line">        vm,</span><br><span class="line">        getter || noop,</span><br><span class="line">        noop,</span><br><span class="line">        computedWatcherOptions</span><br><span class="line">      )</span><br></pre></td></tr></table></figure><p>new Watcher æ—¶ï¼Œä¼ å…¥ç”¨æˆ·å®šä¹‰çš„æ±‚å€¼å‡½æ•°(getter)ï¼Œå¹¶ä¼ å…¥ <strong>lazy: true</strong> è¡¨ç¤ºè¯¥ watcher æ˜¯ <strong>computed watcher</strong></p><h3 id="2-1-3-é‡æ–°åŠ«æŒè®¡ç®—å±æ€§çš„-get"><a href="#2-1-3-é‡æ–°åŠ«æŒè®¡ç®—å±æ€§çš„-get" class="headerlink" title="2.1.3 é‡æ–°åŠ«æŒè®¡ç®—å±æ€§çš„ get"></a>2.1.3 é‡æ–°åŠ«æŒè®¡ç®—å±æ€§çš„ get</h3><p>æ¨¡æ¿è¯»å–è®¡ç®—å±æ€§æ—¶ï¼Œéœ€è¦æœ‰è®¡ç®—å±æ€§è‡ªå·±çš„æ±‚å€¼é€»è¾‘ï¼Œæ‰€ä»¥è¦åŠ«æŒå®ƒçš„ get</p><p>createComputedGetter æ–¹æ³•é‡æ–°å®šä¹‰äº†è®¡ç®—å±æ€§çš„ get </p><p>å½“è®¡ç®—å±æ€§ fullname  æ±‚å€¼æ—¶ï¼Œä¼šèµ°è¿™é‡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createComputedGetter</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">computedGetter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> watcher = <span class="variable language_">this</span>.<span class="property">_computedWatchers</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_computedWatchers</span>[key]</span><br><span class="line">    <span class="keyword">if</span> (watcher) &#123;</span><br><span class="line">      <span class="comment">// æ±‚æ–°å€¼</span></span><br><span class="line">      <span class="keyword">if</span> (watcher.<span class="property">dirty</span>) &#123;</span><br><span class="line">        watcher.evaluate()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// è®©ä¾èµ–çš„å±æ€§ ä¹Ÿå»æ¸²æŸ“watcher</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__ &amp;&amp; <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="property">onTrack</span>) &#123;</span><br><span class="line">          <span class="title class_">Dep</span>.<span class="property">target</span>.<span class="title function_">onTrack</span>(&#123;</span><br><span class="line">            <span class="attr">effect</span>: <span class="title class_">Dep</span>.<span class="property">target</span>,</span><br><span class="line">            <span class="attr">target</span>: <span class="variable language_">this</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>,</span><br><span class="line">            key</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        watcher.<span class="title function_">depend</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> watcher.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹é¢é‡Œé¢ä¹Ÿæ¶‰åŠåˆ°äº† å®ç°è®¡ç®—å±æ€§ çš„å‡ ä¸ªå…³é”®å˜é‡å’Œæ–¹æ³•</p><h4 id="dirty"><a href="#dirty" class="headerlink" title="dirty"></a>dirty</h4><p>è®¡ç®—å±æ€§ä½¿ç”¨ dirty å±æ€§æ¥æ ‡è®°è¯¥æ•°æ®æ˜¯å¦æ˜¯è„æ•°æ®</p><p>å¦‚æœæ˜¯è„æ•°æ®ï¼Œéœ€è¦é‡æ–°è®¡ç®—å€¼</p><p>å¦åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨æ—§å€¼</p><p>dirty é»˜è®¤ä¸º true</p><h4 id="watcher-evaluate"><a href="#watcher-evaluate" class="headerlink" title="watcher.evaluate()"></a>watcher.evaluate()</h4><p>evaluate() æ˜¯è®¡ç®—å±æ€§ä¸“ç”¨çš„æ–¹æ³•ï¼Œå…¶å®æ–¹æ³•å¾ˆç®€å•</p><p>é¦–å…ˆä½¿ç”¨ watcher ç”¨æ¥æ±‚å€¼çš„é€šç”¨æ–¹æ³•ï¼š <strong>get()</strong> ï¼ˆè®¡ç®—å±æ€§å…¥æ ˆã€æ±‚å€¼ã€å‡ºæ ˆï¼‰</p><p>ç„¶åå°† dirty æ ‡è®°ï¼šä¸æ˜¯è„æ•°æ®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">evaluate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="watcher-depend"><a href="#watcher-depend" class="headerlink" title="watcher.depend()"></a>watcher.depend()</h4><p>è®© <strong>è®¡ç®—å±æ€§watcherä¸­ä¾èµ–çš„å±æ€§</strong> ä¹Ÿå»æ”¶é›†æ ˆä¸­çš„å…¶ä»–watcher</p><p>å®ƒä¼šéå†å½“å‰ computed watcher çš„depså±æ€§ï¼Œä¾æ¬¡æ‰§è¡Œ dep çš„ depend æ–¹æ³•</p><p><strong>çŸ¥é“äº†å‡ ä¸ªé‡è¦æ¦‚å¿µï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­æ›´å®¹æ˜“ç†è§£å®ƒçš„æ•´ä½“å®ç°é€»è¾‘</strong></p><h1 id="3-ä¸¾ä¸ªæ —å­"><a href="#3-ä¸¾ä¸ªæ —å­" class="headerlink" title="3 ä¸¾ä¸ªæ —å­"></a>3 ä¸¾ä¸ªæ —å­</h1><p>ä¸¾ä¾‹å­ä¹‹å‰é¦–å…ˆå¾—æ˜ç¡®3ç‚¹ï¼š</p><ul><li>computed watcherçš„ evaluate() å‡½æ•°åªæ˜¯æ±‚å€¼ï¼Œæ ‡è®°dirty</li><li>computed watcherçš„ update() å‡½æ•°åªæ˜¯æ ‡è®°dirtyä¸ºè„</li><li>render watcheræ‰ä¼šçœŸæ­£æ›´æ–°è§†å›¾</li></ul><h2 id="3-1-åˆå§‹åŒ–"><a href="#3-1-åˆå§‹åŒ–" class="headerlink" title="3.1 åˆå§‹åŒ–"></a>3.1 åˆå§‹åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å®šä¹‰è®¡ç®—å±æ€§ï¼š</span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    fullname () &#123; </span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstname</span> + <span class="variable language_">this</span>.<span class="property">lastname</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œå·²ç»æœ‰ä¸€ä¸ª <strong>render watcher</strong> äº†ã€‚</p><p>dep ä¸­ targetStack æ ˆä¼šç»´æŠ¤ç€ [render watcher]</p><p><strong>ç„¶åï¼Œå®ä¾‹åŒ–ä¸€ä¸ª computed watcherï¼Œ</strong>computed watcher <strong>ä¸ä¼š</strong>æ‰§è¡Œé»˜è®¤çš„æ±‚å€¼æ“ä½œ</p><p>å½“æ¨¡æ¿ä¸­ä½¿ç”¨è®¡ç®—å±æ€§æ—¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; fullname &#125;&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰ä¼šæ‰§è¡Œæ±‚å€¼æ“ä½œ</strong>ï¼Œè¿™æ—¶è®¡ç®—å±æ€§ç‹¬æœ‰ getter æ‹¦æˆªï¼Œå› ä¸º dirty é»˜è®¤ä¸º trueï¼Œä¼šè¿›å…¥ watcher.evaluate() æ–¹æ³•</p><p>watcher.evaluate() æ–¹æ³•åšäº†ä¸¤ä»¶äº‹ï¼šget()ã€å°† dirty ç½®ä¸ºfalse</p><ul><li>get():</li></ul><p>watcheré€šç”¨æ±‚å€¼æ–¹æ³•ï¼Œæ±‚fullname</p><p>è®¡ç®—å±æ€§å…¥æ ˆï¼ŒtargetStack: [render watcher,  computed watcher]ï¼ŒDep.target æŒ‡å‘ computed watcher</p><p>è°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆç”¨æˆ·å®šä¹‰çš„è®¡ç®—å±æ€§å‡½æ•°ï¼‰æ±‚ fullname å€¼ï¼Œä¹Ÿå°±ä¼šè¢« firstname å’Œ lastname çš„ getter åŠ«æŒ</p><p>firstname å’Œ lastname çš„ getterrï¼šä¹Ÿå°±æ˜¯ä¼šè¿›è¡Œä¾èµ–æ”¶é›†</p><p>firstname å’Œ lastname çš„ dep ä¼šæ–°å¢computed watcherï¼ˆå› ä¸ºDep.target æŒ‡å‘ computed watcherï¼‰</p><p>è®¡ç®—å±æ€§å‡ºæ ˆ</p><ul><li>å°† dirty ç½®ä¸ºfalseï¼šæ ‡è®°ä¸ºéè„æ•°æ®ã€‚æ¨¡æ¿ä¸­å¦‚æœå†å†™  å°±ä¸ç”¨å†æ¬¡æ±‚å€¼äº†ï¼Œè€Œæ˜¯ä½¿ç”¨è®¡ç®—å±æ€§çš„ç¼“å­˜å€¼</li></ul><p><strong>åˆ°è¿™é‡Œæ±‚å€¼æ­¥éª¤å°±ç»“æŸäº†</strong></p><p>ä½†å‰é¢è¯´è¿‡äº†</p><blockquote><p>computed watcherçš„å·¥ä½œåªæ˜¯æ±‚å€¼ï¼Œæ ‡è®°dirty</p><p>render watcheræ‰ä¼šçœŸæ­£æ›´æ–°è§†å›¾</p></blockquote><p>æ‰€ä»¥åº”è¯¥è®© firstname å’Œ lastname çš„ dep ä¹Ÿå»æ”¶é›† render watcherï¼Œå½“ä¾èµ–çš„å±æ€§å˜åŒ–æ—¶èƒ½åšåˆ°æ›´æ–°æ¸²æŸ“</p><p><strong>æ‰€ä»¥ computed watcher çš„ getter åŠ«æŒä¸­ï¼Œwatcher.depend() æ–¹æ³•å°±èµ·ä½œç”¨äº†</strong></p><p>è®© firstname å’Œ lastname ä¹Ÿå»æ”¶é›† <strong>render watcher</strong></p><p>æ‰€ä»¥è¯´ï¼š<strong>è®¡ç®—å±æ€§(fullname)æ ¹æœ¬ä¸ä¼šæ”¶é›†ä¾èµ–ï¼Œè€Œæ˜¯è®©å®ƒä¾èµ–çš„å±æ€§(firstnameã€lastname)å»æ”¶é›†ä¾èµ–</strong></p><h2 id="3-2-ä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–"><a href="#3-2-ä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–" class="headerlink" title="3.2 ä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–"></a>3.2 ä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  vm.<span class="property">firstname</span> = <span class="string">&#x27;æ–°å€¼&#x27;</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><p>åªæœ‰å½“è®¡ç®—å±æ€§çš„ä¾èµ–é¡¹è¢«ä¿®æ”¹æ—¶ï¼Œè®¡ç®—å±æ€§æ‰ä¼šé‡æ–°è¿›è¡Œè®¡ç®—ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å€¼ï¼Œè€Œè§†å›¾ä¸­å…¶ä»–å˜é‡è¢«ä¿®æ”¹å¯¼è‡´è§†å›¾æ›´æ–°æ—¶ï¼Œè®¡ç®—å±æ€§ä¸ä¼šé‡æ–°è®¡ç®—ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>å½“è®¡ç®—å±æ€§çš„ä¾èµ–é¡¹ï¼Œå³ firstName å’Œ lastName è¢«ä¿®æ”¹æ—¶ï¼Œæ•°æ®åŠ«æŒä¼šè§¦å‘å†…éƒ¨çš„ setterï¼Œæ‰§è¡Œ watcher çš„ <strong>update</strong></p><p><strong>åˆå§‹åŒ–æ—¶ï¼Œå‰é¢çš„ <code>evaluate</code> å’Œ <code>depend</code> æ–¹æ³•ï¼ŒfirstName å’Œ lastName å†…éƒ¨çš„ dep ä¸­éƒ½ä¼šä¿å­˜ 2 ä¸ª watcherï¼Œä¸€ä¸ª computed watcherï¼Œä¸€ä¸ª render watcher</strong></p><div align="center">    <img src="/2023/07/23/Vue2æºç ï¼šè®¡ç®—å±æ€§åŸç†/photo1.png" style="height: 250px; width: 500px;"></div>**æ‰€ä»¥ï¼Œé¦–å…ˆä¼šæ‰§è¡Œ computed watcher çš„ update()** <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      <span class="comment">// å°† dirty æ ‡è®°ä¸ºè„æ•°æ®</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å±äºè®¡ç®—å±æ€§watcherï¼Œ lazy ä¸º true</p><p>å› æ­¤ä¼šå°† dirty æ ‡è®°ä¸ºè„æ•°æ®</p><p><strong>å¯ä»¥çœ‹åˆ°ï¼Œcomputed watcherå°±åšäº†è¿™ä¹ˆä¸€ä¸ªç®€å•çš„äº‹æƒ…ï¼Œå°†  dirty æ ‡è®°ä¸ºè„æ•°æ®</strong></p><p>è€Œ<strong>çœŸæ­£çš„æ±‚å€¼æ“ä½œæ˜¯åœ¨ render watcher ä¸­è¿›è¡Œçš„ï¼š</strong></p><p>æ‰§è¡Œ render watcher æ—¶</p><p>ç”±äºè§†å›¾ä¾èµ–äº† fullNameï¼Œä¼šè§¦å‘è®¡ç®—å±æ€§é‡æ–°å®šä¹‰çš„ getterï¼Œæ‰§è¡Œå‰é¢çš„ createComputedGetter</p><p><strong>ç”±äº dirty ä¸º true è„æ•°æ®</strong>ï¼Œåˆ™ä¼šè¿›è¡Œæ±‚å€¼é€»è¾‘ï¼š<strong>computed watcher çš„ watcher.evaluate()</strong></p><p>æ­¤æ—¶ fullName å°±æ‹¿åˆ°äº†æœ€æ–°çš„å€¼äº†</p><h2 id="3-3-éä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–"><a href="#3-3-éä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–" class="headerlink" title="3.3 éä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–"></a>3.3 éä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–</h2><p>å¦‚æœæˆ‘ä¿®æ”¹çš„æ˜¯ä¸ fullname æ— å…³çš„å±æ€§</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="property">otherTimes</span> = <span class="string">&#x27;æ–°å€¼&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™ä¸ªå±æ€§ä¸ä¼šè§¦å‘è®¡ç®—watcherçš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">  <span class="comment">// å°† dirty æ ‡è®°ä¸ºè„æ•°æ®</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º dirty ä¸º falseï¼Œæ‰€ä»¥ fullname ä¸ä¼šé‡æ–°æ‰§è¡Œè®¡ç®—æ–°å€¼çš„æ–¹æ³•ï¼šwatcher.evaluate()</p><h1 id="4-æµç¨‹å›¾"><a href="#4-æµç¨‹å›¾" class="headerlink" title="4 æµç¨‹å›¾"></a>4 æµç¨‹å›¾</h1><div align="center">    <img src="/2023/07/23/Vue2æºç ï¼šè®¡ç®—å±æ€§åŸç†/process.jpg" style="height: 1300px; width: 800px;"></div>]]></content>
      
      
      <categories>
          
          <category> æºç è§£æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºä¸€ä¸ªåŠ›å¯¼å‘æ°”æ³¡å›¾</title>
      <link href="/2023/07/14/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8A%9B%E5%AF%BC%E5%90%91%E6%B0%94%E6%B3%A1%E5%9B%BE/"/>
      <url>/2023/07/14/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8A%9B%E5%AF%BC%E5%90%91%E6%B0%94%E6%B3%A1%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="1-å…ˆä¸Šæ•ˆæœ"><a href="#1-å…ˆä¸Šæ•ˆæœ" class="headerlink" title="1 å…ˆä¸Šæ•ˆæœ"></a>1 å…ˆä¸Šæ•ˆæœ</h1><p><a href="https://postimg.cc/7J2tS4Z1"><img src="https://i.postimg.cc/KjqXSvXW/bubb.gif" alt="bubb.gif"></a></p><p>å¯ä»¥çœ‹åˆ°æ•ˆæœæ¶‰åŠï¼š</p><ul><li>èŠ‚ç‚¹æ ·å¼</li><li>åŠ›ä½œç”¨èšæ‹¢</li><li>èŠ‚ç‚¹äº¤äº’äº‹ä»¶</li></ul><p>ä¸‹é¢æ¥çœ‹çœ‹æ˜¯æ€æ ·å®ç°çš„</p><h1 id="2-æ•°æ®æ ¼å¼"><a href="#2-æ•°æ®æ ¼å¼" class="headerlink" title="2 æ•°æ®æ ¼å¼"></a>2 æ•°æ®æ ¼å¼</h1><h3 id="nodes-èŠ‚ç‚¹"><a href="#nodes-èŠ‚ç‚¹" class="headerlink" title="nodes èŠ‚ç‚¹"></a>nodes èŠ‚ç‚¹</h3><table><thead><tr><th>key</th><th>value</th></tr></thead><tbody><tr><td>id</td><td>å”¯ä¸€id</td></tr><tr><td>label</td><td>æ ‡ç­¾æ–‡æœ¬</td></tr><tr><td>style</td><td>èŠ‚ç‚¹æ ·å¼ï¼Œå¦‚ï¼šfill(å¡«å……è‰²)ã€stroke(è¾¹ç¼˜é¢œè‰²)ã€shadowBlurã€shadowOffsetXã€shadowOffsetYã€shadowColorâ€¦.</td></tr><tr><td>description</td><td>æè¿°æ–‡æœ¬ï¼ˆæ”¾å¤§åæ˜¾ç¤ºï¼‰</td></tr><tr><td>x</td><td>èŠ‚ç‚¹åˆå§‹ä½ç½®</td></tr><tr><td>y</td><td>èŠ‚ç‚¹åˆå§‹ä½ç½®</td></tr><tr><td>size</td><td>èŠ‚ç‚¹å¤§å°</td></tr></tbody></table><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">        <span class="attr">nodes</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">            <span class="attr">label</span>: <span class="string">&#x27;iCheng&#x27;</span>,</span><br><span class="line">            <span class="attr">style</span>: &#123; <span class="attr">fill</span>: <span class="string">&#x27;l(0) 0:#ffffff 0.5:#8FE9FF 1:#87EAEF&#x27;</span>, <span class="attr">stroke</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">shadowBlur</span>: <span class="number">60</span>, <span class="attr">shadowOffsetX</span>: <span class="number">10</span>, <span class="attr">shadowOffsetY</span>: <span class="number">10</span>, <span class="attr">shadowColor</span>: <span class="string">&#x27;#ADD8E6&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&#x27;See the latest updates to the MDN reference pages about JavaScript regular expressions&#x27;</span>,</span><br><span class="line">            <span class="attr">x</span>: <span class="number">624.0361181340486</span>,</span><br><span class="line">            <span class="attr">y</span>: <span class="number">208.12272169694995</span>,</span><br><span class="line">            <span class="attr">size</span>: <span class="number">57</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">            <span class="attr">label</span>: <span class="string">&#x27;analyse&#x27;</span>,</span><br><span class="line">            <span class="attr">style</span>: &#123; <span class="attr">fill</span>: <span class="string">&#x27;l(0) 0:#FFD3C9 0.5:#FFD3C9 1:#ffffff&#x27;</span>, <span class="attr">stroke</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">shadowBlur</span>: <span class="number">60</span>, <span class="attr">shadowOffsetX</span>: <span class="number">10</span>, <span class="attr">shadowOffsetY</span>: <span class="number">10</span>, <span class="attr">shadowColor</span>: <span class="string">&#x27;#E6E6FA&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&#x27;Learn what HTML landmark roles are, how they improve accessibility&#x27;</span>,</span><br><span class="line">            <span class="attr">x</span>: <span class="number">538.8142691877796</span>,</span><br><span class="line">            <span class="attr">y</span>: <span class="number">236.54991963171793</span>,</span><br><span class="line">            <span class="attr">size</span>: <span class="number">78</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">    <span class="comment">// æœ¬ç¤ºä¾‹ä¸éœ€è¦è¾¹</span></span><br><span class="line">        <span class="attr">edges</span>: [],</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure><h2 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h2><p>å¡«å……è‰²ä½¿ç”¨æ¸å˜è‰²</p><p><strong>æè¾¹çº¿æ€§æ¸å˜</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// æ¸å˜è§’åº¦ä¸º <span class="number">0</span>ï¼Œæ¸å˜çš„èµ·å§‹ç‚¹é¢œè‰² <span class="selector-id">#ffffff</span>ï¼Œä¸­ç‚¹çš„æ¸å˜è‰²ä¸º <span class="selector-id">#7ec2f3</span>ï¼Œç»“æŸçš„æ¸å˜è‰²ä¸º <span class="selector-id">#1890ff</span></span><br><span class="line">&#x27;l(<span class="number">0</span>) <span class="number">0</span>:<span class="number">#ffffff</span> <span class="number">0.5</span>:<span class="number">#7ec2f3</span> <span class="number">1</span>:<span class="number">#1890ff</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>å¡«å……ç¯å½¢æ¸å˜</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// æ¸å˜èµ·å§‹åœ†çš„åœ†å¿ƒåæ ‡ä¸ºè¢«å¡«å……ç‰©ä½“çš„åŒ…å›´ç›’ä¸­å¿ƒç‚¹ï¼ŒåŠå¾„ä¸º(åŒ…å›´ç›’å¯¹è§’çº¿é•¿åº¦ / <span class="number">2</span>) çš„ <span class="number">0.1</span> å€ï¼Œæ¸å˜çš„èµ·å§‹ç‚¹é¢œè‰² <span class="selector-id">#ffffff</span>ï¼Œä¸­ç‚¹çš„æ¸å˜è‰²ä¸º <span class="selector-id">#7ec2f3</span>ï¼Œç»“æŸçš„æ¸å˜è‰²ä¸º <span class="selector-id">#1890ff</span></span><br><span class="line">&#x27;l(<span class="number">0</span>) <span class="number">0</span>:<span class="number">#ffffff</span> <span class="number">0.5</span>:<span class="number">#7ec2f3</span> <span class="number">1</span>:<span class="number">#1890ff</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="3-å›¾é…ç½®"><a href="#3-å›¾é…ç½®" class="headerlink" title="3 å›¾é…ç½®"></a>3 å›¾é…ç½®</h1><p>åŸºäºG6</p><p>Graph æ˜¯ G6 å›¾è¡¨çš„è½½ä½“ï¼Œæ‰€æœ‰çš„ G6 èŠ‚ç‚¹å®ä¾‹æ“ä½œä»¥åŠäº‹ä»¶ï¼Œè¡Œä¸ºç›‘å¬éƒ½åœ¨ Graph å®ä¾‹ä¸Šè¿›è¡Œ</p><p>Graph çš„åˆå§‹åŒ–é€šè¿‡ new è¿›è¡Œå®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–æ—¶éœ€è¦ä¼ å…¥éœ€è¦çš„å‚æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;container&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> width = container.<span class="property">scrollWidth</span>;</span><br><span class="line"><span class="keyword">const</span> height = (container.<span class="property">scrollHeight</span> || <span class="number">1000</span>) - <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> graph = <span class="keyword">new</span> <span class="variable constant_">G6</span>.<span class="title class_">Graph</span>(&#123;</span><br><span class="line">    <span class="attr">container</span>: <span class="string">&#x27;container&#x27;</span>,</span><br><span class="line">    width,</span><br><span class="line">    height,</span><br><span class="line">    <span class="comment">// å¸ƒå±€é…ç½®</span></span><br><span class="line">    <span class="attr">layout</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;force&#x27;</span>, <span class="comment">// åŠ›å¯¼å‘å¸ƒå±€</span></span><br><span class="line">      <span class="attr">nodeStrength</span>: <span class="number">300</span>, <span class="comment">// èŠ‚ç‚¹ä½œç”¨åŠ›ï¼Œæ­£æ•°ä»£è¡¨èŠ‚ç‚¹ä¹‹é—´çš„å¼•åŠ›ä½œç”¨ï¼Œè´Ÿæ•°ä»£è¡¨èŠ‚ç‚¹ä¹‹é—´çš„æ–¥åŠ›ä½œç”¨</span></span><br><span class="line">      <span class="attr">collideStrength</span>: <span class="number">0.7</span>, <span class="comment">// é˜²æ­¢é‡å çš„åŠ›å¼ºåº¦ï¼ŒèŒƒå›´ [0, 1]</span></span><br><span class="line">      <span class="attr">alphaDecay</span>: <span class="number">0.01</span>, <span class="comment">// è¿­ä»£é˜ˆå€¼çš„è¡°å‡ç‡</span></span><br><span class="line">      <span class="attr">preventOverlap</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦é˜²æ­¢é‡å  å¿…é¡»åœ¨æ•°æ®ä¸­è®¾ç½®äº† size æˆ–åœ¨è¯¥å¸ƒå±€ä¸­é…ç½®äº†ä¸å½“å‰å›¾èŠ‚ç‚¹å¤§å°ç›¸åŒçš„ nodeSize å€¼</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">modes</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: [<span class="string">&#x27;collapse-expand-combo&#x27;</span>], <span class="comment">// comboç±»å‹</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// é»˜è®¤çŠ¶æ€ä¸‹èŠ‚ç‚¹çš„é…ç½®ï¼Œæ¯”å¦‚ type, size, colorã€‚ä¼šè¢«å†™å…¥çš„ data è¦†ç›–</span></span><br><span class="line">    <span class="attr">defaultNode</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;bubble&#x27;</span>,</span><br><span class="line">      <span class="attr">size</span>: <span class="number">80</span>,</span><br><span class="line">      <span class="attr">labelCfg</span>: &#123;</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">style</span>: &#123;</span><br><span class="line">          <span class="attr">fill</span>: <span class="string">&#x27;black&#x27;</span>,</span><br><span class="line">          <span class="attr">fontSize</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="attr">fontStyle</span>: <span class="string">&#x27;bold&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="3-1-Force-åŠ›å¯¼å‘"><a href="#3-1-Force-åŠ›å¯¼å‘" class="headerlink" title="3.1 Force åŠ›å¯¼å‘"></a>3.1 Force åŠ›å¯¼å‘</h2><p>Force å¸ƒå±€é‡‡ç”¨ç»å…¸çš„åŠ›å¯¼å‘å¸ƒå±€æ–¹æ³•ï¼Œå°†æ ¹æ®èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ–½åŠ åŠ›ä½¿èŠ‚ç‚¹å°½å¯èƒ½èšé›†</p><p>æ›´å¤šé…ç½®å¯æŸ¥çœ‹æ–‡æ¡£ï¼š<a href="https://g6.antv.antgroup.com/api/graph-layout/combo-force">https://g6.antv.antgroup.com/api/graph-layout/combo-force</a></p><h1 id="4-èŠ‚ç‚¹äº¤äº’äº‹ä»¶"><a href="#4-èŠ‚ç‚¹äº¤äº’äº‹ä»¶" class="headerlink" title="4 èŠ‚ç‚¹äº¤äº’äº‹ä»¶"></a>4 èŠ‚ç‚¹äº¤äº’äº‹ä»¶</h1><h2 id="4-1-èŠ‚ç‚¹å¼€å§‹è¢«æ‹–æ‹½-node-dragstart"><a href="#4-1-èŠ‚ç‚¹å¼€å§‹è¢«æ‹–æ‹½-node-dragstart" class="headerlink" title="4.1 èŠ‚ç‚¹å¼€å§‹è¢«æ‹–æ‹½ node:dragstart"></a>4.1 èŠ‚ç‚¹å¼€å§‹è¢«æ‹–æ‹½ node:dragstart</h2><p>å½“èŠ‚ç‚¹å¼€å§‹è¢«æ‹–æ‹½çš„æ—¶å€™è§¦å‘çš„äº‹ä»¶</p><p>èŠ‚ç‚¹å¼€å§‹è¢«æ‹–æ‹½æ—¶ï¼Œè§¦å‘ <strong>refreshDragedNodePosition</strong> æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.<span class="title function_">on</span>(<span class="string">&#x27;node:dragstart&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    graph.<span class="title function_">layout</span>(); <span class="comment">// graph.layout()é‡æ–°ä»¥å½“å‰é…ç½®çš„å±æ€§è¿›è¡Œä¸€æ¬¡å¸ƒå±€</span></span><br><span class="line">    <span class="title function_">refreshDragedNodePosition</span>(e);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="4-2-æ›´æ–°èŠ‚ç‚¹ä½ç½®ä¿¡æ¯-refreshDragedNodePosition"><a href="#4-2-æ›´æ–°èŠ‚ç‚¹ä½ç½®ä¿¡æ¯-refreshDragedNodePosition" class="headerlink" title="4.2 æ›´æ–°èŠ‚ç‚¹ä½ç½®ä¿¡æ¯ refreshDragedNodePosition"></a>4.2 æ›´æ–°èŠ‚ç‚¹ä½ç½®ä¿¡æ¯ refreshDragedNodePosition</h2><p>è·Ÿéšæ‹–åŠ¨çš„ä½ç½®ï¼Œåšç›¸åº”æ•°æ®å¤„ç†</p><p><strong>å‚æ•°eï¼š</strong>é¼ æ ‡æ‹–åŠ¨ä¿¡æ¯ï¼ˆåŒ…å«èŠ‚ç‚¹ xã€y åæ ‡ä¿¡æ¯ï¼‰</p><p><strong>è¿™ä¸ªæ–¹æ³•ï¼Œä¼šæ‹¿åˆ°èŠ‚ç‚¹å½“å‰xã€yåæ ‡å€¼ï¼Œèµ‹äºˆå…¶ fxã€fy å±æ€§</strong></p><h3 id="fxã€fy"><a href="#fxã€fy" class="headerlink" title="fxã€fy"></a>fxã€fy</h3><p>å½“ä½ å¸Œæœ›å›ºå®šæŸä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼Œä¸å—åŠ›çš„å½±å“æ—¶ï¼Œå¯ä»¥åœ¨è¯¥èŠ‚ç‚¹æ•°æ®ä¸­é…ç½® <strong>fx</strong> ä¸ <strong>fy</strong> ä½œä¸ºå›ºå®šçš„åæ ‡</p><p>å¦‚æœå°† <strong>fx</strong> ä¸  <strong>fy</strong> ç½®ä¸ºç©ºï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šç»§ç»­å—åŠ›çš„ä½œç”¨è€Œèšæ‹¢</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">refreshDragedNodePosition</span> (e) &#123;</span><br><span class="line">  <span class="comment">// console.log(e)</span></span><br><span class="line">  <span class="keyword">const</span> model = e.<span class="property">item</span>.<span class="title function_">get</span>(<span class="string">&#x27;model&#x27;</span>);</span><br><span class="line">  model.<span class="property">fx</span> = e.<span class="property">x</span>;</span><br><span class="line">  model.<span class="property">fy</span> = e.<span class="property">y</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-æ‹–åŠ¨è¿‡ç¨‹ä¸­-node-drag"><a href="#4-3-æ‹–åŠ¨è¿‡ç¨‹ä¸­-node-drag" class="headerlink" title="4.3 æ‹–åŠ¨è¿‡ç¨‹ä¸­ node:drag"></a>4.3 æ‹–åŠ¨è¿‡ç¨‹ä¸­ node:drag</h2><p>å½“èŠ‚ç‚¹åœ¨æ‹–åŠ¨è¿‡ç¨‹ä¸­æ—¶è§¦å‘çš„äº‹ä»¶</p><p>è§¦å‘ <strong>refreshDragedNodePosition</strong> æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph.<span class="title function_">on</span>(<span class="string">&#x27;node:drag&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="title function_">refreshDragedNodePosition</span>(e);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="4-4-æ‹–æ‹½å®Œæˆå-node-dragend"><a href="#4-4-æ‹–æ‹½å®Œæˆå-node-dragend" class="headerlink" title="4.4 æ‹–æ‹½å®Œæˆå node:dragend"></a>4.4 æ‹–æ‹½å®Œæˆå node:dragend</h2><p><strong>å½“æ‹–æ‹½å®Œæˆåè§¦å‘çš„äº‹ä»¶</strong></p><p>å°† <strong>fx</strong> ä¸  <strong>fy</strong> ç½®ä¸ºç©ºï¼Œè¯¥èŠ‚ç‚¹å°±ä¼šç»§ç»­å—åŠ›çš„ä½œç”¨è€Œèšæ‹¢</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.<span class="title function_">on</span>(<span class="string">&#x27;node:dragend&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  e.<span class="property">item</span>.<span class="title function_">get</span>(<span class="string">&#x27;model&#x27;</span>).<span class="property">fx</span> = <span class="literal">null</span>;</span><br><span class="line">  e.<span class="property">item</span>.<span class="title function_">get</span>(<span class="string">&#x27;model&#x27;</span>).<span class="property">fy</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4-5-ç‚¹å‡»äº‹ä»¶-node-click"><a href="#4-5-ç‚¹å‡»äº‹ä»¶-node-click" class="headerlink" title="4.5 ç‚¹å‡»äº‹ä»¶ node:click"></a>4.5 ç‚¹å‡»äº‹ä»¶ node:click</h2><p>å½“èŠ‚ç‚¹è¢«ç‚¹å‡»æ—¶è§¦å‘çš„äº‹ä»¶</p><p>é€šè¿‡é‡ç½® <strong>size</strong> å±æ€§ï¼Œæ”¹å˜èŠ‚ç‚¹å¤§å°</p><p>é‡ç½® <strong>label</strong> å±æ€§ï¼Œæ”¹å˜èŠ‚ç‚¹çš„æ–‡æœ¬</p><p>å†è°ƒç”¨ <strong>graph.layout()</strong> é‡æ–°ä»¥å½“å‰é…ç½®çš„å±æ€§è¿›è¡Œä¸€æ¬¡å¸ƒå±€</p><div align="center">    <img src="/2023/07/14/åˆ›å»ºä¸€ä¸ªåŠ›å¯¼å‘æ°”æ³¡å›¾/bubb2.png" style="height: 250px; width: 500px;"></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">graph.<span class="title function_">on</span>(<span class="string">&#x27;node:click&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="comment">// debugger;</span></span><br><span class="line">  <span class="keyword">const</span> node = e.<span class="property">item</span>; <span class="comment">//æ‹¿åˆ°å½“å‰ç‚¹å‡»çš„èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">const</span> states = node.<span class="title function_">getStates</span>(); <span class="comment">//è¿”å›å½“å‰å…ƒç´ çš„æ‰€æœ‰çŠ¶æ€ å•¥ä¹Ÿæ²¡æœ‰</span></span><br><span class="line">  <span class="keyword">let</span> clicked = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> model = node.<span class="title function_">getModel</span>(); <span class="comment">// è·å¾—èŠ‚ç‚¹ä½ç½®</span></span><br><span class="line">  <span class="keyword">let</span> size = <span class="number">200</span>; <span class="comment">// ç‚¹å‡»åçš„å¤§å°</span></span><br><span class="line">  <span class="keyword">let</span> labelText = <span class="string">&#x27;NODE: &#x27;</span> + model.<span class="property">id</span> + <span class="string">&#x27;\n&#x27;</span> + model.<span class="property">description</span>; <span class="comment">// æ‹¼æ¥ï¼š &quot;NODE:  this is node 8, and the value of it is 21&quot;</span></span><br><span class="line">  states.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">&#x27;click&#x27;</span>) &#123;</span><br><span class="line">      clicked = <span class="literal">true</span>;</span><br><span class="line">      size = model.<span class="property">oriSize</span>;</span><br><span class="line">      labelText = model.<span class="property">oriLabel</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  graph.<span class="title function_">setItemState</span>(node, <span class="string">&#x27;click&#x27;</span>, !clicked); <span class="comment">//è®¾ç½®å…ƒç´ çŠ¶æ€(å…ƒç´ å®ä¾‹ï¼ŒçŠ¶æ€å€¼ï¼Œæ˜¯å¦å¯ç”¨çŠ¶æ€)</span></span><br><span class="line">  <span class="comment">// æ›´æ–°å…ƒç´ ï¼ŒåŒ…æ‹¬æ›´æ–°æ•°æ®ã€æ ·å¼ç­‰</span></span><br><span class="line">  graph.<span class="title function_">updateItem</span>(node, &#123;</span><br><span class="line">    size,</span><br><span class="line">    <span class="attr">label</span>: labelText,</span><br><span class="line">  &#125;);</span><br><span class="line">  graph.<span class="title function_">layout</span>(); <span class="comment">// graph.layout()é‡æ–°ä»¥å½“å‰é…ç½®çš„å±æ€§è¿›è¡Œä¸€æ¬¡å¸ƒå±€</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="5-åˆå§‹åŒ–å›¾æ•°æ®"><a href="#5-åˆå§‹åŒ–å›¾æ•°æ®" class="headerlink" title="5 åˆå§‹åŒ–å›¾æ•°æ®"></a>5 åˆå§‹åŒ–å›¾æ•°æ®</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph.<span class="title function_">data</span>(data); <span class="comment">// åˆå§‹åŒ–å›¾æ•°æ®ï¼Œdataæ˜¯ä¸€ä¸ªåŒ…æ‹¬ èŠ‚ç‚¹ æ•°ç»„å’Œ è¾¹ æ•°ç»„çš„å¯¹è±¡</span></span><br><span class="line">graph.<span class="title function_">render</span>();</span><br></pre></td></tr></table></figure><h2 id="6-æ‰§è¡Œæ—¶æœº"><a href="#6-æ‰§è¡Œæ—¶æœº" class="headerlink" title="6 æ‰§è¡Œæ—¶æœº"></a>6 æ‰§è¡Œæ—¶æœº</h2><p>å› ä¸ºè¦æ“ä½œ DOMï¼Œå› æ­¤ä¸Šè¿° JS ä»£ç åœ¨ <strong>mounted()</strong> è°ƒç”¨</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®å¯è§†åŒ– </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æºç (4)ï¼šdiff ç®—æ³•åŸç†</title>
      <link href="/2023/07/12/Vue2%E6%BA%90%E7%A0%81%EF%BC%9Adiff%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/"/>
      <url>/2023/07/12/Vue2%E6%BA%90%E7%A0%81%EF%BC%9Adiff%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1-æ˜¯ä»€ä¹ˆ"><a href="#1-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1 æ˜¯ä»€ä¹ˆ"></a>1 æ˜¯ä»€ä¹ˆ</h1><p>å¦‚æœæˆ‘ç°åœ¨ä¿®æ”¹äº†æ¨¡æ¿ä¸­çš„ä¸€ä¸ªå±æ€§</p><p>é‚£ä¹ˆ Vue æ€ä¹ˆæ›´æ–°æ¸²æŸ“å¤„ç†æ¯”è¾ƒå¥½å‘¢ï¼Ÿ</p><ul><li>æŠŠæ—§çš„ DOM å…¨éƒ¨åˆ é™¤ï¼Œç„¶åæ¸²æŸ“ä¸€ä¸ªæ–°çš„ DOM æ›¿æ¢ä¸Šå»ï¼Ÿ</li></ul><p>è¿™æ ·æ˜¾ç„¶æˆæœ¬æ¯”è¾ƒé«˜</p><p>ä¸ºäº†èŠ‚çœå¼€é”€ï¼ŒVue ä¸­ä¼š<strong>å°†æ–°è€è™šæ‹ŸDOMè¿›è¡Œå¯¹æ¯”ï¼Œå°½é‡å¤ç”¨æ—§ DOM</strong></p><p>è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ diff ç®—æ³•</p><p>ä¸‹é¢æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªæ€è·¯å›¾ï¼Œè¿›è¡Œè®²è§£</p><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/åŸç†å›¾.jpg" style="height: 650px; width: 860px;"></div><h1 id="2-patch"><a href="#2-patch" class="headerlink" title="2 patch()"></a>2 patch()</h1><blockquote><p>æºç ä½ç½®ï¼švue-main\src\core\vdom\patch.ts</p></blockquote><p>å½“æ•°æ®æ›´æ–°ï¼Œæ•°æ®åŠ«æŒï¼Œè§¦å‘setterï¼Œæ´¾å‘æ›´æ–°ï¼Œç„¶åä¼šæ‰§è¡Œ <strong>patch()</strong> æ–¹æ³•ï¼Œä¼šä¼ å…¥å‚æ•°ï¼š<strong>è€çš„è™šæ‹ŸèŠ‚ç‚¹ã€æ–°çš„è™šæ‹ŸèŠ‚ç‚¹</strong></p><p>é¦–å…ˆï¼Œè¿™é‡Œé¢ä¼šæ‰§è¡Œ <strong>sameVnode()</strong> ï¼Œåˆ¤æ–­å½“å‰ä¸¤ä¸ªèŠ‚ç‚¹<strong>æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾</strong></p><ul><li>ä¸æ˜¯åŒç±»æ ‡ç­¾ï¼šé‚£å°±ç›´æ¥æ›¿æ¢å°±å®Œäº‹äº†</li><li>æ˜¯åŒç±»æ ‡ç­¾ï¼šå°±è¦è¿›è¡Œè¿›ä¸€æ­¥æ¯”è¾ƒï¼Œçœ‹çœ‹ä»–ä¿©æ˜¯ä¸æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œè°ƒç”¨ <strong>patchVnode()</strong> æ–¹æ³•</li></ul><h2 id="2-1-sameVnode-æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾"><a href="#2-1-sameVnode-æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾" class="headerlink" title="2.1 sameVnode() æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾"></a>2.1 sameVnode() æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾</h2><p> sameVnode() çš„ä½œç”¨æ˜¯ï¼šé€šè¿‡å¯¹æ¯” keyã€tagç­‰ç­‰åˆ¤æ–­å½“å‰ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sameVnode</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a.<span class="property">key</span> === b.<span class="property">key</span> &amp;&amp;   <span class="comment">// keyå€¼æ˜¯å¦ä¸€æ ·</span></span><br><span class="line">    a.<span class="property">asyncFactory</span> === b.<span class="property">asyncFactory</span> &amp;&amp;</span><br><span class="line">    ((a.<span class="property">tag</span> === b.<span class="property">tag</span> &amp;&amp;  <span class="comment">// æ ‡ç­¾åæ˜¯å¦ä¸€æ ·</span></span><br><span class="line">      a.<span class="property">isComment</span> === b.<span class="property">isComment</span> &amp;&amp;  <span class="comment">// æ˜¯å¦éƒ½ä¸ºæ³¨é‡ŠèŠ‚ç‚¹</span></span><br><span class="line">      <span class="title function_">isDef</span>(a.<span class="property">data</span>) === <span class="title function_">isDef</span>(b.<span class="property">data</span>) &amp;&amp;  <span class="comment">// æ˜¯å¦éƒ½å®šä¹‰äº†data</span></span><br><span class="line">      <span class="title function_">sameInputType</span>(a, b)) ||    <span class="comment">// å½“æ ‡ç­¾ä¸ºinputæ—¶ï¼Œtypeå¿…é¡»æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">      (<span class="title function_">isTrue</span>(a.<span class="property">isAsyncPlaceholder</span>) &amp;&amp; <span class="title function_">isUndef</span>(b.<span class="property">asyncFactory</span>.<span class="property">error</span>)))</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-patchVnode"><a href="#3-patchVnode" class="headerlink" title="3 patchVnode()"></a>3 patchVnode()</h1><ul><li>æ–‡æœ¬ä¸åŒåˆ™è¦†ç›–æ–‡æœ¬</li><li>æ—§è™šæ‹Ÿ DOM å¤šä½™å­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤ï¼›</li><li>æ—§è™šæ‹Ÿ DOM å°‘å­èŠ‚ç‚¹ï¼Œåˆ™æ–°å¢</li><li>éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œè¿›è¡Œ updateChildren() æ¯”è¾ƒä¸¤ä¸ªäººçš„å­èŠ‚ç‚¹</li></ul><h1 id="4-updateChildren-diff-æ ¸å¿ƒæ–¹æ³•"><a href="#4-updateChildren-diff-æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="4 updateChildren() - diff æ ¸å¿ƒæ–¹æ³•"></a>4 updateChildren() - diff æ ¸å¿ƒæ–¹æ³•</h1><h2 id="4-1-åŒç«¯äº¤å‰æŒ‡é’ˆ"><a href="#4-1-åŒç«¯äº¤å‰æŒ‡é’ˆ" class="headerlink" title="4.1 åŒç«¯äº¤å‰æŒ‡é’ˆ"></a>4.1 åŒç«¯äº¤å‰æŒ‡é’ˆ</h2><p>vue2 ä¸­å«åšåŒç«¯äº¤å‰æŒ‡é’ˆï¼Œæ–°è€Vdomå„æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æ˜¯ï¼šé˜Ÿå¤´ä¸é˜Ÿå¤´ï¼Œé˜Ÿå°¾ä¸é˜Ÿå°¾ã€é˜Ÿå¤´ä¸é˜Ÿå°¾ã€é˜Ÿå°¾ä¸é˜Ÿå¤´ã€‚</p><p>while å¾ªç¯ä¸­ï¼Œå­˜åœ¨å‡ ç§æ¯”è¾ƒï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// whileå¾ªç¯ç»ˆæ­¢æ¡ä»¶æ˜¯æŒ‡é’ˆè¶Šç•Œ</span></span><br><span class="line"><span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_">sameVnode</span>(oldStartVnode, newStartVnode))&#123;</span><br><span class="line">        <span class="comment">// é˜Ÿå¤´ä¸é˜Ÿå¤´</span></span><br><span class="line"><span class="title function_">patchVnode</span>()</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_">sameVnode</span>(oldEndVnode, newEndVnode))&#123;</span><br><span class="line">        <span class="comment">// é˜Ÿå°¾ä¸é˜Ÿå°¾</span></span><br><span class="line">        <span class="title function_">patchVnode</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_">sameVnode</span>(oldStartVnode, newEndVnode))&#123;</span><br><span class="line">        <span class="comment">// é˜Ÿå¤´ä¸é˜Ÿå°¾</span></span><br><span class="line">        <span class="title function_">patchVnode</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_">sameVnode</span>(oldEndVnode, newStartVnode))&#123;</span><br><span class="line">        <span class="comment">// é˜Ÿå°¾ä¸é˜Ÿå¤´</span></span><br><span class="line">        <span class="title function_">patchVnode</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// è¿™å››ç§æƒ…å†µéƒ½æ²¡æœ‰åŒ¹é…åˆ°ï¼Œè¿›è¡Œç¬¬äº”ç§æ¯”è¾ƒæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// å¦‚æœè¿™å››ç§æƒ…å†µéƒ½æ²¡æœ‰åŒ¹é…åˆ°ï¼Œå°±ä¼šä»æ–°Vdomçš„é˜Ÿå¤´å¼€å§‹ï¼Œåœ¨æ—§Vdomå¼€å§‹å¯»æ‰¾ï¼Œæ‰¾åˆ°äº†å°±è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°å¯¹åº”ä½ç½®ï¼Œå¹¶å°†æ—§Vdomä¸­è¯¥èŠ‚ç‚¹è®¾ç½®ä¸ºundefinedï¼Œå¦‚æœæ²¡// æ‰¾åˆ°ï¼Œå°±åˆ›å»ºæ–°èŠ‚ç‚¹æ’å…¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒä¼šå¯¹æ¯”4æ¬¡ï¼Œå¦‚æœè¯´å››æ¬¡ä¸­å¯»æ‰¾åˆ°çš„å…ƒç´ ç›¸åŒï¼Œå°±ä¼šå»è¿›è¡Œå¤ç”¨ï¼Œç§»åŠ¨å…ƒç´ çš„ä½ç½®ã€‚</p><p><strong>é˜Ÿå¤´ä¸é˜Ÿå¤´æ¯”è¾ƒï¼š</strong></p><ul><li>æŒ‡é’ˆæŒ‡å‘ï¼š<strong>æ—§Vdomçš„é˜Ÿå¤´ã€æ–°Vdomçš„é˜Ÿå¤´</strong></li><li>è°ƒç”¨ <code>sameVnode()</code> æ–¹æ³•ï¼Œåˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾ <ul><li>æ˜¯åŒç±»æ ‡ç­¾ï¼šè°ƒç”¨ <code>patchVnode()</code> å¯¹èŠ‚ç‚¹æ›´æ–°&#x2F;é€’å½’æ¯”è¾ƒï¼ˆå¦‚æ›¿æ¢æ—§DOMçš„æ–‡æœ¬&#x2F;æ¯”è¾ƒå­èŠ‚ç‚¹ï¼‰ï¼›ç„¶åä¸¤ä¸ªæŒ‡é’ˆçš„ <code>index++</code>ï¼Œæœ¬æ¬¡ while å¾ªç¯ç»“æŸï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯</li><li>ä¸æ˜¯åŒç±»æ ‡ç­¾ï¼šè¿›è¡Œé˜Ÿå°¾ä¸é˜Ÿå°¾æ¯”è¾ƒ</li></ul></li></ul><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/å¤´å¤´æ¯”è¾ƒ.png" style="height: 450px; width: 1400px;"></div><p><strong>é˜Ÿå°¾ä¸é˜Ÿå°¾æ¯”è¾ƒï¼š</strong></p><ul><li>æŒ‡é’ˆæŒ‡å‘ï¼š<strong>æ—§Vdomçš„é˜Ÿå°¾ã€æ–°Vdomçš„é˜Ÿå°¾</strong></li><li>è°ƒç”¨ <code>sameVnode()</code> æ–¹æ³•ï¼Œåˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾ <ul><li>æ˜¯åŒç±»æ ‡ç­¾ï¼šè°ƒç”¨ <code>patchVnode()</code> å¯¹èŠ‚ç‚¹æ›´æ–°&#x2F;é€’å½’æ¯”è¾ƒï¼ˆå¦‚æ›¿æ¢æ—§DOMçš„æ–‡æœ¬&#x2F;æ¯”è¾ƒå­èŠ‚ç‚¹ï¼‰ï¼›ç„¶åä¸¤ä¸ªæŒ‡é’ˆçš„ <code>index--</code>ï¼Œæœ¬æ¬¡ while å¾ªç¯ç»“æŸï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯</li><li>ä¸æ˜¯åŒç±»æ ‡ç­¾ï¼šè¿›è¡Œé˜Ÿå¤´ä¸é˜Ÿå°¾æ¯”è¾ƒ</li></ul></li></ul><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/å°¾å°¾æ¯”è¾ƒ.png" style="height: 500px; width: 600px;"></div><p><strong>é˜Ÿå¤´ä¸é˜Ÿå°¾æ¯”è¾ƒï¼š</strong></p><ul><li>æŒ‡é’ˆæŒ‡å‘ï¼š<strong>æ—§Vdomçš„é˜Ÿå¤´ã€æ–°Vdomçš„é˜Ÿå°¾</strong></li><li>è°ƒç”¨ <code>sameVnode()</code> æ–¹æ³•ï¼Œåˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾ <ul><li>æ˜¯åŒç±»æ ‡ç­¾ï¼šè°ƒç”¨ <code>patchVnode()</code> å¯¹èŠ‚ç‚¹æ›´æ–°&#x2F;é€’å½’æ¯”è¾ƒï¼ˆå¦‚æ›¿æ¢æ—§DOMçš„æ–‡æœ¬&#x2F;æ¯”è¾ƒå­èŠ‚ç‚¹ï¼‰ï¼›ç„¶åä¸¤ä¸ªæŒ‡é’ˆçš„ <strong>indexå‘å†…æ”¶ç¼©</strong>ï¼Œæœ¬æ¬¡ while å¾ªç¯ç»“æŸï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯</li><li>ä¸æ˜¯åŒç±»æ ‡ç­¾ï¼šè¿›è¡Œé˜Ÿå°¾ä¸é˜Ÿå¤´æ¯”è¾ƒ</li></ul></li></ul><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/å¤´å°¾æ¯”è¾ƒ.png" style="height: 600px; width: 600px;"></div><p><strong>é˜Ÿå°¾ä¸é˜Ÿå¤´æ¯”è¾ƒï¼š</strong></p><ul><li>æŒ‡é’ˆæŒ‡å‘ï¼š<strong>æ—§Vdomçš„é˜Ÿå°¾ã€æ–°Vdomçš„é˜Ÿå¤´</strong></li><li>è°ƒç”¨ <code>sameVnode()</code> æ–¹æ³•ï¼Œåˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾ <ul><li>æ˜¯åŒç±»æ ‡ç­¾ï¼šè°ƒç”¨ <code>patchVnode()</code> å¯¹èŠ‚ç‚¹æ›´æ–°&#x2F;é€’å½’æ¯”è¾ƒï¼ˆå¦‚æ›¿æ¢æ—§DOMçš„æ–‡æœ¬&#x2F;æ¯”è¾ƒå­èŠ‚ç‚¹ï¼‰ï¼›ç„¶åä¸¤ä¸ªæŒ‡é’ˆçš„ <strong>indexå‘å†…æ”¶ç¼©</strong>ï¼Œæœ¬æ¬¡ while å¾ªç¯ç»“æŸï¼Œè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯</li><li>ä¸æ˜¯åŒç±»æ ‡ç­¾ï¼šè¿›è¡Œç¬¬äº”ç§æ¯”è¾ƒæ–¹æ³•</li></ul></li></ul><h2 id="4-2-è·³å‡ºwhileå¾ªç¯å"><a href="#4-2-è·³å‡ºwhileå¾ªç¯å" class="headerlink" title="4.2 è·³å‡ºwhileå¾ªç¯å"></a>4.2 è·³å‡ºwhileå¾ªç¯å</h2><h4 id="æ—§èŠ‚ç‚¹éœ€è¦åˆ é™¤çš„æƒ…å†µ"><a href="#æ—§èŠ‚ç‚¹éœ€è¦åˆ é™¤çš„æƒ…å†µ" class="headerlink" title="æ—§èŠ‚ç‚¹éœ€è¦åˆ é™¤çš„æƒ…å†µ"></a>æ—§èŠ‚ç‚¹éœ€è¦åˆ é™¤çš„æƒ…å†µ</h4><ul><li>é¦–å…ˆå¤´å¤´å¯¹æ¯”ï¼šä¸¤ä¸ªèŠ‚ç‚¹<code>ï¼ˆæ–‡æœ¬A / key=1ï¼‰</code>ï¼Œåˆ¤æ–­ä¸ºç›¸åŒèŠ‚ç‚¹ï¼Œå¤ç”¨ï¼Œindex++</li><li>ä¸‹ä¸€è½®å¾ªç¯ï¼Œå†è¿›è¡Œå¤´å¤´å¯¹æ¯”ï¼Œä½†æ­¤æ—¶<code>ï¼ˆæ–‡æœ¬XX / key=XXã€æ–‡æœ¬B / key=2ï¼‰</code>ï¼Œä¸æ˜¯ç›¸åŒèŠ‚ç‚¹ï¼Œè¿›è¡Œå°¾å°¾å¯¹æ¯”</li><li>å°¾å°¾å¯¹æ¯”ï¼šä¸¤ä¸ªèŠ‚ç‚¹<code>ï¼ˆæ–‡æœ¬B / key=2ï¼‰</code>ï¼Œåˆ¤æ–­ä¸ºç›¸åŒèŠ‚ç‚¹ï¼Œå¤ç”¨ï¼Œindexâ€“</li><li>ä¸‹ä¸€è½®å¾ªç¯ï¼ŒæŒ‡é’ˆè¶Šç•Œï¼Œè·³å‡º while å¾ªç¯</li><li>æ—§ Vnode å­˜åœ¨éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œä¼šåœ¨çœŸå® DOM ä¸­åˆ é™¤</li></ul><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/åˆ é™¤èŠ‚ç‚¹.png" style="height: 450px; width: 550px;"></div><h4 id="æ—§èŠ‚ç‚¹éœ€è¦æ·»åŠ çš„æƒ…å†µ"><a href="#æ—§èŠ‚ç‚¹éœ€è¦æ·»åŠ çš„æƒ…å†µ" class="headerlink" title="æ—§èŠ‚ç‚¹éœ€è¦æ·»åŠ çš„æƒ…å†µ"></a>æ—§èŠ‚ç‚¹éœ€è¦æ·»åŠ çš„æƒ…å†µ</h4><p>å¦‚æœæ—§èŠ‚ç‚¹æ²¡æœ‰ï¼Œæ–°èŠ‚ç‚¹æœ‰</p><p>å°±è¦æŠŠå¤šä½™çš„èŠ‚ç‚¹å°±æ’å…¥åˆ°è€çš„</p><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/æ–°å¢èŠ‚ç‚¹.png" style="height: 450px; width: 950px;"></div><p>è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æœ€åæ˜¯å¤´å¤´æ¯”è¾ƒï¼Œè¦æŠŠ<strong>å¤šä½™çš„èŠ‚ç‚¹æ’å…¥ oldèŠ‚ç‚¹ åé¢</strong>   </li><li>æœ€åæ˜¯å°¾å°¾æ¯”è¾ƒï¼šéœ€è¦æŠŠ<strong>å¤šä½™çš„èŠ‚ç‚¹æ’å…¥ oldèŠ‚ç‚¹ å‰é¢</strong></li></ul><p>ä¸€ä¸ªè¦æ’å…¥å‰é¢ã€ä¸€ä¸ªè¦æ’å…¥åé¢ï¼Œæ‰€ä»¥ Vue ä¸­ä½¿ç”¨<strong>è·å–ä¸‹ä¸€ä¸ªå…ƒç´ æ–¹æ³•</strong>æ¥è§£å†³ï¼š</p><ul><li>æ‹¿åˆ°è¿™ä¸ªå¤šä½™èŠ‚ç‚¹çš„<strong>ä¸‹ä¸€ä¸ªå…ƒç´ </strong>ï¼Œå¯èƒ½ä¸ºç©º(å¤´å¤´æ¯”è¾ƒæƒ…å†µ)ï¼Œå¯èƒ½å­˜åœ¨(å°¾å°¾æ¯”è¾ƒæƒ…å†µ)</li><li>æ‰§è¡Œ el.insertBefore(çœŸå®èŠ‚ç‚¹, ä¸‹ä¸€ä¸ªå…ƒç´ )  <ul><li>å¦‚æœä¸‹ä¸€ä¸ªå…ƒç´ ä¸ºç©ºï¼šå°±æ˜¯<strong>å¤´å¤´æ¯”è¾ƒ</strong>çš„æƒ…å†µï¼Œåˆ™ç›¸å½“äºappendChild() ï¼Œåœ¨<strong>è€èŠ‚ç‚¹åé¢è¿½åŠ </strong>å¤šä½™çš„èŠ‚ç‚¹</li><li>å¦‚æœä¸ä¸ºç©ºï¼šå°±æ˜¯<strong>å°¾å°¾æ¯”è¾ƒ</strong>æƒ…å†µï¼Œåœ¨è€èŠ‚ç‚¹ä¸­æ‰¾åˆ°<strong>æ­¤ä¸‹ä¸€ä¸ªå…ƒç´ </strong>ï¼Œè¦åˆ°ä¼šæŠŠå¤šä½™èŠ‚ç‚¹<strong>æ’å…¥åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ çš„å‰é¢</strong></li></ul></li></ul><h2 id="4-3-å¦‚æœ-patch-æ—¶å‘ç°-vnode-æ˜¯ç»„ä»¶"><a href="#4-3-å¦‚æœ-patch-æ—¶å‘ç°-vnode-æ˜¯ç»„ä»¶" class="headerlink" title="4.3 å¦‚æœ patch() æ—¶å‘ç° vnode æ˜¯ç»„ä»¶"></a>4.3 å¦‚æœ patch() æ—¶å‘ç° vnode æ˜¯ç»„ä»¶</h2><p>å½“ <code>patch()</code> æ–¹æ³•é‡åˆ°ç»„ä»¶ VNode æ—¶ï¼Œå®ƒä¼šé€’å½’çš„æ‰§è¡Œï¼šåˆ›å»ºæˆ–æ›´æ–°ç»„ä»¶å®ä¾‹ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°çš„è°ƒç”¨å’Œç»„ä»¶çš„æ¸²æŸ“æ›´æ–°ã€‚</p><p>å› æ­¤å¦‚æœæˆ‘ä»¬ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ï¼Œ <code>patch()</code> åˆ™ä¸ä¼šè¿›è¡Œä¸Šé¢çš„è¿‡ç¨‹ï¼Œç†è®ºä¸Šä¼šå‡å°‘æ¸²æŸ“å¼€é”€</p><blockquote><p>å‡½æ•°å¼ç»„ä»¶æ˜¯ä¸€ç§å®šä¹‰è‡ªèº«æ²¡æœ‰ä»»ä½•çŠ¶æ€çš„ç»„ä»¶çš„æ–¹å¼ã€‚å®ƒä»¬å¾ˆåƒçº¯å‡½æ•°ï¼šæ¥æ”¶ propsï¼Œè¿”å› vnodesã€‚å‡½æ•°å¼ç»„ä»¶åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¸ä¼šåˆ›å»ºç»„ä»¶å®ä¾‹ (ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰ <code>this</code>)ï¼Œä¹Ÿä¸ä¼šè§¦å‘å¸¸è§„çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">functional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">.......</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="5-é¢è¯•é¢˜"><a href="#5-é¢è¯•é¢˜" class="headerlink" title="5 é¢è¯•é¢˜"></a>5 é¢è¯•é¢˜</h1><h3 id="5-1-é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆv-forå¾ªç¯æ—¶ï¼Œkeyä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿ"><a href="#5-1-é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆv-forå¾ªç¯æ—¶ï¼Œkeyä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿ" class="headerlink" title="5.1 é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆv-forå¾ªç¯æ—¶ï¼Œkeyä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿ"></a>5.1 é¢è¯•é¢˜ï¼šä¸ºä»€ä¹ˆv-forå¾ªç¯æ—¶ï¼Œkeyä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Ÿ</h3><p>å¦‚ä¸‹å›¾ï¼Œå¦‚æœå½“å‰æœ‰ä¸€ä¸ªæ•°ç»„å­˜å‚¨ï¼š[â€˜è‹¹æœâ€™, â€˜æ¢¨â€™, â€˜é¦™è•‰â€™]</p><p>ä½¿ç”¨ v-for å¾ªç¯ï¼Œæ¸²æŸ“åˆ°é¡µé¢ä¸Š</p><p>å¹¶å°†è‹¹æœç½®ä¸º<strong>è¢«å‹¾é€‰çŠ¶æ€</strong></p><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/é¢è¯•é¢˜1.png" style="height: 250px; width: 500px;"></div><p><strong>å¦‚æœç°åœ¨ä½¿ç”¨ ç´¢å¼• ä½œä¸º key</strong></p><p>ç”¨æˆ·å‘æ•°ç»„ä¸­ unshift ä¸€ä¸ªç«é¾™æœ</p><p>é‚£ä¹ˆç•Œé¢ï¼Œå°±å˜æˆäº†ç«é¾™æœè¢«å‹¾é€‰çš„çŠ¶æ€</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿ</p><h3 id="5-2-åŸå› "><a href="#5-2-åŸå› " class="headerlink" title="5.2 åŸå› "></a>5.2 åŸå› </h3><p>å› ä¸ºä¿®æ”¹æ•°æ®åï¼Œè™šæ‹ŸDOMè½¬æ¢ä¸ºçœŸå®DOMè¿‡ç¨‹çš„ diff ç®—æ³•</p><p>sameVnode() é‡‡ç”¨ keyã€tagã€inputType åˆ¤æ–­æ˜¯å¦æ˜¯åŒç±»æ ‡ç­¾</p><p>ä¹‹å‰è‹¹æœçš„ç´¢å¼•ä¸º0</p><p>æ’å…¥ç«é¾™æœåï¼Œç«é¾™æœçš„ç´¢å¼•ä¾ç„¶æ˜¯0</p><p>æ­¤æ—¶ sameVnode() åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯åŒç±»æ ‡ç­¾ï¼Œè¿›ä¸€æ­¥æ¯”è¾ƒ patchVnode()ï¼Œ<strong>ä»…ä½¿ç”¨æ–°æ–‡æœ¬æ›¿æ¢æ—§æ–‡æœ¬</strong></p><p>å‹¾é€‰çŠ¶æ€è¿˜åœ¨</p><p>æ‰€ä»¥ç«é¾™æœå°±è¢«å‹¾é€‰äº†</p><div align="center">    <img src="/2023/07/12/Vue2æºç ï¼šdiffç®—æ³•åŸç†/é¢è¯•é¢˜2.png" style="height: 750px; width: 760px;"></div>]]></content>
      
      
      <categories>
          
          <category> æºç è§£æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æºç (3)ï¼šä¾èµ–æ”¶é›† æ´¾å‘æ›´æ–°</title>
      <link href="/2023/07/11/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%20%E6%B4%BE%E5%8F%91%E6%9B%B4%E6%96%B0/"/>
      <url>/2023/07/11/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%20%E6%B4%BE%E5%8F%91%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1-What"><a href="#1-What" class="headerlink" title="1 What"></a>1 What</h1><p>ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ŒçŠ¶æ€ä¼šä¸æ–­å‘ç”Ÿå˜åŒ–ã€‚å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–åï¼Œéœ€è¦é‡æ–°æ¸²æŸ“ï¼Œå¾—åˆ°æœ€æ–°çš„è§†å›¾ã€‚</p><p>æ­£æ˜¯<strong>å“åº”å¼</strong>èµ‹äºˆäº†<strong>çŠ¶æ€å˜æ›´ - é‡æ–°æ¸²æŸ“</strong>çš„èƒ½åŠ›</p><p>é€šå¸¸æ¥è¯´ï¼Œå“åº”å¼çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ä¸ºï¼š<strong>æ•°æ®åŠ«æŒã€ä¾èµ–æ”¶é›†ã€æ´¾å‘æ›´æ–°</strong></p><p>ä¹‹å‰ä¸€ç¯‡æ–‡ç« å·²ç»å™è¿°è¿‡æ•°æ®åŠ«æŒçš„å†…å®¹</p><blockquote><p>æ•°æ®åŠ«æŒæºç åˆ†æï¼š<a href="https://icheng.github.io/2023/07/10/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81%E5%8E%9F%E7%90%86/">https://icheng.github.io/2023/07/10/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81%E5%8E%9F%E7%90%86/</a></p></blockquote><p>ä¸‹é¢æ¥åˆ†æä¸€ä¸‹ä¾èµ–æ”¶é›†ã€æ´¾å‘æ›´æ–°çš„æºç åŸç†</p><h1 id="2-æ€è€ƒ-3-ä¸ªé—®é¢˜"><a href="#2-æ€è€ƒ-3-ä¸ªé—®é¢˜" class="headerlink" title="2 æ€è€ƒ 3 ä¸ªé—®é¢˜"></a>2 æ€è€ƒ 3 ä¸ªé—®é¢˜</h1><p>æˆ‘ä»¬çŸ¥é“äº† Vue2 åº•å±‚æ˜¯é€šè¿‡ <code>Object.defineProperty</code> æ¥å®ç°æ•°æ®å“åº”å¼çš„ï¼Œä½†æ˜¯å•æœ‰è¿™ä¸ªè¿˜ä¸å¤Ÿï¼Œå› ä¸ºæ•°æ®å¯èƒ½æ²¡æœ‰åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨</p><p>æ‰€ä»¥ Vue2ï¼Œé€šè¿‡<strong>ä¾èµ–æ”¶é›†</strong>æ¥åˆ¤æ–­å“ªäº›ç”¨åˆ°çš„æ•°æ®çš„å˜æ›´éœ€è¦è§¦å‘è§†å›¾æ›´æ–°ï¼Œå†é€šè¿‡<strong>æ´¾å‘æ›´æ–°</strong>é€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°æ¸²æŸ“</p><p><strong>é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥è€ƒè™‘ 3 ä¸ªé—®é¢˜ï¼š</strong></p><ul><li>ä¾èµ–æ˜¯è°ï¼Ÿæ¢å¥è¯è¯´ï¼Œå±æ€§å‘ç”Ÿå˜åŒ–åï¼Œé€šçŸ¥åˆ°è°ï¼Ÿï¼ˆWatcherï¼‰</li><li>ä¾èµ–æ”¶é›†åˆ°å“ªé‡Œï¼Ÿæ¯ä¸€ä¸ªæ•°æ®çš„ä¾èµ–éƒ½éœ€è¦é›†ä¸­ç®¡ç†ï¼ˆDepï¼‰</li><li>åœ¨å“ªé‡Œåšä¾èµ–æ”¶é›†ï¼Ÿï¼ˆObserveï¼‰</li></ul><h2 id="3-ä¾èµ–æ”¶é›†ä¸­çš„å„ä¸ªç±»"><a href="#3-ä¾èµ–æ”¶é›†ä¸­çš„å„ä¸ªç±»" class="headerlink" title="3 ä¾èµ–æ”¶é›†ä¸­çš„å„ä¸ªç±»"></a>3 ä¾èµ–æ”¶é›†ä¸­çš„å„ä¸ªç±»</h2><p>å…ˆæ¥çœ‹ä¸€å¼ å›¾</p><div align="center">    <img src="/2023/07/11/Vue2æºç ï¼šä¾èµ–æ”¶é›† æ´¾å‘æ›´æ–°/åŸç†å›¾.jpg" style="height: 400px; width: 900px;"></div><p>æ•°æ®æ˜¯<strong>è¢«è§‚å¯Ÿè€…</strong>ï¼Œå°†æ•°æ®æ ‡è®°ä¸ºå·²è§‚æµ‹æ•°æ®åï¼Œæ•°æ®å°±ä¼šæœ‰ä¸€ä¸ª Dep å®ä¾‹</p><p>è§¦å‘æ•°æ®çš„ getter æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¾èµ–æ”¶é›†ï¼Œå°†ä¾èµ–é›†ä¸­ç®¡ç†</p><p>è§¦å‘æ•°æ®çš„ setter æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ´¾å‘æ›´æ–°ï¼Œä¼šé€šçŸ¥ <strong>è§‚å¯Ÿè€…Watcher</strong> è¿›è¡Œæ¸²æŸ“æ›´æ–°</p><p>å¸¦ç€è¿™å¼ å›¾ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿‡ç¨‹ä¸­çš„ 3 ä¸ªç±»ï¼š Watcherã€Depã€Observe</p><h2 id="3-1-Dep"><a href="#3-1-Dep" class="headerlink" title="3.1 Dep"></a>3.1 Dep</h2><blockquote><p>æºç ä½ç½®ï¼švue-main\src\core\observer\dep.ts</p></blockquote><p>æ¯ä¸€ä¸ªè¢«è§‚æµ‹çš„æ•°æ®éƒ½ä¼šæœ‰ä¸€ä¸ª <code>Dep</code> ç±»å®ä¾‹ï¼Œä¸” Dep æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€ id</p><h4 id="subs-é˜Ÿåˆ—"><a href="#subs-é˜Ÿåˆ—" class="headerlink" title="subs é˜Ÿåˆ—"></a>subs é˜Ÿåˆ—</h4><p>Dep å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>subs</strong> é˜Ÿåˆ—</p><p>subså°±æ˜¯subscribersçš„æ„æ€ï¼Œä¿å­˜ç€ä¾èµ–æœ¬æ•°æ®çš„<strong>è§‚å¯Ÿè€… Watcher</strong></p><h4 id="Dep-target"><a href="#Dep-target" class="headerlink" title="Dep.target"></a>Dep.target</h4><p>å…¨å±€å˜é‡ï¼ŒæŒ‡å‘ç›®å‰æ­£åœ¨ä½¿ç”¨çš„ watcher</p><ul><li><strong>targetStack</strong>ï¼šæ ˆç»“æ„ï¼Œç”¨æ¥ä¿å­˜Watcher</li><li><strong>pushTarget</strong>ï¼šå¾€ targetStack ä¸­ push å½“å‰çš„ Watcherï¼ˆæ’åœ¨å‰ä¸€ä¸ªWatcherçš„åé¢ï¼‰ï¼Œå¹¶æŠŠ  Dep.target  èµ‹å€¼ç»™å½“å‰ Watcher</li><li><strong>popTarget</strong>ï¼šå…ˆæŠŠ targetStack æœ€åä¸€ä¸ªå…ƒç´ å¼¹å‡º(.pop)ï¼Œå†æŠŠ Dep.target èµ‹å€¼ç»™æœ€åä¸€ä¸ªWatcher(ä¹Ÿå°±æ˜¯è¿˜åŸäº†å‰ä¸€ä¸ªWatcher)</li><li>é€šè¿‡ä¸Šè¿°å®ç°ï¼Œvue ä¿è¯äº† å…¨å±€å”¯ä¸€çš„ Watcherï¼Œå‡†ç¡®èµ‹å€¼åœ¨ Dep.target ä¸­</li></ul><h4 id="dep-depend"><a href="#dep-depend" class="headerlink" title="dep.depend()"></a>dep.depend()</h4><p>Dep ç±»ä¸­æœ‰ä¸ªä¸€ä¸ª depend() æ–¹æ³•ï¼Œè¿›è¡Œ<strong>ä¾èµ–æ”¶é›†</strong></p><p>ä½†ä»–ä¸ä¼šç›´æ¥å°† watcher å­˜æ”¾åœ¨ subs ä¸­</p><p>è€Œæ˜¯è°ƒç”¨ <code>Dep.target.addDep()</code> ï¼š</p><p>é€šçŸ¥ watcher å…ˆå­˜æ”¾ dep ï¼ˆå»é‡ï¼‰</p><p>å†è°ƒç”¨ <code>dep.addSub()</code> è®© dep å­˜å‚¨è¯¥ watcher</p><p><strong>è¿™æ ·ä¾¿å®Œæˆäº†åŒå‘å­˜å‚¨ï¼Œå¹¶ä¸”ä¸ä¼šé‡å¤å­˜å‚¨</strong></p><div align="center">    <img src="/2023/07/11/Vue2æºç ï¼šä¾èµ–æ”¶é›† æ´¾å‘æ›´æ–°/dep1.png" style="height: 230px; width: 300px;"></div><h4 id="dep-notify"><a href="#dep-notify" class="headerlink" title="dep.notify()"></a>dep.notify()</h4><p>è§¦å‘æ•°æ®åŠ«æŒçš„ setter æ—¶ä¼šæ‰§è¡Œè¿™ä¸ª dep.notify() </p><p>ä¼šéå† subs</p><p>é€šçŸ¥ watcher æ‰§è¡Œ  <code>.update()</code> æ–¹æ³• å»<strong>æ´¾å‘æ›´æ–°</strong></p><h2 id="3-2-Watcher"><a href="#3-2-Watcher" class="headerlink" title="3.2 Watcher"></a>3.2 Watcher</h2><p>è§‚å¯Ÿè€…ï¼Œæ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€id</p><p>åŒæ—¶è¦æ³¨æ„çš„æ˜¯ï¼Œwatcheræœ‰ä¸‰ç§ï¼šrender watcherã€ computed watcher (lazyä¸ºtrue)ã€user watcher (userä¸ºtrue)</p><h4 id="addDep"><a href="#addDep" class="headerlink" title="addDep()"></a>addDep()</h4><p>è¿™ä¸ªæ–¹æ³•ä¸Šé¢è¯´è¿‡äº†ï¼Œç”¨æ¥åŒå‘å­˜å‚¨</p><h4 id="update"><a href="#update" class="headerlink" title="update()"></a>update()</h4><p>æ´¾å‘æ›´æ–°</p><p>è¿™é‡Œä¼šè¿›è¡Œåˆ¤æ–­ï¼š</p><p>å¦‚æœ lazy ä¸º trueï¼Œè¯´æ˜æ˜¯è®¡ç®—å±æ€§ï¼Œåˆ™å°† dirty è®¾ç½®ä¸º true</p><p>æˆ–è€…å°±è¿›è¡Œæ‰§è¡Œ <code>queueWatcher</code> è¿›è¡Œå¼‚æ­¥æ›´æ–°</p><blockquote><p>å¼‚æ­¥æ›´æ–°æ–‡ç« ï¼š</p><p><a href="https://icheng.github.io/2023/07/08/Vue2%E6%BA%90%E7%A0%81%EF%BC%9AnextTick%E5%8E%9F%E7%90%86/">https://icheng.github.io/2023/07/08/Vue2%E6%BA%90%E7%A0%81%EF%BC%9AnextTick%E5%8E%9F%E7%90%86/</a></p></blockquote><h4 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h4><p>update() åï¼Œè¿›å…¥å¼‚æ­¥æ›´æ–°ï¼Œå¼‚æ­¥æ›´æ–°çš„ flushSchedulerQueue() è¿˜æ˜¯ä¼šæ‰§è¡Œè¿™ä¸ªget()æ–¹æ³•</p><ul><li>è°ƒç”¨depçš„pushTarget</li><li>è°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆå¦‚æ¸²æŸ“æ›´æ–°æ–¹æ³• <code>vm._update(vm._render())</code> ï¼‰</li><li>popTarget</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm)  <span class="comment">// è°ƒç”¨å‡½æ•°</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: any) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, vm, <span class="string">`getter for watcher &quot;<span class="subst">$&#123;<span class="variable language_">this</span>.expression&#125;</span>&quot;`</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// &quot;touch&quot; every property so they are all tracked as</span></span><br><span class="line">      <span class="comment">// dependencies for deep watching</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123;</span><br><span class="line">        <span class="title function_">traverse</span>(value)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">popTarget</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">cleanupDeps</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-Observe-ä¾èµ–æ”¶é›†çš„å…¥å£"><a href="#3-3-Observe-ä¾èµ–æ”¶é›†çš„å…¥å£" class="headerlink" title="3.3 Observe ä¾èµ–æ”¶é›†çš„å…¥å£"></a>3.3 Observe ä¾èµ–æ”¶é›†çš„å…¥å£</h2><p>ä¹‹å‰çš„æ–‡ç« è®²è¿‡ï¼ŒObserver ä¼šå°†æ•°æ®æ ‡è®°<strong>å·²è§‚æµ‹æ•°æ®</strong></p><p>å¹¶é€šè¿‡ Object.defineProperty çš„ get&#x2F;set åŠ«æŒæ•°æ®çš„è¯»å–å’Œä¿®æ”¹</p><p>åŠ«æŒæ•°æ® <code>getter</code> æ—¶è¿›è¡Œ<strong>ä¾èµ–æ”¶é›†</strong>ï¼Œå¦‚æœ <code>Dep.target</code> å­˜åœ¨ï¼Œå°±è°ƒç”¨ <code>dep.depend()</code></p><p>åŠ«æŒæ•°æ® <code>setter</code> æ—¶<strong>æ´¾å‘æ›´æ–°</strong>ï¼Œè°ƒç”¨ <code>dep.notify()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> <span class="title function_">reactiveGetter</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.<span class="title function_">call</span>(obj) : val</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">          dep.<span class="title function_">depend</span>(&#123;</span><br><span class="line">            <span class="attr">target</span>: obj,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>,</span><br><span class="line">            key</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          dep.<span class="title function_">depend</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.<span class="property">dep</span>.<span class="title function_">depend</span>()</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line">            <span class="title function_">dependArray</span>(value)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">isRef</span>(value) &amp;&amp; !shallow ? value.<span class="property">value</span> : value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> <span class="title function_">reactiveSetter</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.<span class="title function_">call</span>(obj) : val</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title function_">hasChanged</span>(value, newVal)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (__DEV__ &amp;&amp; customSetter) &#123;</span><br><span class="line">        <span class="title function_">customSetter</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">        setter.<span class="title function_">call</span>(obj, newVal)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (getter) &#123;</span><br><span class="line">        <span class="comment">// #7981: for accessor properties without setter</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!shallow &amp;&amp; <span class="title function_">isRef</span>(value) &amp;&amp; !<span class="title function_">isRef</span>(newVal)) &#123;</span><br><span class="line">        value.<span class="property">value</span> = newVal</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val = newVal</span><br><span class="line">      &#125;</span><br><span class="line">      childOb = !shallow &amp;&amp; <span class="title function_">observe</span>(newVal, <span class="literal">false</span>, mock)</span><br><span class="line">      <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">        dep.<span class="title function_">notify</span>(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="title class_">TriggerOpTypes</span>.<span class="property">SET</span>,</span><br><span class="line">          <span class="attr">target</span>: obj,</span><br><span class="line">          key,</span><br><span class="line">          <span class="attr">newValue</span>: newVal,</span><br><span class="line">          <span class="attr">oldValue</span>: value</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dep.<span class="title function_">notify</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯å¦ç»†èŠ‚å¤ªå¤šç»•æ™•äº†ï¼Ÿ</p><p><strong>æ¥ä¸ªåˆå§‹åŒ–æ—¶çš„æ•´ä½“æµç¨‹ï¼Œä»å®è§‚è§’åº¦å†è¿‡ä¸€é</strong></p><h1 id="3-åˆå§‹åŒ–æµç¨‹"><a href="#3-åˆå§‹åŒ–æµç¨‹" class="headerlink" title="3 åˆå§‹åŒ–æµç¨‹"></a>3 åˆå§‹åŒ–æµç¨‹</h1><p>æ¯”å¦‚æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ <code>&#123;&#123;name&#125;&#125;</code></p><p>ç»„ä»¶æŒ‚è½½è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œ new Watcherï¼Œåˆ›å»ºä¸€ä¸ªæ¸²æŸ“watcher</p><p>å¹¶ä¼ å…¥å‚æ•°ï¼šæ¸²æŸ“æ›´æ–°æ–¹æ³• <code>vm._update(vm._render())</code></p><blockquote><p>æºç ä½ç½®ï¼švue-main\src\core\instance\lifecycle.ts  ï¼ˆmountComponentï¼‰</p></blockquote><p>å› ä¸ºä¸æ˜¯ computed  watcher ï¼Œä¼šé»˜è®¤æ‰§è¡Œ get() æ–¹æ³•ï¼š</p><ul><li><p>pushTarget() ï¼šå½“å‰ Dep.target æŒ‡å‘è¿™ä¸ªæ¸²æŸ“watcher</p></li><li><p>è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå½“å‰å‡½æ•°æ˜¯æ¸²æŸ“æ›´æ–°æ–¹æ³• <code>vm._update(vm._render())</code></p><p>é¦–å…ˆ <code>vm._render()</code> ä¼šå»å®ä¾‹ä¸­å–æ–°å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ™è°ƒç”¨ <code>Object.defineProperty</code> çš„ getï¼Œå½“å‰ <code>Dep.target</code> æ˜¯å­˜åœ¨çš„ï¼Œä¼šæ‰§è¡Œ <code>dep.depend()</code> ï¼Œè¿›è¡Œ<strong>ä¾èµ–æ”¶é›†</strong></p><p>é‚£ä¹ˆ dep å’Œ watcher çš„åŒå‘å­˜å‚¨å°±å®Œæˆäº†</p><p>ç„¶å <code>vm._update()</code> ä¼šå°†è™šæ‹ŸDOMè½¬ä¸ºçœŸå®DOMï¼Œæ¶‰åŠdiffç®—æ³•ç­‰ç­‰ï¼Œæ€»ä¹‹æ¸²æŸ“å®Œæˆ</p></li><li><p>popTarget()ï¼š Dep.target ä¸éœ€è¦æŒ‡å‘è¿™ä¸ªæ¸²æŸ“watcheräº†</p></li><li><p>åŒæ—¶ä¼šå­˜å‚¨ç›®å‰çš„å±æ€§å€¼ï¼Œå­˜å‚¨åœ¨valueï¼Œæ–¹ä¾¿åé¢åˆ¤æ–­å€¼æ˜¯å¦ä¿®æ”¹äº†</p></li></ul><p>çœ‹çœ‹æºç ï¼š</p><blockquote><p>æºç ä½ç½®ï¼švue-main\src\core\observer\watcher.ts</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> ? <span class="literal">undefined</span> : <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/07/11/Vue2æºç ï¼šä¾èµ–æ”¶é›† æ´¾å‘æ›´æ–°/åˆå§‹åŒ–æµç¨‹.png" style="height: 230px; width: 580px;"></div><h1 id="4-ä¿®æ”¹å€¼æµç¨‹"><a href="#4-ä¿®æ”¹å€¼æµç¨‹" class="headerlink" title="4 ä¿®æ”¹å€¼æµç¨‹"></a>4 ä¿®æ”¹å€¼æµç¨‹</h1><p>é‚£ä¹ˆä¿®æ”¹å€¼çš„è¿‡ç¨‹ï¼Œä¸»è¦å°±æ˜¯å¤šäº†åŠ«æŒgetterå’Œå¼‚æ­¥æ›´æ–°</p><div align="center">    <img src="/2023/07/11/Vue2æºç ï¼šä¾èµ–æ”¶é›† æ´¾å‘æ›´æ–°/ä¿®æ”¹å€¼æµç¨‹.png" style="height: 530px; width: 880px;"></div>]]></content>
      
      
      <categories>
          
          <category> æºç è§£æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æºç (2)ï¼šæ•°æ®åŠ«æŒåŸç†</title>
      <link href="/2023/07/10/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81%E5%8E%9F%E7%90%86/"/>
      <url>/2023/07/10/Vue2%E6%BA%90%E7%A0%81%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1-æ•°æ®åŠ«æŒæ˜¯ä»€ä¹ˆ"><a href="#1-æ•°æ®åŠ«æŒæ˜¯ä»€ä¹ˆ" class="headerlink" title="1 æ•°æ®åŠ«æŒæ˜¯ä»€ä¹ˆ"></a>1 æ•°æ®åŠ«æŒæ˜¯ä»€ä¹ˆ</h1><p>Vue æœ€ç‹¬ç‰¹çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œæ˜¯å…¶å“åº”å¼ç³»ç»Ÿã€‚</p><p>è€Œå®ç°å“åº”å¼çš„è¿‡ç¨‹ä¸­ï¼Œè¦å®ç°<strong>æ•°æ®åŠ«æŒ</strong>æ‰èƒ½ç›‘å¬æ•°æ®çš„å˜åŒ–</p><p>æ•°æ®åŠ«æŒå°±æ˜¯ï¼šæ‹¦æˆªå±æ€§çš„è¯»å–å’Œä¿®æ”¹ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ•°æ®çš„ä»»ä½•å˜åŒ–éƒ½è¦èƒ½ç›‘æµ‹åˆ°ï¼Œè¿™æ ·æ‰èƒ½æ ¹æ®æ•°æ®å˜åŒ–åšå¯¹åº”æ“ä½œ</p><h1 id="2-æ•°æ®åŠ«æŒæºç é€»è¾‘"><a href="#2-æ•°æ®åŠ«æŒæºç é€»è¾‘" class="headerlink" title="2 æ•°æ®åŠ«æŒæºç é€»è¾‘"></a>2 æ•°æ®åŠ«æŒæºç é€»è¾‘</h1><h2 id="2-1-initState-åˆå§‹åŒ–"><a href="#2-1-initState-åˆå§‹åŒ–" class="headerlink" title="2.1 initState() åˆå§‹åŒ–"></a>2.1 initState() åˆå§‹åŒ–</h2><p>Vue åœ¨æ‰§è¡Œå®Œç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•° <code>beforeCreate</code> ä¹‹åï¼Œä¼šæ ¹æ®é…ç½®é¡¹æ˜¯å¦å­˜åœ¨ï¼Œæ‰§è¡Œå¯¹åº”çš„ç›¸åº”çš„åˆå§‹åŒ–ï¼ˆå¦‚Propsã€methodsã€dataã€computedç­‰ç­‰ï¼‰</p><p><strong>å¦‚æœ data å­˜åœ¨</strong></p><p>ä¼šæ‰§è¡Œ <code>initData()</code>ï¼Œè¿›è¡Œ data æ•°æ®åˆå§‹åŒ–æ“ä½œ</p><p>ä¸‹é¢è¿›è¡Œ <code>initData()</code> åˆå§‹åŒ–çš„åˆ†æ</p><p>è¿™é‡Œçš„æºç ï¼š</p><blockquote><p>vue-main\src\core\instance\state.ts</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initState</span>(<span class="params">vm: Component</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> opts = vm.<span class="property">$options</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">props</span>) <span class="title function_">initProps</span>(vm, opts.<span class="property">props</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Composition API</span></span><br><span class="line">  <span class="title function_">initSetup</span>(vm)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">methods</span>) <span class="title function_">initMethods</span>(vm, opts.<span class="property">methods</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//  data æ•°æ®åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">data</span>) &#123;</span><br><span class="line">    <span class="title function_">initData</span>(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ob = <span class="title function_">observe</span>((vm.<span class="property">_data</span> = &#123;&#125;))</span><br><span class="line">    ob &amp;&amp; ob.<span class="property">vmCount</span>++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">computed</span>) <span class="title function_">initComputed</span>(vm, opts.<span class="property">computed</span>)</span><br><span class="line">  <span class="keyword">if</span> (opts.<span class="property">watch</span> &amp;&amp; opts.<span class="property">watch</span> !== nativeWatch) &#123;</span><br><span class="line">    <span class="title function_">initWatch</span>(vm, opts.<span class="property">watch</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-initData-æ•°æ®åˆå§‹åŒ–"><a href="#2-2-initData-æ•°æ®åˆå§‹åŒ–" class="headerlink" title="2.2 initData()  æ•°æ®åˆå§‹åŒ–"></a>2.2 initData()  æ•°æ®åˆå§‹åŒ–</h2><p>è¿›å…¥ <code>initData()</code> ï¼Œ<strong>ä¸»è¦åšäº† 3 ä»¶äº‹ï¼š</strong></p><p>1 é¦–å…ˆå°±æ˜¯<strong>åˆ¤æ–­ data çš„ç±»å‹</strong></p><ul><li>å¦‚æœ data æ˜¯å‡½æ•°ï¼Œå°±è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè¿”å›æ•°æ®</li><li>å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡</li></ul><blockquote><p>å½“ç„¶ï¼Œæˆ‘ä»¬çŸ¥é“ data è¿˜æ˜¯å¸Œæœ›å†™æˆå‡½æ•°ç±»å‹çš„ï¼š</p><p>å› ä¸ºæ•°æ®ä»¥å‡½æ•°è¿”å›å€¼å½¢å¼å®šä¹‰ï¼Œè¿™æ ·æ¯å¤ç”¨ä¸€æ¬¡ç»„ä»¶ï¼Œå°±ä¼šè¿”å›ä¸€ä»½æ–°çš„<code>data</code>ï¼Œæ‹¥æœ‰è‡ªå·±çš„<a href="https://so.csdn.net/so/search?q=%E4%BD%9C%E7%94%A8%E5%9F%9F&spm=1001.2101.3001.7020">ä½œç”¨åŸŸ</a>ï¼Œç±»ä¼¼äºç»™æ¯ä¸ªç»„ä»¶å®ä¾‹åˆ›å»ºä¸€ä¸ªç§æœ‰çš„æ•°æ®ç©ºé—´ï¼Œè®©å„ä¸ªç»„ä»¶å®ä¾‹ç»´æŠ¤å„è‡ªçš„æ•°æ®</p><p>æˆ‘ä»¬ç»„ä»¶çš„dateå•çº¯çš„å†™æˆå¯¹è±¡å½¢å¼ï¼Œè¿™äº›å®ä¾‹ç”¨çš„æ˜¯åŒä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”±äºJavaScriptçš„ç‰¹æ€§æ‰€å¯¼è‡´ï¼Œæ‰€æœ‰çš„ç»„ä»¶å®ä¾‹å…±ç”¨äº†ä¸€ä¸ªdataï¼Œå°±ä¼šé€ æˆè¯¥ç»„ä»¶çš„æ•°æ®ä¼šè¢«å…¶ä»–ç»„ä»¶åº”å½±å“</p></blockquote><p>2 å¦‚æœmethodsã€props å’Œ data ä¸­æ²¡æœ‰é‡åçš„å±æ€§ï¼Œå°±ç”¨ <strong>proxy ä»£ç† data ä¸­çš„å±æ€§åˆ° vm ä¸Š</strong></p><p>å³ï¼š <code>vm.name -&gt; vm._data.name</code></p><p>3 è°ƒç”¨ <strong>observe() è¿›è¡Œæ•°æ®åŠ«æŒ</strong>ï¼Œè¿™é‡Œå°±æ˜¯æ•°æ®åŠ«æŒçœŸæ­£çš„å¼€å§‹</p><p>è¿™éƒ¨åˆ†çš„æºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initData</span>(<span class="params">vm: Component</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">data</span>: any = vm.<span class="property">$options</span>.<span class="property">data</span></span><br><span class="line">  data = vm.<span class="property">_data</span> = <span class="title function_">isFunction</span>(data) ? <span class="title function_">getData</span>(data, vm) : data || &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    __DEV__ &amp;&amp;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;data functions should return an object:\n&#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;https://v2.vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy data on instance</span></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data)</span><br><span class="line">  <span class="keyword">const</span> props = vm.<span class="property">$options</span>.<span class="property">props</span></span><br><span class="line">  <span class="keyword">const</span> methods = vm.<span class="property">$options</span>.<span class="property">methods</span></span><br><span class="line">  <span class="keyword">let</span> i = keys.<span class="property">length</span></span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="keyword">if</span> (methods &amp;&amp; <span class="title function_">hasOwn</span>(methods, key)) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(<span class="string">`Method &quot;<span class="subst">$&#123;key&#125;</span>&quot; has already been defined as a data property.`</span>, vm)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (props &amp;&amp; <span class="title function_">hasOwn</span>(props, key)) &#123;</span><br><span class="line">      __DEV__ &amp;&amp;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">`The data property &quot;<span class="subst">$&#123;key&#125;</span>&quot; is already declared as a prop. `</span> +</span><br><span class="line">            <span class="string">`Use prop default value instead.`</span>,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="title function_">isReserved</span>(key)) &#123;</span><br><span class="line">      <span class="title function_">proxy</span>(vm, <span class="string">`_data`</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// observe data</span></span><br><span class="line">  <span class="keyword">const</span> ob = <span class="title function_">observe</span>(data)</span><br><span class="line">  ob &amp;&amp; ob.<span class="property">vmCount</span>++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3-observe"><a href="#2-3-observe" class="headerlink" title="2.3 observe()"></a>2.3 observe()</h2><p>è¿™é‡Œä¸»è¦åšä¸€äº›è§„èŒƒå¤„ç†ã€‚æ¥ä¸‹æ¥ä¸»è¦åˆ—ä¸€äº›ä»€ä¹ˆæƒ…å†µä¸‹æ•°æ®ä¼šè¢«æ ‡è®°ä¸ºå“åº”å¼ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¸è¢«å“åº”å¼</p><ul><li>å¦‚æœä¸æ˜¯æ•°ç»„&#x2F;å¯¹è±¡ï¼Œåˆ™returnï¼Œä¸ç»§ç»­æ‰§è¡Œï¼›</li><li>å¦‚æœè¯¥æ•°æ®æ˜¯ <code>Observer</code> ç±»çš„å®ä¾‹ï¼Œåˆ™æ„å‘³ç€å½“å‰å±æ€§å·²è¢«æ ‡è®°ä¸ºå“åº”å¼æ•°æ®ï¼Œæ— éœ€å¤„ç†</li><li>return new Observer() å°†å…¶æ ‡è®°ä¸ºå“åº”å¼æ•°æ®</li></ul><p>è¿™éƒ¨åˆ†çš„æºç ï¼š</p><blockquote><p>vue-main\src\core\observer\index.ts</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params"></span></span><br><span class="line"><span class="params">  value: any,</span></span><br><span class="line"><span class="params">  shallow?: boolean,</span></span><br><span class="line"><span class="params">  ssrMockReactivity?: boolean</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Observer</span> | <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (value &amp;&amp; <span class="title function_">hasOwn</span>(value, <span class="string">&#x27;__ob__&#x27;</span>) &amp;&amp; value.<span class="property">__ob__</span> <span class="keyword">instanceof</span> <span class="title class_">Observer</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value.<span class="property">__ob__</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    shouldObserve &amp;&amp;</span><br><span class="line">    (ssrMockReactivity || !<span class="title function_">isServerRendering</span>()) &amp;&amp;</span><br><span class="line">    (<span class="title function_">isArray</span>(value) || <span class="title function_">isPlainObject</span>(value)) &amp;&amp;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(value) &amp;&amp;</span><br><span class="line">    !value.<span class="property">__v_skip</span> <span class="comment">/* ReactiveFlags.SKIP */</span> &amp;&amp;</span><br><span class="line">    !<span class="title function_">isRef</span>(value) &amp;&amp;</span><br><span class="line">    !(value <span class="keyword">instanceof</span> <span class="title class_">VNode</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Observer</span>(value, shallow, ssrMockReactivity)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-4-Observerç±»"><a href="#2-4-Observerç±»" class="headerlink" title="2.4 Observerç±»"></a>2.4 Observerç±»</h2><p><code>Observer</code> æ„é€ å‡½æ•°ä¼šçœŸæ­£çš„å°†æ•°æ®æ ‡è®°ä¸ºå“åº”å¼</p><ul><li><p>é¦–å…ˆç»™å±æ€§å¢åŠ ä¸€ä¸ª<strong>ä¸å¯æšä¸¾çš„ <code>__ob__</code> å¯¹è±¡</strong> ï¼Œè¡¨æ˜<strong>å·²è¢«è§‚æµ‹</strong> (ä¸ºå•¥è¦ä¸å¯æšä¸¾ï¼Ÿä¸ºäº†ä¸å½±å“å®é™…å¼€å‘ï¼Œæ¯”å¦‚ <code>for..in..</code> å¾ªç¯çš„æ—¶å€™ä¸éå†åˆ° <code>__ob__</code> å±æ€§)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">def</span>(value, <span class="string">&#x27;__ob__&#x27;</span>, <span class="variable language_">this</span>)      <span class="comment">//ç»™å±æ€§å¢åŠ ä¸€ä¸ª**ä¸å¯æšä¸¾çš„ `__ob__` å¯¹è±¡**</span></span><br></pre></td></tr></table></figure></li><li><p>ç„¶åå°±æ˜¯åˆ¤æ–­å½“å‰å±æ€§<strong>æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡</strong></p></li></ul><h3 id="2-4-1-å¦‚æœæ˜¯æ•°ç»„"><a href="#2-4-1-å¦‚æœæ˜¯æ•°ç»„" class="headerlink" title="2.4.1 å¦‚æœæ˜¯æ•°ç»„"></a>2.4.1 å¦‚æœæ˜¯æ•°ç»„</h3><h6 id="å…ˆå¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œç›‘æµ‹"><a href="#å…ˆå¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œç›‘æµ‹" class="headerlink" title="å…ˆå¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œç›‘æµ‹"></a>å…ˆå¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œç›‘æµ‹</h6><p><strong>è°ƒç”¨ observeArray()</strong> ï¼Œéå†æ•°ç»„ï¼Œå¯¹æ¯ä¸€å…ƒç´ è°ƒç”¨ <code>observe()</code> æ–¹æ³•å°†å…ƒç´ å˜ä¸ºå“åº”å¼æ•°æ®</p><p>è¿™é‡Œçš„æºç ï¼š</p><blockquote><p>vue-main\src\core\observer\index.ts</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">observeArray</span>(<span class="params">value: any[]</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = value.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="title function_">observe</span>(value[i], <span class="literal">false</span>, <span class="variable language_">this</span>.<span class="property">mock</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ‹¦æˆªæ•°ç»„æ–¹æ³•"><a href="#æ‹¦æˆªæ•°ç»„æ–¹æ³•" class="headerlink" title="æ‹¦æˆªæ•°ç»„æ–¹æ³•"></a>æ‹¦æˆªæ•°ç»„æ–¹æ³•</h6><blockquote><p>æœ‰äº›æ–¹æ³•ä¼šä¿®æ”¹æ•°ç»„æœ¬èº«ï¼Œè¿™äº›æ–¹æ³•è¢«ç§°ä¸º<strong>å˜å¼‚æ–¹æ³•</strong> ï¼ˆpushã€popã€shiftã€unshiftã€spliceã€sortã€reverseï¼‰</p><p>å½“å¼€å‘è€…è°ƒç”¨è¿™äº›æ–¹æ³•ä¿®æ”¹<code>data</code>ä¸­çš„æ•°ç»„æ•°æ®çš„æ—¶å€™ï¼Œ<code>Vue</code>éœ€è¦åŠæ—¶å¾—çŸ¥å¹¶ä½œå‡ºååº”</p></blockquote><ul><li>é¦–å…ˆï¼Œæ‹¿åˆ°æ•°ç»„çš„åŸå‹é“¾<code>Array.prototype</code>ï¼Œé€šè¿‡<code>Object.create</code> å¤åˆ¶ä¸€ä»½</li></ul><blockquote><p>å› ä¸ºéœ€è¦åœ¨æ•°ç»„åŸå‹ä¸Šä¿®æ”¹7ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ç›´æ¥ä¿®æ”¹ä¼šå¹²æ‰åŸæœ‰çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ <code>Object.create()</code> æ‹·è´ä¸€ä»½æ•°ç»„åŸå‹å‡ºæ¥ï¼Œåœ¨å¤åˆ¶å‡ºæ¥çš„åŸå‹ä¸Šé¢åšåŠŸèƒ½æ‰©å±•</p></blockquote><ul><li>ç„¶åï¼Œä¼šè°ƒç”¨åŸç”Ÿæ•°ç»„æ–¹æ³•ï¼ˆæ¯•ç«Ÿä¸èƒ½å½±å“æ•°ç»„åŸæœ¬çš„åŠŸèƒ½ï¼‰</li><li>å…³é”®åœ¨äºä»£ç ä¸­é—´éƒ¨åˆ†ï¼Œä»–ä¼šè°ƒç”¨ <code>__ob__.dep</code> çš„ <code>notify </code>æ–¹æ³•å»é€šçŸ¥watcherï¼Œå‘Šè¯‰å¯¹æ–¹ï¼šæˆ‘æœ‰å˜åŒ–äº†ï¼Œä½ å¿«æ›´æ–°å§ï¼›</li><li>å¦‚æœæ˜¯èƒ½å¢åŠ æ•°ç»„é•¿åº¦çš„ 3 ä¸ªæ–¹æ³• <code>pushã€unshiftã€splice</code> ï¼Œè·å–åˆ°æ’å…¥çš„å€¼ï¼Œç„¶åæŠŠæ–°æ·»åŠ çš„å€¼å˜æˆä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼ˆå†æ¬¡è°ƒç”¨observeArray()ï¼‰ã€‚</li></ul><p>è¿™é‡Œçš„æºç ï¼š</p><blockquote><p>vue-main\src\core\observer\array.ts</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arrayProto = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> arrayMethods = <span class="title class_">Object</span>.<span class="title function_">create</span>(arrayProto)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> methodsToPatch = [</span><br><span class="line">  <span class="string">&#x27;push&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pop&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;shift&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;unshift&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;splice&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;sort&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;reverse&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Intercept mutating methods and emit events</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">methodsToPatch.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">method</span>) &#123;</span><br><span class="line">  <span class="comment">// cache original method</span></span><br><span class="line">  <span class="keyword">const</span> original = arrayProto[method]  </span><br><span class="line">  <span class="title function_">def</span>(arrayMethods, method, <span class="keyword">function</span> <span class="title function_">mutator</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = original.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)   <span class="comment">// è°ƒç”¨åŸç”Ÿæ•°ç»„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> ob = <span class="variable language_">this</span>.<span class="property">__ob__</span></span><br><span class="line">    <span class="keyword">let</span> inserted</span><br><span class="line">    <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;unshift&#x27;</span>:</span><br><span class="line">        inserted = args</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;splice&#x27;</span>:</span><br><span class="line">        inserted = args.<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (inserted) ob.<span class="title function_">observeArray</span>(inserted)</span><br><span class="line">    <span class="comment">// notify change</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      ob.<span class="property">dep</span>.<span class="title function_">notify</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">TriggerOpTypes</span>.<span class="property">ARRAY_MUTATION</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="variable language_">this</span>,</span><br><span class="line">        <span class="attr">key</span>: method</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ob.<span class="property">dep</span>.<span class="title function_">notify</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="vueä¸ºä»€ä¹ˆæ²¡æœ‰æä¾›å¯¹æ•°ç»„å±æ€§çš„ç›‘å¬å‘¢ï¼Ÿ"><a href="#vueä¸ºä»€ä¹ˆæ²¡æœ‰æä¾›å¯¹æ•°ç»„å±æ€§çš„ç›‘å¬å‘¢ï¼Ÿ" class="headerlink" title="vueä¸ºä»€ä¹ˆæ²¡æœ‰æä¾›å¯¹æ•°ç»„å±æ€§çš„ç›‘å¬å‘¢ï¼Ÿ"></a>vueä¸ºä»€ä¹ˆæ²¡æœ‰æä¾›å¯¹æ•°ç»„å±æ€§çš„ç›‘å¬å‘¢ï¼Ÿ</h4><ul><li>å¦‚æœé€šè¿‡ç´¢å¼•ä¿®æ”¹æ•°ç»„ã€æˆ–ä¿®æ”¹æ•°ç»„é•¿åº¦ï¼Œæ˜¯æ— æ³•è¢«æ‹¦æˆªåˆ°çš„</li></ul><p>æ—¢ç„¶ Object.defineProperty æœ‰åŠ«æŒgetterï¼Œsetterèƒ½åŠ›ï¼Œé‚£ä¹ˆ vue ä¸ºä»€ä¹ˆæ²¡ç”¨å®ƒæ¥å®ç°å¯¹æ•°ç»„å±æ€§çš„ç›‘å¬å‘¢ï¼Ÿ</p><p>å°¤å¤§åœ¨<a href="https://link.juejin.cn/?target=https://github.com/vuejs/vue/issues/8562">github</a>ä¸Šè¿™æ ·å›ç­”ï¼š</p><div align="center">    <img src="/2023/07/10/Vue2æºç ï¼šæ•°æ®åŠ«æŒåŸç†/1.jpg" style="height: 850px; width: 600px;"></div><p>å¦‚æœä½ çŸ¥é“æ•°ç»„çš„é•¿åº¦ï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥é¢„å…ˆç»™æ‰€æœ‰çš„ç´¢å¼•è®¾ç½® getter&#x2F;setter çš„ã€‚ä½†æ˜¯ä¸€æ¥å¾ˆå¤šåœºæ™¯ä¸‹ä½ ä¸çŸ¥é“æ•°ç»„çš„é•¿åº¦ï¼ŒäºŒæ¥ï¼Œå¦‚æœæ˜¯å¾ˆå¤§çš„æ•°ç»„ï¼Œé¢„å…ˆåŠ  getter&#x2F;setter æ€§èƒ½è´Ÿæ‹…è¾ƒå¤§ã€‚</p><p>æ€»è€Œè¨€ä¹‹å°±æ˜¯ç†è®ºä¸Š Vue æ˜¯å¯ä»¥è¿™æ ·åšï¼Œä½†æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘æ²¡è¿™æ ·åšï¼Œè€Œæ˜¯ç”¨äº†ä¸€ç§æ•°ç»„å˜å¼‚åŠæ³•æ¥è§¦å‘è§†å›¾æ›´æ–°ã€‚</p><h3 id="2-4-2-å¦‚æœæ˜¯å¯¹è±¡"><a href="#2-4-2-å¦‚æœæ˜¯å¯¹è±¡" class="headerlink" title="2.4.2 å¦‚æœæ˜¯å¯¹è±¡"></a>2.4.2 å¦‚æœæ˜¯å¯¹è±¡</h3><p>éå†å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ ï¼Œæ‰§è¡Œ <code>defineReactive()</code> æ–¹æ³•é€»è¾‘å¦‚ä¸‹:</p><p>é¦–å…ˆ new Dep()ï¼Œè¯¥ dep åœ¨åé¢ get set æ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ª<strong>é—­åŒ…äº§ç”Ÿçš„ dep</strong>ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½æ˜ç™½äº†æ•°æ®å¯¹è±¡ä¸­æ¯ä¸ªæ•°æ®å­—æ®µéƒ½æœ‰å±äºè‡ªå·±çš„ <code>dep</code> å¸¸é‡ï¼ˆè¿™é‡Œæ¶‰åŠåˆ°ä¾èµ–æ”¶é›†ç†å¿µï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç¼“å­˜åŸæœ‰æè¿°å±æ€§ä¸­å¯èƒ½å­˜åœ¨çš„ <code>get</code> æ–¹æ³•å’Œ <code>set</code> æ–¹æ³•ï¼Œåˆ†åˆ«ç¼“å­˜åœ¨å˜é‡ <code>getter</code>ã€<code>setter </code>ä¸­ï¼Œä¸ºä»€ä¹ˆè¦ç¼“å­˜å‘¢ï¼Ÿä¸»è¦æ˜¯æ¥ä¸‹æ¥ä¼šæ‰§è¡Œ<code>Object.defineProperty  </code> é‡æ–°å®šä¹‰å±æ€§çš„ <code>getter/setter</code>ï¼Œè¿™ä¼šå¯¼è‡´åŸæœ‰çš„ <code>get</code>ã€<code>set</code> æ–¹æ³•è¢«é‡æ–°è¦†ç›–</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getter = property &amp;&amp; property.<span class="property">get</span></span><br><span class="line"><span class="keyword">const</span> setter = property &amp;&amp; property.<span class="property">set</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œé»˜è®¤ä¼šå°†å¯¹è±¡è¿›è¡Œæ·±åº¦åŠ«æŒ<strong>ï¼ˆå¦‚æœå¯¹è±¡å±‚çº§æ¯”è¾ƒæ·±ï¼Œæ˜¾ç„¶æ˜¯æ¯”è¾ƒå¤§çš„æ€§èƒ½è´Ÿæ‹…ï¼Œè¿™ä¹Ÿæ˜¯Vue3ä¼˜åŒ–çš„ä¸€ä¸ªé—®é¢˜ï¼‰</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">observe</span>()</span><br></pre></td></tr></table></figure><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æ‹¦æˆªå™¨çš„ <code>get</code> æ–¹æ³•éƒ½åšäº†äº›å•¥ï¼š</strong></p><p>å› ä¸ºæ˜¯è¯»å–å±æ€§ï¼Œé¦–å…ˆè¦ç¡®ä¿ä¸èƒ½å½±å“æ­£å¸¸é€»è¾‘ï¼Œè¦è°ƒç”¨å‰é¢ç¼“å­˜çš„ <code>getter</code>ï¼Œæ‹¿åˆ°æ­£ç¡®çš„è¿”å›ç»“æœ</p><p>ç„¶åå°±æ˜¯ <code>getter</code> çš„ä¸»è¦ä½¿å‘½ï¼Œæ”¶é›†ä¾èµ–ï¼š</p><p>è‹¥ <code>Dep.target</code> å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ<code>dep.depend()</code>ã€‚é‚£ä¹ˆ <code>Dep.target</code> æ˜¯ä»€ä¹ˆï¼Ÿå…¶å®å°±æ˜¯ watcher</p><p>ï¼ˆä¾èµ–æ”¶é›†å†…å®¹æ”¾åˆ°åé¢çš„æ–‡ç« è®²ï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">get</span>: <span class="keyword">function</span> <span class="title function_">reactiveGetter</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.<span class="title function_">call</span>(obj) : val     <span class="comment">// æ‹¿åˆ°æ­£ç¡®çš„è¿”å›ç»“æœ</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">          dep.<span class="title function_">depend</span>(&#123;      <span class="comment">//ä¾èµ–æ”¶é›†</span></span><br><span class="line">            <span class="attr">target</span>: obj,</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">TrackOpTypes</span>.<span class="property">GET</span>,</span><br><span class="line">            key</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          dep.<span class="title function_">depend</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.<span class="property">dep</span>.<span class="title function_">depend</span>()</span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_">isArray</span>(value)) &#123;</span><br><span class="line">            <span class="title function_">dependArray</span>(value)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">isRef</span>(value) &amp;&amp; !shallow ? value.<span class="property">value</span> : value</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æ‹¦æˆªå™¨çš„<code>set</code>æ–¹æ³•éƒ½åšäº†äº›å•¥ï¼š</strong></p><p><code>set </code> å‡½æ•°ä¸»è¦åšä¸¤ä»¶äº‹:</p><ul><li><p>å¦‚æœå€¼æ”¹å˜äº†ï¼Œè°ƒç”¨ç¼“å­˜çš„ setterï¼Œä¸ºå±æ€§è®¾ç½®æ–°å€¼ï¼›</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setter.<span class="title function_">call</span>(obj, newVal)</span><br></pre></td></tr></table></figure></li><li><p>é€šçŸ¥ watcher æ›´æ–°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dep.<span class="property">notify</span></span><br></pre></td></tr></table></figure></li></ul><p>è¿™ä¾¿æ˜¯æ•°æ®åŠ«æŒçš„ä¸»è¦å†…å®¹</p><p>æƒ³è¦ç†è§£å®ƒï¼Œè¿˜éœ€è¦çŸ¥é“ä¾èµ–æ”¶é›†ä¸­çš„ watcherã€depå…³ç³»</p><h1 id="3-Object-defineProperty-APIç¼ºç‚¹"><a href="#3-Object-defineProperty-APIç¼ºç‚¹" class="headerlink" title="3 Object.defineProperty APIç¼ºç‚¹"></a>3 Object.defineProperty APIç¼ºç‚¹</h1><h2 id="3-1-ä¸èƒ½ç›‘å¬å¯¹è±¡-x2F-æ•°ç»„æ–°å¢å’Œåˆ é™¤"><a href="#3-1-ä¸èƒ½ç›‘å¬å¯¹è±¡-x2F-æ•°ç»„æ–°å¢å’Œåˆ é™¤" class="headerlink" title="3.1 ä¸èƒ½ç›‘å¬å¯¹è±¡&#x2F;æ•°ç»„æ–°å¢å’Œåˆ é™¤"></a>3.1 ä¸èƒ½ç›‘å¬å¯¹è±¡&#x2F;æ•°ç»„æ–°å¢å’Œåˆ é™¤</h2><p>åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¯¹è±¡å±æ€§peo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; peo &#125;&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹å‡»äº‹ä»¶ï¼Œä¸ºå¯¹è±¡æ–°å¢ä¸€ä¸ªå±æ€§ c ï¼Œä½†æ˜¯ç•Œé¢ä¸ä¼šæ›´æ–°æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.peo.c = &#x27;5555&#x27;</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><p>ä½¿ç”¨ <strong>this.$set(object, key, value)</strong> æ–°å¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$set(this.peo, &#x27;c&#x27;, 5555);</span><br></pre></td></tr></table></figure><p>è€Œæ•°ç»„å‰é¢è¯´è¿‡äº†ï¼Œåªèƒ½é€šè¿‡spliceã€pushã€unshiftæ–¹æ³•æ–°å¢å’Œåˆ é™¤ï¼Œç›´æ¥ä¿®æ”¹æ•°ç»„ç´¢å¼•ï¼Œä¹Ÿæ˜¯æ— æ³•ç›‘å¬çš„</p><h2 id="3-2-åˆå§‹åŒ–é˜¶æ®µé€’å½’æ‰§è¡Œ-Object-defineProperty-å¸¦æ¥çš„æ€§èƒ½è´Ÿæ‹…"><a href="#3-2-åˆå§‹åŒ–é˜¶æ®µé€’å½’æ‰§è¡Œ-Object-defineProperty-å¸¦æ¥çš„æ€§èƒ½è´Ÿæ‹…" class="headerlink" title="3.2 åˆå§‹åŒ–é˜¶æ®µé€’å½’æ‰§è¡Œ Object.defineProperty å¸¦æ¥çš„æ€§èƒ½è´Ÿæ‹…"></a>3.2 åˆå§‹åŒ–é˜¶æ®µé€’å½’æ‰§è¡Œ Object.defineProperty å¸¦æ¥çš„æ€§èƒ½è´Ÿæ‹…</h2><p>ä¸ºäº†å°†å¯¹è±¡æ·±åº¦åŠ«æŒï¼Œä¼šé€’å½’æ‰§è¡ŒObject.definePropertyï¼Œå¦‚æœå¯¹è±¡å±‚çº§æ¯”è¾ƒæ·±ï¼Œæ˜¾ç„¶æ˜¯æ¯”è¾ƒå¤§çš„æ€§èƒ½è´Ÿæ‹…</p>]]></content>
      
      
      <categories>
          
          <category> æºç è§£æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ JS æ‰©å±• Markdown è¯­æ³•</title>
      <link href="/2023/07/09/%E4%BD%BF%E7%94%A8%20JS%20%E6%89%A9%E5%B1%95%20Markdown%20%E8%AF%AD%E6%B3%95/"/>
      <url>/2023/07/09/%E4%BD%BF%E7%94%A8%20JS%20%E6%89%A9%E5%B1%95%20Markdown%20%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1 èƒŒæ™¯"></a>1 èƒŒæ™¯</h1><p>è¿‘æœŸåœ¨ä½¿ç”¨ Hexo </p><p>ç”¨ Markdown è¯­æ³•è¿‡ç¨‹ä¸­</p><p>å‘ç° Markdown çš„åŸç”Ÿè¯­æ³•<strong>æ— æ³•è®¾ç½®å›¾ç‰‡çš„å¤§å°</strong></p><p>å¦‚å®˜æ–¹æ¨èçš„å¼•å…¥å›¾ç‰‡æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% asset_img example.jpg This is an example image %&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](image.jpg)</span><br></pre></td></tr></table></figure><p>æ— æ³•è®¾ç½®å›¾ç‰‡å¤§å°ï¼Œå¹¶ä¸”å›¾ç‰‡ä¼šé»˜è®¤é å·¦è¾¹</p><p>å¦‚æœæƒ³è¦å®ç°å›¾ç‰‡ <strong>æ°´å¹³å±…ä¸­ + è°ƒèŠ‚å¤§å°</strong></p><p>å¥½åƒåªèƒ½é€šè¿‡å†™ HTML + CSS</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;XXX.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 500px; width: 600px;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ€ªéº»çƒ¦çš„</p><p><strong>äºæ˜¯æˆ‘ç”¨  JS æ‰©å±•äº† Markdown è¯­æ³•ï¼Œé€šè¿‡æ›´ç®€å•çš„æ–¹å¼å®ç°å›¾ç‰‡çš„æ”¾å¤§ç¼©å° + æ°´å¹³å±…ä¸­</strong></p><p>å¯ä»¥åœ¨ GIthub ä¸Šä¸‹è½½æºç ï¼š</p><p><a href="https://github.com/iCheng/hexo_relayout_image">https://github.com/iCheng/hexo_relayout_image</a></p><h1 id="2-ä½¿ç”¨è¯­æ³•"><a href="#2-ä½¿ç”¨è¯­æ³•" class="headerlink" title="2 ä½¿ç”¨è¯­æ³•"></a>2 ä½¿ç”¨è¯­æ³•</h1><h2 id="2-1-GIthub-ä¸Šä¸‹è½½æºç å"><a href="#2-1-GIthub-ä¸Šä¸‹è½½æºç å" class="headerlink" title="2.1 GIthub ä¸Šä¸‹è½½æºç å"></a>2.1 GIthub ä¸Šä¸‹è½½æºç å</h2><p>å°† hexo_relayout_image.js æ–‡ä»¶ç§»åŠ¨è‡³ public&#x2F;js&#x2F; ä¸‹</p><h2 id="2-2-å¢åŠ -script-è„šæœ¬"><a href="#2-2-å¢åŠ -script-è„šæœ¬" class="headerlink" title="2.2 å¢åŠ  script è„šæœ¬"></a>2.2 å¢åŠ  script è„šæœ¬</h2><p>è¿›å…¥ä½ çš„ä¸»é¢˜ä¸‹ layout ç›®å½•ä¸­çš„ layout.ejs æ–‡ä»¶</p><blockquote><p>æˆ‘ç”¨çš„ä¸»é¢˜æ˜¯Cupertinoï¼šè·¯å¾„å°±æ˜¯ &#x2F;themes&#x2F;Cupertino&#x2F;layout&#x2F;layout.ejs</p></blockquote><p>å°†ä¸‹é¢çš„ä»£ç åŠ å…¥åˆ° body ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- æ‰©å±•è¯­æ³• --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%- config.root %&gt;js/hexo_relayout_image.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><div align="center">    <img src="/2023/07/09/ä½¿ç”¨ JS æ‰©å±• Markdown è¯­æ³•/è„šæœ¬æ–‡ä»¶.png" style="height: 70px; width: 700px;"></div><h2 id="2-3-ä½¿ç”¨è¯­æ³•"><a href="#2-3-ä½¿ç”¨è¯­æ³•" class="headerlink" title="2.3 ä½¿ç”¨è¯­æ³•"></a>2.3 ä½¿ç”¨è¯­æ³•</h2><blockquote><p>Hexo å†…éƒ¨ä¼šå°† <code>![](image.jpg)</code> è½¬ä¸º <code>img</code> æ ‡ç­¾æ ¼å¼</p><p>å®˜ç½‘ï¼š<code>![](image.jpg)</code> will be rendered as <code>&lt;img src=&quot;/2020/01/02/foo/image.jpg&quot;&gt;</code>.</p></blockquote><p>æˆ‘çš„æ‰©å……çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="variable constant_">XXXX</span>.<span class="property">png</span>?<span class="number">700</span>&amp;<span class="number">500</span>)</span><br></pre></td></tr></table></figure><ul><li>åœ¨è·¯å¾„åä½¿ç”¨ <strong>?</strong> åˆ†éš”</li><li>ç„¶åè¾“å…¥å®½(width)ã€é«˜(height)ï¼Œå¹¶ä½¿ç”¨ <strong>&amp;</strong> è¿æ¥</li></ul><p>ç„¶åï¼š</p><p>è¯¥å›¾ç‰‡å°† <strong>æŒ‰ç…§è®¾ç½®çš„å®½(width)ã€é«˜(height)</strong> é‡ç»˜</p><p>å¹¶ä¸”è¯¥å›¾ç‰‡ä¼š <strong>è‡ªåŠ¨å®ç°æ°´å¹³å±…ä¸­</strong></p><h1 id="3-æ•ˆæœ"><a href="#3-æ•ˆæœ" class="headerlink" title="3 æ•ˆæœ"></a>3 æ•ˆæœ</h1><p><img src="/%E6%95%88%E6%9E%9C.png?500&500"></p>]]></content>
      
      
      <categories>
          
          <category> ä¸€ç‚¹å°æƒ³æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue2æºç (1)ï¼šå¼‚æ­¥æ›´æ–° nextTickåŸç†</title>
      <link href="/2023/07/08/Vue2%E6%BA%90%E7%A0%81%EF%BC%9AnextTick%E5%8E%9F%E7%90%86/"/>
      <url>/2023/07/08/Vue2%E6%BA%90%E7%A0%81%EF%BC%9AnextTick%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>nexttickæºç </p><p>[TOC]</p><h1 id="å¼‚æ­¥æ›´æ–°"><a href="#å¼‚æ­¥æ›´æ–°" class="headerlink" title="å¼‚æ­¥æ›´æ–°"></a>å¼‚æ­¥æ›´æ–°</h1><h1 id="1-è¦å®ç°ä»€ä¹ˆï¼Ÿ"><a href="#1-è¦å®ç°ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1 è¦å®ç°ä»€ä¹ˆï¼Ÿ"></a>1 è¦å®ç°ä»€ä¹ˆï¼Ÿ</h1><p>ç”¨æˆ·å¯èƒ½è¿ç»­å‡ è¡Œä»£ç ä¸­ï¼Œå¤šæ¬¡ä¿®æ”¹åŒä¸€å˜é‡æ•°æ®ã€‚è‹¥æ¯æ¬¡ä¿®æ”¹ï¼Œéƒ½è¿›è¡Œdomæ›´æ–°ï¼Œæ˜¾ç„¶æ˜¯æ€§èƒ½æµªè´¹</p><p>fixï¼šå°†DOMæ›´æ–°æ“ä½œè¿›è¡Œå»¶è¿Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠDOMæ›´æ–°æ“ä½œæš‚å­˜èµ·æ¥ã€‚ç­‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œåï¼Œå†è¿›è¡Œå¼‚æ­¥çš„DOMæ›´æ–°ï¼ˆå¯ä»¥è¯´ä½¿ç”¨äº†promiseï¼‰</p><h1 id="2-å°†DOMæ›´æ–°æ“ä½œè¿›è¡Œå»¶è¿Ÿ"><a href="#2-å°†DOMæ›´æ–°æ“ä½œè¿›è¡Œå»¶è¿Ÿ" class="headerlink" title="2 å°†DOMæ›´æ–°æ“ä½œè¿›è¡Œå»¶è¿Ÿ"></a>2 å°†DOMæ›´æ–°æ“ä½œè¿›è¡Œå»¶è¿Ÿ</h1><p>å¦‚ä½•å°†DOMæ›´æ–°å»¶è¿Ÿå‘¢</p><p>ä¿®æ”¹æ•°æ®åï¼Œä¼šè¿›å…¥ watcher çš„ update() æ–¹æ³•</p><p>ç„¶åæ‰§è¡Œ queueWatcher() æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Subscriber interface.</span></span><br><span class="line"><span class="comment">   * Will be called when a dependency changes.ï¼ˆå°†åœ¨ä¾èµ–é¡¹å‘ç”Ÿæ›´æ”¹æ—¶è¢«è°ƒç”¨ï¼‰</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>)  <span class="comment">// æŠŠå½“å‰watcheræš‚å­˜èµ·æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="3-queueWatcher"><a href="#3-queueWatcher" class="headerlink" title="3 queueWatcher()"></a>3 queueWatcher()</h1><p><strong>é¦–å…ˆè¦æŠŠå½“å‰watcheræš‚å­˜èµ·æ¥</strong></p><p>æš‚å­˜è¿™é‡Œï¼Œå°±å¼•å‡ºäº†å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>watcher å­˜åˆ°å“ªé‡Œï¼Ÿ</li><li>å¯ä»¥ç›´æ¥å­˜å‚¨å—ï¼Ÿ</li></ul><p>Answer:</p><ul><li>å®ƒç»´æŠ¤äº†ä¸€ä¸ªé˜Ÿåˆ—ï¼šqueueï¼Œå°† watcher ç»´æŠ¤åœ¨è¿™é‡Œ</li><li>ä¸å¯ä»¥ç›´æ¥å­˜å‚¨ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½è¿ç»­å‡ è¡Œä»£ç ä¸­ï¼Œå¤šæ¬¡ä¿®æ”¹åŒä¸€å˜é‡æ•°æ®è€Œè§¦å‘ watcher çš„ update()ï¼Œæ‰€ä»¥è¦å¯¹ watcher è¿›è¡Œå»é‡ï¼Œåœ¨åŠ å…¥åˆ°é˜Ÿåˆ— queue</li></ul><p>åˆ°è¿™é‡Œï¼Œæš‚å­˜å°±æå®šäº†</p><p><strong>é‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œåˆ·æ–°æ¸²æŸ“æ“ä½œäº†</strong></p><p>åˆ·æ–°æ“ä½œå…³é”®ç‚¹æ˜¯ï¼švue å¸Œæœ›ä¸è®º watcher çš„ update æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œå®ƒçš„åˆ·æ–°æ¸²æŸ“æ“ä½œä»…æ‰§è¡Œä¸€æ¬¡</p><p>å› æ­¤ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªé”æœºåˆ¶ï¼šwaiting  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let waiting = false</span><br><span class="line">// é”</span><br><span class="line">if (!waiting) &#123;</span><br><span class="line">  waiting = true</span><br><span class="line">  æ‰§è¡Œå¼‚æ­¥æ¸²æŸ“æ“ä½œ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–çš„æ—¶å€™ï¼Œwaiting &#x3D; false</p><p>å› æ­¤ç¬¬ä¸€æ¬¡ï¼Œä¼šæ‰§è¡Œ if è¯­å¥çš„ä»£ç ï¼Œ æ‰§è¡Œå¼‚æ­¥æ¸²æŸ“æ“ä½œ</p><p>åé¢å³ä½¿å¤šæ¬¡è§¦å‘ queueWatcher ï¼Œä¹Ÿä¸ä¼šè¿›å…¥ if è¯­å¥çš„ä»£ç äº†</p><p><strong>é‡Œé¢çš„ä»£ç ï¼Œæˆ‘åœ¨ä¸Šé¢ç®€è¿°ä¸ºï¼šæ‰§è¡Œå¼‚æ­¥æ¸²æŸ“æ“ä½œ</strong></p><p>é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å…¶å®å°±æ˜¯ï¼šå¼‚æ­¥çš„ã€æŠŠ queue ä¸­å­˜å‚¨çš„ watcher ä¸€ä¸ªä¸€ä¸ªæ‹¿å‡ºæ¥è¿›è¡Œæ¸²æŸ“æ“ä½œ</p><p>æ¯”å¦‚ç”¨è®¡æ—¶å™¨å®ç°å¼‚æ­¥ï¼Œä¼ å…¥ä¸€ä¸ªæ–¹æ³•åšæ¸²æŸ“æ“ä½œï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setTimeout( æ‰§è¡Œæ¸²æŸ“æ“ä½œ, 0 )</span><br></pre></td></tr></table></figure><p>ï¼ˆå½“å‰ï¼Œvue ä¸­å¹¶ä¸æ˜¯ç®€å•çš„ç”¨ setTimeout æ¥å®ç°çš„ï¼Œåé¢å†è¯´ï¼‰</p><p>å…·ä½“æ¥è¯´ï¼š</p><p>æ‰§è¡Œæ¸²æŸ“æ“ä½œçš„æ–¹æ³•å«åšï¼š <strong>flushSchedulerQueue()</strong></p><p>å®ƒåšäº†2ä»¶äº‹æƒ…ï¼š</p><ul><li>éå† queue ä¸­ç»´æŠ¤çš„ watcherï¼Œæ‰§è¡Œæ¸²æŸ“é€»è¾‘</li><li>ç„¶å waiting ç½®ä¸º falseï¼Œå°†é”æ‰“å¼€</li></ul><p><strong>ä»¥ä¸Šé¢ä¸ºåŸºç¡€ï¼Œä¸¾ä¸€ä¸ª DEMO:</strong></p><p>ç”¨æˆ·åœ¨ç•Œé¢å¤šæ¬¡ä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.name = &#x27;xx&#x27;</span><br><span class="line">vm.name = &#x27;ww&#x27;</span><br><span class="line">vm.name = &#x27;end&#x27;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¬¬ä¸€è¡Œä»£ç ï¼š</p><p>è§¦å‘äº† watcher çš„ updateï¼Œè¿›å…¥ queueWatcher()ï¼Œvue ä¼šå°† è¿™ä¸ª watcher åŠ å…¥åˆ° queue ä¸­</p><p>æ­¤æ—¶é”æ˜¯æ‰“å¼€çš„ï¼Œä¼šè¿›è¡Œå¼‚æ­¥æ¸²æŸ“æ“ä½œï¼ˆå› ä¸ºå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä¸ä¼šç«‹åˆ»æ¸²æŸ“ï¼‰ï¼Œå¹¶å°†é”å…³ä¸Šäº†</p><p>æ‰§è¡Œç¬¬ä¸€è¡Œã€ç¬¬ä¸‰è¡Œä»£ç ï¼š</p><p>è™½ç„¶å¤šæ¬¡è§¦å‘äº† updateï¼Œä½†æ˜¯è¿™ä¸ª watcher å·²ç»åŠ å…¥äº†ï¼Œæ‰€ä»¥ä¸ä¼šé‡å¤åŠ å…¥ï¼Œå¹¶ä¸”é”æ˜¯å…³ä¸Šçš„</p><p>åŒæ­¥ä»£ç æ‰§è¡Œå®Œäº†ï¼Œå¯ä»¥æ‰§è¡Œå¼‚æ­¥ä»£ç äº†</p><p>æ‰§è¡Œ flushSchedulerQueue() </p><p>ä¼šè°ƒç”¨  watcher.run()</p><p>run() å®é™…ä¸Šåˆæ‰§è¡ŒåŠ› get() æ–¹æ³•ï¼ˆwatcherçš„é€šç”¨æ±‚å€¼æ–¹æ³•ï¼‰ï¼Œå³</p><p>å…¥æ ˆï¼›</p><p>æ‰§è¡Œå›è°ƒï¼ˆvm_update   vm_renderï¼‰ï¼› &#x2F;&#x2F; è¿™é‡Œæ‹¿åˆ°çš„å€¼æ˜¯ name çš„æœ€æ–°å€¼ï¼šâ€™endâ€™ï¼Œè¿›è¡Œæ¸²æŸ“</p><p>å‡ºæ ˆï¼›</p><p>æ¸²æŸ“å®Œäº†ï¼Œå°†é”æ‰“å¼€</p><p><strong>æ‰€ä»¥ï¼Œå³ä½¿å¤šæ¬¡ä¿®æ”¹å€¼ï¼Œå¼‚æ­¥æ¸²æŸ“æ“ä½œä»…ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¸”æ‹¿åˆ°æœ€æ–°å€¼</strong></p><p><strong>ç°åœ¨è¿™æ ·çœ‹èµ·æ¥ï¼Œè¿˜æŒºå®Œç¾</strong></p><p>ä½†å¦‚æœæ‰§è¡Œä¸‹é¢è¿™äº›ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vm.name = &#x27;icheng&#x27;</span><br><span class="line">console.log(app.innerHTML); // æ‰“å° dom ä¸Šçš„æ–‡æœ¬ name</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œç•Œé¢ä¸Šçš„æ•°æ®æ˜¯æ–°çš„ï¼Œä½†æ˜¯æ‰“å°å‡ºæ¥çš„æ•°æ®ï¼Œæ˜¯æ—§çš„</p><p>å› ä¸ºï¼šè¿™ä¸¤è¡ŒåŒæ­¥ä»£ç ä¼šå…ˆæ‰§è¡Œï¼Œç„¶åæ‰ä¼šå¼‚æ­¥æ›´æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥ç¬¬äºŒè¡Œå»æ‹¿ dom ä¸Šçš„æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®æ ¹æœ¬è¿˜æ²¡æ›´æ–°</p><p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vm.name = &#x27;icheng&#x27;</span><br><span class="line">vm.&amp;nextTick(() =&gt; &#123;</span><br><span class="line">console.log(app.innerHTML);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¼•å‡ºäº† vue ä¸­ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šnextTick()</p><p>æœ‰äº†nextTick()ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‰é¢çš„æ‰§è¡Œå¼‚æ­¥æ¸²æŸ“æ“ä½œçš„ setTimeout() æ”¹ä¸º nextTick()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setTimeout( flushSchedulerQueue(), 0 )</span><br></pre></td></tr></table></figure><p>â€‹                    ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nextTick( flushSchedulerQueue(), 0 )</span><br></pre></td></tr></table></figure><p>nextTick ä¸­ï¼Œä¼šä¼ å…¥ flushSchedulerQueue() æ¸²æŸ“æ›´æ–°ï¼Œä¹Ÿä¼šä¼ å…¥ç”¨æˆ·å®šä¹‰çš„çš„æ–¹æ³•ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œ</p><p>å› æ­¤ï¼Œvue ä¸­æœ‰ä¸€ä¸ª callbacks é˜Ÿåˆ—ï¼Œç»´æŠ¤æ‰€æœ‰è¿™äº›ä»»åŠ¡</p><h1 id="4-nextTick"><a href="#4-nextTick" class="headerlink" title="4 nextTick()"></a>4 nextTick()</h1><p>é¦–å…ˆå°†ä¼ å…¥çš„ä»»åŠ¡ï¼Œæ¨å…¥ callbacks é˜Ÿåˆ—</p><p>ç„¶åï¼Œä»¥å¼‚æ­¥çš„æ–¹å¼ã€æ‰§è¡Œä»»åŠ¡</p><ul><li>æ‰§è¡Œä»»åŠ¡æŒ‡çš„æ˜¯ï¼šéå† callbacks é˜Ÿåˆ—æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ</li></ul><p><strong>æ‰€ä»¥ï¼ŒnextTick() ä¸æ˜¯åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œè€Œæ˜¯å°†è¿™ä¸ªä»»åŠ¡ç»´æŠ¤åˆ°äº†é˜Ÿåˆ—ä¸­ï¼Œä¾æ¬¡æ‰§è¡Œ</strong></p><ul><li>é‚£ä¹ˆ vue æ˜¯å¦‚ä½•é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼å‘¢ï¼Ÿ</li></ul><p>è€ƒè™‘å…¼å®¹æ€§ï¼Œå®ƒå†…éƒ¨æ²¡æœ‰ç¡®å®šé‡‡ç”¨äº†å“ªä¸ªå¼‚æ­¥ APIï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¼˜é›…é™çº§çš„æ–¹å¼ï¼š</p><ul><li>å†…éƒ¨å…ˆé‡‡ç”¨çš„æ˜¯ promiseï¼ˆieä¸å…¼å®¹ï¼‰</li><li>ä¸å…¼å®¹åˆ™ä½¿ç”¨ MutationObserver(h5çš„api)</li><li>å¦åˆ™å¯ä»¥è€ƒè™‘ieä¸“äº«çš„ setImmediate</li><li>æˆ–è€… setTimeout</li></ul><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p>nextTick() æºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">nextTick</span>(<span class="params">cb?: (...args: any[]) =&gt; any, ctx?: object</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _resolve</span><br><span class="line">  <span class="comment">// å°†ä»»åŠ¡æ¨å…¥ callbacks é˜Ÿåˆ—</span></span><br><span class="line">  callbacks.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cb.<span class="title function_">call</span>(ctx)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (<span class="attr">e</span>: any) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, ctx, <span class="string">&#x27;nextTick&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_resolve) &#123;</span><br><span class="line">      <span class="title function_">_resolve</span>(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (!pending) &#123;</span><br><span class="line">    pending = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">timerFunc</span>() <span class="comment">// ä¼˜é›…é™çº§</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// $flow-disable-line</span></span><br><span class="line">  <span class="keyword">if</span> (!cb &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Promise</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      _resolve = resolve</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜é›…é™çº§çš„æºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨ï¼šflushCallbacksæ˜¯éå† callbacks é˜Ÿåˆ—æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> timerFunc</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Promise</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title function_">isNative</span>(<span class="title class_">Promise</span>)) &#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    p.<span class="title function_">then</span>(flushCallbacks)</span><br><span class="line">    <span class="keyword">if</span> (isIOS) <span class="built_in">setTimeout</span>(noop)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">  !isIE &amp;&amp;</span><br><span class="line">  <span class="keyword">typeof</span> <span class="title class_">MutationObserver</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp;</span><br><span class="line">  (<span class="title function_">isNative</span>(<span class="title class_">MutationObserver</span>) ||</span><br><span class="line">    <span class="comment">// PhantomJS and iOS 7.x</span></span><br><span class="line">    <span class="title class_">MutationObserver</span>.<span class="title function_">toString</span>() === <span class="string">&#x27;[object MutationObserverConstructor]&#x27;</span>)</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">let</span> counter = <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(flushCallbacks)</span><br><span class="line">  <span class="keyword">const</span> textNode = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(<span class="title class_">String</span>(counter))</span><br><span class="line">  observer.<span class="title function_">observe</span>(textNode, &#123;</span><br><span class="line">    <span class="attr">characterData</span>: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    counter = (counter + <span class="number">1</span>) % <span class="number">2</span></span><br><span class="line">    textNode.<span class="property">data</span> = <span class="title class_">String</span>(counter)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> setImmediate !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title function_">isNative</span>(setImmediate)) &#123;</span><br><span class="line">  <span class="comment">// Fallback to setImmediate.</span></span><br><span class="line">  <span class="comment">// Technically it leverages the (macro) task queue,</span></span><br><span class="line">  <span class="comment">// but it is still a better choice than setTimeout.</span></span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setImmediate</span>(flushCallbacks)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Fallback to setTimeout.</span></span><br><span class="line">  timerFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(flushCallbacks, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>queueWatcher æºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†ä¸€ä¸ªè§‚å¯Ÿè€…æ¨å…¥è§‚å¯Ÿè€…é˜Ÿåˆ—ä¸­ï¼Œä¸”å…·æœ‰é‡å¤idçš„è§‚å¯Ÿè€…å°†è¢«è·³è¿‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">queueWatcher</span>(<span class="params">watcher: Watcher</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> id = watcher.<span class="property">id</span></span><br><span class="line">  <span class="comment">// å»é‡</span></span><br><span class="line">  <span class="keyword">if</span> (has[id] != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (watcher === <span class="title class_">Dep</span>.<span class="property">target</span> &amp;&amp; watcher.<span class="property">noRecurse</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  has[id] = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> (!flushing) &#123;</span><br><span class="line">    queue.<span class="title function_">push</span>(watcher)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// if already flushing, splice the watcher based on its id</span></span><br><span class="line">    <span class="comment">// if already past its id, it will be run next immediately.</span></span><br><span class="line">    <span class="keyword">let</span> i = queue.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (i &gt; index &amp;&amp; queue[i].<span class="property">id</span> &gt; watcher.<span class="property">id</span>) &#123;</span><br><span class="line">      i--</span><br><span class="line">    &#125;</span><br><span class="line">    queue.<span class="title function_">splice</span>(i + <span class="number">1</span>, <span class="number">0</span>, watcher)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// queue the flush</span></span><br><span class="line">  <span class="keyword">if</span> (!waiting) &#123;</span><br><span class="line">    waiting = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (__DEV__ &amp;&amp; !config.<span class="property">async</span>) &#123;</span><br><span class="line">      <span class="title function_">flushSchedulerQueue</span>()</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">nextTick</span>(flushSchedulerQueue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç è§£æ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç </title>
      <link href="/2023/07/06/%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9A%E6%87%92%E5%8A%A0%E8%BD%BD-%E5%BC%82%E6%AD%A5%E8%A7%A3%E7%A0%81/"/>
      <url>/2023/07/06/%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9A%E6%87%92%E5%8A%A0%E8%BD%BD-%E5%BC%82%E6%AD%A5%E8%A7%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="æ‡’åŠ è½½"><a href="#æ‡’åŠ è½½" class="headerlink" title="æ‡’åŠ è½½"></a>æ‡’åŠ è½½</h1><p>æ‡’åŠ è½½æ˜¯ä¸€ç§ç½‘é¡µæ€§èƒ½ä¼˜åŒ–çš„å¸¸è§æ–¹å¼ï¼Œå®ƒèƒ½æå¤§çš„æå‡ç”¨æˆ·ä½“éªŒã€‚åˆ°ä»Šå¤©ï¼Œä¸€ä¸ªç½‘ç«™é‡Œé¢å¯èƒ½ä¼šæœ‰å‡ ç™¾å¼ ç”šè‡³å‡ åƒå¼ ä¸Šä¸‡å¼ å›¾ç‰‡å’Œå…¶ä»–èµ„æºï¼Œå¦‚æœæ¯æ¬¡è¿›å…¥é¡µé¢éƒ½éœ€è¦è¯·æ±‚é¡µé¢ä¸Šçš„æ‰€æœ‰çš„èµ„æºï¼Œä¼šè¾ƒå¤§çš„å½±å“ç”¨æˆ·ä½“éªŒï¼Œå¯¹ç”¨æˆ·çš„å¸¦å®½ä¹Ÿæ˜¯ä¸€ç§æå¤§çš„æŸè€—ã€‚</p><p>æ‰€ä»¥ï¼Œæ‡’åŠ è½½çš„æ„ä¹‰å³æ˜¯ï¼Œ<strong>å½“é¡µé¢æœªæ»šåŠ¨åˆ°ç›¸åº”åŒºåŸŸï¼Œè¯¥åŒºåŸŸå†…çš„èµ„æºï¼ˆç½‘ç»œè¯·æ±‚ï¼‰ä¸ä¼šè¢«åŠ è½½ã€‚åä¹‹ï¼Œå½“é¡µé¢æ»šåŠ¨åˆ°ç›¸åº”åŒºåŸŸï¼Œç›¸å…³èµ„æºçš„è¯·æ±‚æ‰ä¼šè¢«å‘èµ·ã€‚</strong></p><p>ä¹‹å‰ï¼Œå›¾ç‰‡çš„æ‡’åŠ è½½é€šå¸¸éƒ½æ˜¯ä½¿ç”¨ JavaScript æ–¹æ¡ˆè¿›è¡Œï¼š</p><blockquote><p>å…ˆç»™é¡µé¢çš„å›¾ç‰‡è®¾ç½®ä¸€ä¸ªå ä½ç¬¦ï¼Œä¸è¦æŠŠå›¾ç‰‡çœŸå®åœ°å€æ”¾åœ¨srcä¸­ï¼ŒçœŸæ­£çš„è·¯å¾„å­˜å‚¨åœ¨ä¸€ä¸ªå±æ€§ä¸­ï¼Œè¦ç”¨çš„æ—¶å€™å†å–å‡ºæ¥ï¼Œé¡µé¢åŠ è½½å®Œæˆåï¼Œåˆ¤æ–­å›¾ç‰‡æ˜¯å¦åœ¨ç”¨æˆ·è§†é‡ï¼Œå¦‚æœåœ¨ï¼Œå°±æŠŠå€¼å–å‡ºæ”¾å…¥srcå±æ€§ï¼›</p><p>å¦‚æœ offsetTop - scrollTop &lt; clientHeightï¼Œè¯´æ˜å›¾ç‰‡å‡ºç°åœ¨å¯è§†åŒºåŸŸ</p></blockquote><p>è€Œä»Šå¤©ï¼Œæˆ‘ä»¬åœ¨æ‡’åŠ è½½å®ç°ä¸Šï¼Œæœ‰äº†æ›´å¤šä¸ä¸€æ ·çš„é€‰æ‹©ã€‚ä¸‹é¢ä¼šä»‹ç»ä¸¤ç§æ–¹å¼å¹¶è¿›è¡Œæµ‹éªŒ:</p><ul><li>content-visibility: auto</li><li>loading&#x3D;â€lazyâ€ å’Œ decoding&#x3D;â€asyncâ€</li></ul><h1 id="1-ä½¿ç”¨-content-visibility-å®ç°å»¶è¿Ÿæ¸²æŸ“"><a href="#1-ä½¿ç”¨-content-visibility-å®ç°å»¶è¿Ÿæ¸²æŸ“" class="headerlink" title="1 ä½¿ç”¨ content-visibility å®ç°å»¶è¿Ÿæ¸²æŸ“"></a>1 ä½¿ç”¨ content-visibility å®ç°å»¶è¿Ÿæ¸²æŸ“</h1><h2 id="1-1-What"><a href="#1-1-What" class="headerlink" title="1.1 What"></a>1.1 What</h2><p> <code>content-visibilityï¼š auto</code></p><p>å…¶æ§åˆ¶ä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°éœ€è¦å®ƒçš„æ—¶å€™æ‰ä¼šæ¸²æŸ“</p><p>åˆ©ç”¨ content-visibility ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¦‚æœè¯¥å…ƒç´ å½“å‰ä¸åœ¨å±å¹•ä¸Šï¼Œåˆ™ä¸ä¼šæ¸²æŸ“å…¶åä»£å…ƒç´ ã€‚</p><h2 id="1-2-Demo"><a href="#1-2-Demo" class="headerlink" title="1.2 Demo"></a>1.2 Demo</h2><p>å¦‚æœæœ‰å¦‚ä¸‹é¡µé¢ç»“æ„ï¼Œæˆ‘ä½¿ç”¨ items æ•°ç»„å­˜æ”¾15ä¸ªç…§ç‰‡ï¼Œéƒ½æ˜¯é€šè¿‡ç½‘ç»œè¯·æ±‚æ‹¿åˆ°çš„ï¼Œæ¨¡æ¿ä¸­è¿›è¡Œæ¸²æŸ“</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-<span class="keyword">for</span>=<span class="string">&quot;item in items&quot;</span> :key=<span class="string">&quot;item&quot;</span>&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>-------------&#123;&#123; item.id &#125;&#125;-------------<span class="tag">&lt;/<span class="name">p</span>&gt;</span>   </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;item.src&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">items</span>: [&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://b.hiphotos.baidu.com/image/pic/item/9d82d158ccbf6c81b94575cfb93eb13533fa40a2.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;https://gtd.alicdn.com/sns_logo/i3/TB1wnBTKFXXXXcQXXXXSutbFXXX.jpg_240x240xz.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">2</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;//www.baidu.com/img/flexible/logo/pc/result.png&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">3</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://e.hiphotos.baidu.com/image/pic/item/a1ec08fa513d2697e542494057fbb2fb4316d81e.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">4</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://c.hiphotos.baidu.com/image/pic/item/30adcbef76094b36de8a2fe5a1cc7cd98d109d99.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">5</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://h.hiphotos.baidu.com/image/pic/item/7c1ed21b0ef41bd5f2c2a9e953da81cb39db3d1d.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">6</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://g.hiphotos.baidu.com/image/pic/item/55e736d12f2eb938d5277fd5d0628535e5dd6f4a.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">7</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://e.hiphotos.baidu.com/image/pic/item/4e4a20a4462309f7e41f5cfe760e0cf3d6cad6ee.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">8</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://g.hiphotos.baidu.com/image/pic/item/6d81800a19d8bc3e770bd00d868ba61ea9d345f2.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">9</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://e.hiphotos.baidu.com/image/pic/item/4bed2e738bd4b31c1badd5a685d6277f9e2ff81e.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">10</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://g.hiphotos.baidu.com/image/pic/item/0d338744ebf81a4c87a3add4d52a6059252da61e.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">11</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://a.hiphotos.baidu.com/image/pic/item/f2deb48f8c5494ee5080c8142ff5e0fe99257e19.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">12</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://f.hiphotos.baidu.com/image/pic/item/4034970a304e251f503521f5a586c9177e3e53f9.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">13</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://b.hiphotos.baidu.com/image/pic/item/279759ee3d6d55fbb3586c0168224f4a20a4dd7e.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="number">14</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">src</span>: <span class="string">&quot;http://a.hiphotos.baidu.com/image/pic/item/e824b899a9014c087eb617650e7b02087af4f464.jpg&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>é¡µé¢çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /contentVisibility.png" style="height: 500px; width: 500px;"></div><p>åªéœ€è¦ç»™éœ€è¦å»¶è¿Ÿï¼ˆå®æ—¶ï¼‰æ¸²æŸ“çš„å…ƒç´ ï¼Œè®¾ç½®ç®€å•çš„ CSS æ ·å¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container-box</span> &#123;</span><br><span class="line">  <span class="attribute">content-visibility</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å®ç°å»¶è¿ŸåŠ è½½äº†</p><h2 id="1-3-å¯è®¿é—®æ€§"><a href="#1-3-å¯è®¿é—®æ€§" class="headerlink" title="1.3 å¯è®¿é—®æ€§"></a>1.3 å¯è®¿é—®æ€§</h2><p>å…¨æ–‡æ£€ç´¢æ˜¯ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½</p><p>å¦‚æœè¯´å¯è§†åŒºå¤–çš„å†…å®¹æœªè¢«æ¸²æŸ“ï¼Œé‚£æ˜¯å¦ä¼šå½±å“ç”¨æˆ·è¿›è¡Œå…¨æ–‡æ£€ç´¢å‘¢ï¼Ÿ</p><p>åœ¨é¡µé¢åˆå§‹åŒ–åï¼Œæˆ‘å…¨å±€ <code>ctrl + F</code>ï¼Œæœç´¢ 7 ï¼Œå…¨å±€æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¯ä»¥æ‰¾åˆ°å½“å‰æœªè¢«æ¸²æŸ“çš„å…ƒç´ å†…çš„å†…å®¹</p><p>å› æ­¤ï¼Œ<strong>å³ä¾¿å­˜åœ¨è®¾ç½®äº† <code>content-visibility: auto</code> çš„æœªè¢«æ¸²æŸ“çš„å…ƒç´ ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¼šå½±å“å…¨å±€çš„æœç´¢åŠŸèƒ½</strong>ã€‚</p><h2 id="1-4-But"><a href="#1-4-But" class="headerlink" title="1.4 But"></a>1.4 But</h2><p>æ–‡ç« è¿˜æ²¡åˆ°ä¸€åŠï¼Œå½“ç„¶ä¸ä¼šå°±è¿™ä¹ˆç»“æŸäº†</p><p>å› ä¸ºæœ‰2ä¸ª<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>æ»šåŠ¨æ¡åœ¨å‘ä¸‹æ»šåŠ¨åœ¨ä¸æ–­çš„æŠ–åŠ¨ï¼š</strong>è¿™æ˜¯ç”±äºä¸‹é¢ä¸åœ¨å¯è§†åŒºåŸŸå†…çš„å†…å®¹ï¼Œä¸€å¼€å§‹æ˜¯æ²¡æœ‰è¢«æ¸²æŸ“çš„ï¼Œåœ¨æ¯æ¬¡æ»šåŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæ‰é€æ¸æ¸²æŸ“å¯¼è‡´æ»šåŠ¨æ¡æŠ½æï¼Œç”¨æˆ·ä½“éªŒæŒºå·®çš„</li></ul><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /contentVisibility.webp" style="height: 500px; width: 500px;"></div><ul><li><strong>åˆå§‹åŒ–æ—¶è¯·æ±‚å…¨éƒ¨å‘é€äº†ï¼š</strong>å³ä¾¿å½“å‰é¡µé¢å¯è§†åŒºåŸŸå¤–çš„å†…å®¹æœªè¢«æ¸²æŸ“ï¼Œä½†æ˜¯å›¾ç‰‡èµ„æºçš„ HTTP&#x2F;HTTPS è¯·æ±‚ï¼Œä¾ç„¶ä¼šåœ¨é¡µé¢ä¸€å¼€å§‹è¢«è§¦å‘</li></ul><h3 id="1-3-1-åˆ©ç”¨-contain-intrinsic-size-è§£å†³æ»šåŠ¨æ¡æŠ–åŠ¨é—®é¢˜"><a href="#1-3-1-åˆ©ç”¨-contain-intrinsic-size-è§£å†³æ»šåŠ¨æ¡æŠ–åŠ¨é—®é¢˜" class="headerlink" title="1.3.1 åˆ©ç”¨ contain-intrinsic-size è§£å†³æ»šåŠ¨æ¡æŠ–åŠ¨é—®é¢˜"></a>1.3.1 åˆ©ç”¨ contain-intrinsic-size è§£å†³æ»šåŠ¨æ¡æŠ–åŠ¨é—®é¢˜</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>content-visibility: auto</code>ï¼Œé‚£ä¹ˆå¯è§†åŒºå¤–çš„å…ƒç´ é«˜åº¦é€šå¸¸å°±ä¸º 0ï¼Œå½“æ»šåŠ¨æ¡ç§»åŠ¨ï¼Œå…ƒç´ å±•ç¤ºï¼Œæ‰€ä»¥ä¼šå‡ºç°æŠ–åŠ¨æŠ½æã€‚</p><p>å¦‚æœèƒ½å‡†ç¡®çŸ¥é“è®¾ç½®äº†<strong>å…ƒç´ åœ¨æ¸²æŸ“çŠ¶æ€ä¸‹çš„é«˜åº¦</strong>ï¼Œå°±å¯ä»¥é¿å…æŠ–åŠ¨ç°è±¡äº†ã€‚</p><p>å› æ­¤æˆ‘ä¸ºå…ƒç´ åŠ ä¸Š contain-intrinsic-size å±æ€§ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container-box</span> &#123;</span><br><span class="line">  <span class="attribute">contain</span>-intrinsic-size: <span class="number">320px</span>;</span><br><span class="line">  <span class="attribute">content-visibility</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /è§£å†³æŠ–åŠ¨.webp" style="height: 500px; width: 500px;"></div><p><strong>æ‰€ä»¥ï¼Œcontent-visibility: auto æ— æ³•å®Œå…¨æ›¿ä»£å›¾ç‰‡æ‡’åŠ è½½ï¼Œè®¾ç½®äº† content-visibility: auto çš„ç¡®å®ç°äº†å»¶è¿Ÿæ¸²æŸ“ï¼Œä½†æ˜¯å…¶ä¸­çš„é™æ€èµ„æºä»æ—§ä¼šåœ¨é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™è¢«å…¨éƒ¨åŠ è½½ã€‚å› æ­¤ï¼Œå®ƒæ›´é€‚åˆäºè™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“çš„æƒ…æ™¯ã€‚</strong></p><h1 id="2-æ‡’åŠ è½½-å¼‚æ­¥è§£ç "><a href="#2-æ‡’åŠ è½½-å¼‚æ­¥è§£ç " class="headerlink" title="2 æ‡’åŠ è½½+å¼‚æ­¥è§£ç "></a>2 æ‡’åŠ è½½+å¼‚æ­¥è§£ç </h1><h2 id="2-1-æ‡’åŠ è½½-loading-x3D-â€lazyâ€"><a href="#2-1-æ‡’åŠ è½½-loading-x3D-â€lazyâ€" class="headerlink" title="2.1 æ‡’åŠ è½½ loading&#x3D;â€lazyâ€"></a>2.1 æ‡’åŠ è½½ loading&#x3D;â€lazyâ€</h2><p>HTML5 æ–°å¢äº†ä¸€ä¸ª loading å±æ€§ã€‚æ­¤å±æ€§å¯ä»¥æ·»åŠ åˆ° &lt; img &gt; å…ƒç´ ä¸­ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ° &lt; iframe &gt; å…ƒç´ ä¸­ã€‚</p><p>å±æ€§çš„å€¼ä¸º loading&#x3D;â€lazyâ€ ä¼šå‘Šè¯‰æµè§ˆå™¨ï¼Œå¦‚æœå›¾åƒä½äºå¯è§†åŒºæ—¶ï¼Œåˆ™ç«‹å³åŠ è½½å›¾åƒï¼Œå¹¶åœ¨ç”¨æˆ·æ»šåŠ¨åˆ°å®ƒä»¬é™„è¿‘æ—¶è·å–å…¶ä»–å›¾åƒã€‚</p><p>loading&#x3D;â€lazyâ€ åˆ°ï¼ˆ2023-07-08ï¼‰çš„å…¼å®¹æ€§ï¼Œè¿˜æ˜¯éå¸¸ä¸é”™çš„ï¼š</p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /loadingå…¼å®¹.png" style="height: 300px; width: 900px;"></div>ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒ loading="lazy" <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var isSupportLoading = &#x27;loading&#x27; in document.createElement(&#x27;img&#x27;);</span><br></pre></td></tr></table></figure><h2 id="2-2-å¼‚æ­¥è§£ç -decoding-x3D-â€asyncâ€"><a href="#2-2-å¼‚æ­¥è§£ç -decoding-x3D-â€asyncâ€" class="headerlink" title="2.2 å¼‚æ­¥è§£ç  decoding&#x3D;â€asyncâ€"></a>2.2 å¼‚æ­¥è§£ç  decoding&#x3D;â€asyncâ€</h2><p><code>HTMLImageElement</code> æ¥å£çš„ <code>decoding</code> å±æ€§ç”¨äºå‘Šè¯‰æµè§ˆå™¨ä½¿ç”¨ä½•ç§æ–¹å¼è§£æå›¾åƒæ•°æ®ã€‚</p><ul><li>sync: åŒæ­¥è§£ç å›¾åƒï¼Œè¿™ä¼šé˜»æ­¢ä¸»çº¿ç¨‹ï¼Œç›´åˆ°å›¾åƒå®Œå…¨è§£ç ã€‚</li><li>async: å¼‚æ­¥è§£ç å›¾åƒï¼Œä¸ä¼šé˜»æ­¢ä¸»çº¿ç¨‹ã€‚</li><li>auto: é»˜è®¤æ¨¡å¼ï¼Œè¡¨ç¤ºä¸åå¥½è§£ç æ¨¡å¼ã€‚ç”±æµè§ˆå™¨å†³å®šå“ªç§æ–¹å¼æ›´é€‚åˆç”¨æˆ·ã€‚</li></ul><p>æµè§ˆå™¨åœ¨è¿›è¡Œå›¾ç‰‡æ¸²æŸ“å±•ç¤ºçš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯éœ€è¦å¯¹å›¾ç‰‡æ–‡ä»¶è¿›è¡Œè§£ç çš„ï¼Œè¿™ä¸€ä¸ªè¿‡ç¨‹å¿«æ…¢ä¸å›¾ç‰‡æ ¼å¼æœ‰å…³ã€‚</p><p>è€Œå¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›å›¾ç‰‡çš„æ¸²æŸ“è§£ç å½±å“é¡µé¢çš„å…¶ä»–å†…å®¹çš„å±•ç¤ºï¼Œå¯ä»¥ä½¿ç”¨ async é€‰é¡¹</p><p>è¿™æ ·ï¼Œæµè§ˆå™¨ä¾¿ä¼šå¼‚æ­¥è§£ç å›¾åƒï¼ŒåŠ å¿«æ˜¾ç¤ºå…¶ä»–å†…å®¹ï¼Œä¼˜åŒ–é¡µé¢æ¸²æŸ“æ€§èƒ½ã€‚</p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åˆ°ï¼ˆ2023-07-08ï¼‰ï¼Œdecoding&#x3D;â€asyncâ€ çš„å…¼å®¹æ€§ï¼Œæ•´ä½“è¿˜æ˜¯éå¸¸ä¸é”™çš„ï¼Œä½œä¸ºæ¸è¿›å¢å¼ºæ–¹æ¡ˆä½¿ç”¨ï¼Œæ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚</p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /decodingå…¼å®¹.png" style="height: 300px; width: 900px;"></div><h2 id="2-3-Demo"><a href="#2-3-Demo" class="headerlink" title="2.3 Demo"></a>2.3 Demo</h2><p>å’Œä¸Šé¢çš„Demoå·®ä¸å¤šï¼Œå‡†å¤‡14å¼ å›¾ç‰‡çš„é¡µé¢ï¼Œæ¯ä¸ªå›¾ç‰‡urlå¤§å°ä¸ä¸€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;!-- loading=&quot;lazy&quot; æ‡’åŠ è½½ --&gt;</span><br><span class="line">    &lt;div v-for=&quot;item in items&quot; :key=&quot;item&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;container-box2&quot;&gt;</span><br><span class="line">        &lt;p&gt;-------------&#123;&#123; item.id &#125;&#125;-------------&lt;/p&gt;   </span><br><span class="line">        &lt;img :src=&quot;item.src&quot; alt=&quot;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      items: [&#123;</span><br><span class="line">        id: 0,</span><br><span class="line">        src: &quot;http://g.hiphotos.baidu.com/image/pic/item/6d81800a19d8bc3e770bd00d868ba61ea9d345f2.jpg&quot;</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        src: &quot;https://gtd.alicdn.com/sns_logo/i3/TB1wnBTKFXXXXcQXXXXSutbFXXX.jpg_240x240xz.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        src: &quot;//www.baidu.com/img/flexible/logo/pc/result.png&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 3,</span><br><span class="line">        src: &quot;http://e.hiphotos.baidu.com/image/pic/item/a1ec08fa513d2697e542494057fbb2fb4316d81e.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 4,</span><br><span class="line">        src: &quot;http://c.hiphotos.baidu.com/image/pic/item/30adcbef76094b36de8a2fe5a1cc7cd98d109d99.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 5,</span><br><span class="line">        src: &quot;http://h.hiphotos.baidu.com/image/pic/item/7c1ed21b0ef41bd5f2c2a9e953da81cb39db3d1d.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 6,</span><br><span class="line">        src: &quot;http://g.hiphotos.baidu.com/image/pic/item/55e736d12f2eb938d5277fd5d0628535e5dd6f4a.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 7,</span><br><span class="line">        src: &quot;http://e.hiphotos.baidu.com/image/pic/item/4e4a20a4462309f7e41f5cfe760e0cf3d6cad6ee.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 8,</span><br><span class="line">        src: &quot;http://b.hiphotos.baidu.com/image/pic/item/9d82d158ccbf6c81b94575cfb93eb13533fa40a2.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 9,</span><br><span class="line">        src: &quot;http://e.hiphotos.baidu.com/image/pic/item/4bed2e738bd4b31c1badd5a685d6277f9e2ff81e.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 10,</span><br><span class="line">        src: &quot;http://g.hiphotos.baidu.com/image/pic/item/0d338744ebf81a4c87a3add4d52a6059252da61e.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 11,</span><br><span class="line">        src: &quot;http://a.hiphotos.baidu.com/image/pic/item/f2deb48f8c5494ee5080c8142ff5e0fe99257e19.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 12,</span><br><span class="line">        src: &quot;http://f.hiphotos.baidu.com/image/pic/item/4034970a304e251f503521f5a586c9177e3e53f9.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 13,</span><br><span class="line">        src: &quot;http://b.hiphotos.baidu.com/image/pic/item/279759ee3d6d55fbb3586c0168224f4a20a4dd7e.jpg&quot;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 14,</span><br><span class="line">        src: &quot;http://a.hiphotos.baidu.com/image/pic/item/e824b899a9014c087eb617650e7b02087af4f464.jpg&quot;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯çº¯å›¾ç‰‡é¡µé¢ï¼Œéœ€è¦ç»™ç»™å›¾ç‰‡è®¾ç½®é»˜è®¤å®½é«˜ã€‚</p><p>å¦åˆ™åˆæ¬¡åˆ·æ–°æ—¶ï¼Œå…ƒç´ çš„å®½é«˜éƒ½æ˜¯ 0ï¼Œä¼šå¯¼è‡´æ‰€æœ‰å…ƒç´ éƒ½åœ¨å¯è§†åŒºå†…ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">  <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">202px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">166px</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover; <span class="comment">/* å±…ä¸­è‡ªåŠ¨å‰ªè£å›¾ç‰‡ */</span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /æ‡’åŠ è½½.webp" style="height: 500px; width: 500px;"></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆæ¬¡åŠ è½½æ—¶ï¼Œåªä¼šè¯·æ±‚å½“å‰é¡µé¢çš„èµ„æºï¼Œéšç€å¯è§†åŒºåŸŸå˜åŒ–ï¼Œå†è¿›è¡Œèµ„æºè¯·æ±‚</p><h2 id="2-4-æ€§èƒ½æµ‹è¯•"><a href="#2-4-æ€§èƒ½æµ‹è¯•" class="headerlink" title="2.4 æ€§èƒ½æµ‹è¯•"></a>2.4 æ€§èƒ½æµ‹è¯•</h2><p>ä¸ºäº†éªŒè¯æ€§èƒ½ï¼Œåœ¨ä¸Šé¢çš„DemoåŸºç¡€ä¸Šï¼Œè¿›è¡Œå¯¹æ¯”æµ‹è¯•ã€‚</p><p>é¦–å…ˆæ˜¯æ²¡æœ‰æ·»åŠ æ‡’åŠ è½½çš„å…ƒç´ </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;item.src&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆæ¬¡é¡µé¢åŠ è½½æ—¶ä¼šè¯·æ±‚æ‰€æœ‰èµ„æºï¼Œ<strong>é¡µé¢ Load äº‹ä»¶å®Œæˆçš„æ—¶é—´ç«Ÿç„¶æœ‰ 14.96 s</strong></p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /å¯¹æ¯”å®éªŒ1.png" style="height: 130px; width: 800px;"></div><p>ç°åœ¨æˆ‘ä»¬ä¸ºä»–åŠ ä¸Š loading&#x3D;â€lazyâ€ ä¸ decoding&#x3D;asyncâ€</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;item.src&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span> <span class="attr">decoding</span>=<span class="string">&quot;async&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>é¦–æ¬¡è¿›å…¥é¡µé¢ä»…è¯·æ±‚æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å›¾ç‰‡ï¼Œ<strong>é¡µé¢ Load äº‹ä»¶å®Œæˆçš„æ—¶é—´ä¸º 597 ms</strong></p><div align="center">    <img src="/2023/07/06/æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½-å¼‚æ­¥è§£ç /å¯¹æ¯”å®éªŒ2.png" style="height: 130px; width: 800px;"></div><p>å½“é¡µé¢æ»šåŠ¨æ—¶ï¼Œæ˜¾ç¤ºçš„å›¾ç‰‡æ‰ä¼šç»§ç»­å‘é€è¯·æ±‚</p><h1 id="3-æ€»ç»“ä¸€ä¸‹"><a href="#3-æ€»ç»“ä¸€ä¸‹" class="headerlink" title="3 æ€»ç»“ä¸€ä¸‹"></a>3 æ€»ç»“ä¸€ä¸‹</h1><ul><li>content-visibility: auto + contain-intrinsic-size å¯ä»¥å®ç°å»¶è¿Ÿæ¸²æŸ“ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“å…¨å±€çš„æœç´¢åŠŸèƒ½<ul><li>ä½†æ˜¯åˆå§‹åŒ–æ—¶ï¼Œèµ„æºä¼šå…¨éƒ¨åŠ è½½ï¼Œå› æ­¤ä¸å¤ªé€‚åˆåšå›¾ç‰‡æ‡’åŠ è½½ï¼Œæ›´é€‚åˆäºè™šæ‹Ÿåˆ—è¡¨åœºæ™¯</li></ul></li><li>loading&#x3D;â€lazyâ€ + decoding&#x3D;â€asyncâ€ å¯ä»¥å®ç°æ‡’åŠ è½½+å¼‚æ­¥è§£ç ï¼Œæµè§ˆå™¨åªä¼šåŠ è½½å¯è§†åŒºçš„èµ„æº</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
